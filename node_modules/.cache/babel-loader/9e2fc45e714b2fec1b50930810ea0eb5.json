{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/BlockChain-ui-privatization/PC/common-mixin/fiatdeal/creditCard/creditCard.js","dependencies":[{"path":"/Users/h/partTimeJob/BlockChain-ui-privatization/PC/common-mixin/fiatdeal/creditCard/creditCard.js","mtime":1637244007054},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.split\";\nimport { fixInput, fixD } from '@/utils';\nexport default {\n  data: function data() {\n    return {\n      confirmFlag: false,\n      redioFlag: false,\n      activeToken: '',\n      // 当前 数字货币\n      activeFiat: '',\n      // 当前 法币货币\n      tokenList: [],\n      // 数字货币 下拉列表\n      fiatList: [],\n      // 法币货币 下拉列表\n      tokenInput: '',\n      // 输入的数字货币\n      fiatInput: '',\n      // 输入的法币货币\n      nowRate: 0,\n      // 当前币种汇率\n      sourceID: '',\n      spks: {},\n      // 区间\n      dialogConfirmLoading: false,\n      callBackFlag: false // 回调弹窗\n\n    };\n  },\n  computed: {\n    loginFlag: function loginFlag() {\n      var _this$$store$state$ba = this.$store.state.baseData,\n          isLogin = _this$$store$state$ba.isLogin,\n          userInfoIsReady = _this$$store$state$ba.userInfoIsReady;\n\n      if (isLogin && userInfoIsReady) {\n        return true;\n      }\n\n      return false;\n    },\n    warn2Text: function warn2Text() {\n      var value = this.$t('creditCard.warn2');\n      var arr = ['https://buy.moonpay.io/trade_history', '/assets/flowingWater'];\n      return this.setLocals(value, arr);\n    },\n    callBackText1: function callBackText1() {\n      var value = this.$t('creditCard.callBackText1');\n      var arr = ['https://buy.moonpay.io/trade_history'];\n      return this.setLocals(value, arr);\n    },\n    lan: function lan() {\n      if (this.$store.state.baseData) {\n        return this.$store.state.baseData.lan;\n      }\n\n      return null;\n    },\n    linkurl: function linkurl() {\n      if (this.$store.state.baseData.publicInfo) {\n        return this.$store.state.baseData.publicInfo.url;\n      }\n\n      return {};\n    },\n    dialogConfirmDisabled: function dialogConfirmDisabled() {\n      if (this.dialogConfirmLoading) {\n        return false;\n      }\n\n      if (this.redioFlag) {\n        return false;\n      }\n\n      return true;\n    },\n    market: function market() {\n      return this.$store.state.baseData.market;\n    },\n    nowSpk: function nowSpk() {\n      var obj = '';\n\n      if (this.spks[this.activeFiat]) {\n        obj = this.spks[this.activeFiat];\n      }\n\n      return obj;\n    },\n    inputError: function inputError() {\n      var obj = {\n        flag: false,\n        show: false,\n        text: ''\n      };\n      var _this$nowSpk = this.nowSpk,\n          minAmount = _this$nowSpk.minAmount,\n          maxAmount = _this$nowSpk.maxAmount;\n      var numb = parseFloat(this.fiatInput);\n\n      if (this.fiatInput && this.nowSpk) {\n        if (minAmount - 1 < numb && numb < maxAmount + 1) {\n          obj.flag = true;\n        } else {\n          obj.show = true; // 下单区间\n\n          obj.text = \"\".concat(this.$t('creditCard.spk'), \"\\uFF1A\").concat(minAmount, \" \").concat(this.activeFiat, \"\\n           ~ \").concat(maxAmount, \" \").concat(this.activeFiat);\n        }\n      }\n\n      return obj;\n    },\n    buttonDisable: function buttonDisable() {\n      var flag = true;\n\n      if (this.activeFiat && this.inputError.flag) {\n        flag = false;\n      }\n\n      return flag;\n    }\n  },\n  watch: {\n    confirmFlag: function confirmFlag(v) {\n      if (!v) {\n        this.redioFlag = false;\n      }\n    } // tokenInput(v) {\n    //   const { coinList } = this.market;\n    //   const fix = (coinList[this.activeToken] && coinList[this.activeToken].showPrecision) || 0;\n    //   // 限制精度和不非数字字符\n    //   this.tokenInput = fixInput(v, fix).toString();\n    // },\n    // fiatInput(v) {\n    //   this.fiatInput = fixInput(v, 2).toString();\n    // },\n\n  },\n  methods: {\n    goLogin: function goLogin() {\n      this.$router.push('/login');\n    },\n    setLocals: function setLocals(value, linkList) {\n      var str = value;\n      var newStr = '';\n\n      if (str) {\n        var arr = str.split('$<');\n        var i = 0;\n        arr.forEach(function (item) {\n          if (item.indexOf('>$') !== -1) {\n            var url = linkList[i];\n            i += 1;\n            var n = item.split('>$');\n            newStr += \"<a class=\\\"u-8-cl\\\" href=\\\"\".concat(url, \"\\\" target=\\\"_block\\\">\\n              \").concat(n[0], \"</a>\").concat(n[1]);\n          } else {\n            newStr += item;\n          }\n        });\n      }\n\n      return newStr;\n    },\n    callBackSubmit: function callBackSubmit() {\n      this.$router.push('/assets/exchangeAccount');\n    },\n    callBackClose: function callBackClose() {\n      this.callBackFlag = false;\n    },\n    setRedio: function setRedio() {\n      this.redioFlag = !this.redioFlag;\n    },\n    submit: function submit() {\n      this.confirmFlag = true;\n    },\n    confirmClose: function confirmClose() {\n      this.confirmFlag = false;\n    },\n    confirmSubmit: function confirmSubmit() {\n      this.dialogConfirmLoading = true; // this.axios({\n      //   url: 'finance/get_charge_address',\n      //   params: {\n      //     symbol: this.activeToken,\n      //   },\n      // }).then((data) => {\n      //   if (data.code.toString() === '0') {\n      //     this.getD();\n      //   } else {\n      //     this.$bus.$emit('tip', { text: data.msg, type: 'error' });\n      //   }\n      // });\n\n      this.getD();\n    },\n    getD: function getD() {\n      var _this = this;\n\n      this.axios({\n        url: 'credit/createOrder',\n        hostType: 'fe-credit-api',\n        params: {\n          token: this.activeToken,\n          // 加密货币\n          fiatCoin: this.activeFiat,\n          // 法定货币\n          amount: this.fiatInput // 法定货币数额 （正整数）\n          // source: this.sourceID, // 服务商ID\n\n        },\n        method: 'post'\n      }).then(function (data) {\n        _this.dialogConfirmLoading = false;\n\n        if (data.code === '0') {\n          // window.location.href = data.data.url;\n          window.open(data.data.orderUrl);\n          _this.confirmFlag = false;\n          _this.callBackFlag = true;\n        } else {\n          _this.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    inputChanges: function inputChanges(value, name) {\n      this[name] = value;\n      var coinList = this.market.coinList;\n      var fix = coinList[this.activeToken] && coinList[this.activeToken].showPrecision || 0;\n\n      if (name === 'tokenInput') {\n        // 限制精度和不非数字字符\n        this.tokenInput = fixInput(value, fix);\n        this.fiatInput = fixD(this.tokenInput * this.nowRate, 0);\n      } else {\n        this.fiatInput = fixInput(value, 0);\n        this.tokenInput = fixD(this.fiatInput / this.nowRate, fix);\n      }\n    },\n    init: function init() {\n      this.getLogos();\n      this.getCoins();\n    },\n    // 获取头部logo\n    getLogos: function getLogos() {// this.axios({\n      //   url: 'middleman/bankList',\n      //   hostType: 'fe-credit-api',\n      //   params: {},\n      //   method: 'post',\n      // }).then((data) => {\n      //   if (data.code === '0') {\n      //     console.log(data);\n      //   } else {\n      //     this.$bus.$emit('tip', { text: data.msg, type: 'error' });\n      //   }\n      // });\n    },\n    // 获取币种列表\n    getCoins: function getCoins() {\n      var _this2 = this;\n\n      this.axios({\n        url: 'credit/availableCoins',\n        hostType: 'fe-credit-api',\n        params: {},\n        method: 'post'\n      }).then(function (data) {\n        if (data.code === '0') {\n          var _data$data = data.data,\n              fiatList = _data$data.fiatList,\n              tokenList = _data$data.tokenList;\n          var fiatArr = [];\n          fiatList.forEach(function (item) {\n            fiatArr.push({\n              value: item.fiatCoin,\n              code: item.fiatCoin\n            });\n\n            if (item.isDefault) {\n              _this2.activeFiat = item.fiatCoin;\n            }\n\n            _this2.spks[item.fiatCoin] = item;\n          });\n          var tokenArr = [];\n          tokenList.forEach(function (item) {\n            var value = item.coin;\n\n            if (value === 'EUSDT') {\n              value = 'USDT(ERC20)';\n            }\n\n            tokenArr.push({\n              value: value,\n              code: item.coin\n            });\n\n            if (item.isDefault) {\n              _this2.activeToken = item.coin;\n            }\n          });\n          _this2.fiatList = fiatArr;\n          _this2.tokenList = tokenArr;\n\n          _this2.getMess();\n        } else {// this.$bus.$emit('tip', { text: data.msg, type: 'error' });\n        }\n      });\n    },\n    getMess: function getMess() {\n      var _this3 = this;\n\n      this.axios({\n        url: 'credit/moonPayRate',\n        hostType: 'fe-credit-api',\n        params: {\n          token: this.activeToken,\n          // 加密货币\n          fiatCoin: this.activeFiat // 法定货币\n\n        },\n        method: 'post'\n      }).then(function (data) {\n        if (data.code === '0') {\n          if (_this3.fiatInput || _this3.tokenInput) {\n            _this3.fiatInput = '';\n            _this3.tokenInput = ''; // 汇率已更新，请重新下单\n\n            _this3.$bus.$emit('tip', {\n              text: _this3.$t('creditCard.warningText'),\n              type: 'warning'\n            });\n          }\n\n          _this3.nowRate = data.data.moonPayRate; // this.sourceID = data.data.serverList[0].id;\n        } else {// this.$bus.$emit('tip', { text: data.msg, type: 'error' });\n        }\n      });\n    },\n    reset: function reset() {\n      this.tokenInput = '';\n      this.fiatInput = '';\n      this.nowRate = 0;\n      this.getMess();\n    },\n    tokenChange: function tokenChange(item) {\n      if (item.code === this.activeToken) return;\n      this.activeToken = item.code;\n      this.reset();\n    },\n    fiatChange: function fiatChange(item) {\n      if (item.code === this.activeFiat) return;\n      this.activeFiat = item.code;\n      this.reset();\n    }\n  }\n};",{"version":3,"sources":["/Users/h/partTimeJob/BlockChain-ui-privatization/PC/common-mixin/fiatdeal/creditCard/creditCard.js"],"names":["fixInput","fixD","data","confirmFlag","redioFlag","activeToken","activeFiat","tokenList","fiatList","tokenInput","fiatInput","nowRate","sourceID","spks","dialogConfirmLoading","callBackFlag","computed","loginFlag","$store","state","baseData","isLogin","userInfoIsReady","warn2Text","value","$t","arr","setLocals","callBackText1","lan","linkurl","publicInfo","url","dialogConfirmDisabled","market","nowSpk","obj","inputError","flag","show","text","minAmount","maxAmount","numb","parseFloat","buttonDisable","watch","v","methods","goLogin","$router","push","linkList","str","newStr","split","i","forEach","item","indexOf","n","callBackSubmit","callBackClose","setRedio","submit","confirmClose","confirmSubmit","getD","axios","hostType","params","token","fiatCoin","amount","method","then","code","window","open","orderUrl","$bus","$emit","msg","type","inputChanges","name","coinList","fix","showPrecision","init","getLogos","getCoins","fiatArr","isDefault","tokenArr","coin","getMess","moonPayRate","reset","tokenChange","fiatChange"],"mappings":"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","sourcesContent":["import {\r\n  fixInput, fixD,\r\n} from '@/utils';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      confirmFlag: false,\r\n      redioFlag: false,\r\n      activeToken: '', // 当前 数字货币\r\n      activeFiat: '', // 当前 法币货币\r\n      tokenList: [], // 数字货币 下拉列表\r\n      fiatList: [], // 法币货币 下拉列表\r\n      tokenInput: '', // 输入的数字货币\r\n      fiatInput: '', // 输入的法币货币\r\n      nowRate: 0, // 当前币种汇率\r\n      sourceID: '',\r\n      spks: {}, // 区间\r\n      dialogConfirmLoading: false,\r\n      callBackFlag: false, // 回调弹窗\r\n    };\r\n  },\r\n  computed: {\r\n    loginFlag() {\r\n      const { isLogin, userInfoIsReady } = this.$store.state.baseData;\r\n      if (isLogin && userInfoIsReady) {\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n    warn2Text() {\r\n      const value = this.$t('creditCard.warn2');\r\n      const arr = [\r\n        'https://buy.moonpay.io/trade_history',\r\n        '/assets/flowingWater',\r\n      ];\r\n      return this.setLocals(value, arr);\r\n    },\r\n    callBackText1() {\r\n      const value = this.$t('creditCard.callBackText1');\r\n      const arr = [\r\n        'https://buy.moonpay.io/trade_history',\r\n      ];\r\n      return this.setLocals(value, arr);\r\n    },\r\n    lan() {\r\n      if (this.$store.state.baseData) {\r\n        return this.$store.state.baseData.lan;\r\n      }\r\n      return null;\r\n    },\r\n    linkurl() {\r\n      if (this.$store.state.baseData.publicInfo) {\r\n        return this.$store.state.baseData.publicInfo.url;\r\n      }\r\n      return {};\r\n    },\r\n    dialogConfirmDisabled() {\r\n      if (this.dialogConfirmLoading) {\r\n        return false;\r\n      }\r\n      if (this.redioFlag) {\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    market() { return this.$store.state.baseData.market; },\r\n    nowSpk() {\r\n      let obj = '';\r\n      if (this.spks[this.activeFiat]) {\r\n        obj = this.spks[this.activeFiat];\r\n      }\r\n      return obj;\r\n    },\r\n    inputError() {\r\n      const obj = {\r\n        flag: false,\r\n        show: false,\r\n        text: '',\r\n      };\r\n      const { minAmount, maxAmount } = this.nowSpk;\r\n      const numb = parseFloat(this.fiatInput);\r\n      if (this.fiatInput && this.nowSpk) {\r\n        if (minAmount - 1 < numb && numb < maxAmount + 1) {\r\n          obj.flag = true;\r\n        } else {\r\n          obj.show = true;\r\n          // 下单区间\r\n          obj.text = `${this.$t('creditCard.spk')}：${minAmount} ${this.activeFiat}\r\n           ~ ${maxAmount} ${this.activeFiat}`;\r\n        }\r\n      }\r\n      return obj;\r\n    },\r\n    buttonDisable() {\r\n      let flag = true;\r\n      if (this.activeFiat && this.inputError.flag) {\r\n        flag = false;\r\n      }\r\n      return flag;\r\n    },\r\n  },\r\n  watch: {\r\n    confirmFlag(v) {\r\n      if (!v) { this.redioFlag = false; }\r\n    },\r\n    // tokenInput(v) {\r\n    //   const { coinList } = this.market;\r\n    //   const fix = (coinList[this.activeToken] && coinList[this.activeToken].showPrecision) || 0;\r\n    //   // 限制精度和不非数字字符\r\n    //   this.tokenInput = fixInput(v, fix).toString();\r\n    // },\r\n    // fiatInput(v) {\r\n    //   this.fiatInput = fixInput(v, 2).toString();\r\n    // },\r\n  },\r\n  methods: {\r\n    goLogin() {\r\n      this.$router.push('/login');\r\n    },\r\n    setLocals(value, linkList) {\r\n      const str = value;\r\n      let newStr = '';\r\n      if (str) {\r\n        const arr = str.split('$<');\r\n        let i = 0;\r\n        arr.forEach((item) => {\r\n          if (item.indexOf('>$') !== -1) {\r\n            const url = linkList[i];\r\n            i += 1;\r\n            const n = item.split('>$');\r\n            newStr += `<a class=\"u-8-cl\" href=\"${url}\" target=\"_block\">\r\n              ${n[0]}</a>${n[1]}`;\r\n          } else {\r\n            newStr += item;\r\n          }\r\n        });\r\n      }\r\n      return newStr;\r\n    },\r\n    callBackSubmit() {\r\n      this.$router.push('/assets/exchangeAccount');\r\n    },\r\n    callBackClose() {\r\n      this.callBackFlag = false;\r\n    },\r\n    setRedio() {\r\n      this.redioFlag = !this.redioFlag;\r\n    },\r\n    submit() {\r\n      this.confirmFlag = true;\r\n    },\r\n    confirmClose() {\r\n      this.confirmFlag = false;\r\n    },\r\n    confirmSubmit() {\r\n      this.dialogConfirmLoading = true;\r\n      // this.axios({\r\n      //   url: 'finance/get_charge_address',\r\n      //   params: {\r\n      //     symbol: this.activeToken,\r\n      //   },\r\n      // }).then((data) => {\r\n      //   if (data.code.toString() === '0') {\r\n      //     this.getD();\r\n      //   } else {\r\n      //     this.$bus.$emit('tip', { text: data.msg, type: 'error' });\r\n      //   }\r\n      // });\r\n\r\n\t\t\tthis.getD();\r\n    },\r\n    getD() {\r\n      this.axios({\r\n        url: 'credit/createOrder',\r\n        hostType: 'fe-credit-api',\r\n        params: {\r\n          token: this.activeToken, // 加密货币\r\n          fiatCoin: this.activeFiat, // 法定货币\r\n          amount: this.fiatInput, // 法定货币数额 （正整数）\r\n          // source: this.sourceID, // 服务商ID\r\n        },\r\n        method: 'post',\r\n      }).then((data) => {\r\n        this.dialogConfirmLoading = false;\r\n        if (data.code === '0') {\r\n          // window.location.href = data.data.url;\r\n          window.open(data.data.orderUrl);\r\n          this.confirmFlag = false;\r\n          this.callBackFlag = true;\r\n        } else {\r\n          this.$bus.$emit('tip', { text: data.msg, type: 'error' });\r\n        }\r\n      });\r\n    },\r\n    inputChanges(value, name) {\r\n      this[name] = value;\r\n      const { coinList } = this.market;\r\n      const fix = (coinList[this.activeToken] && coinList[this.activeToken].showPrecision) || 0;\r\n      if (name === 'tokenInput') {\r\n        // 限制精度和不非数字字符\r\n        this.tokenInput = fixInput(value, fix);\r\n        this.fiatInput = fixD((this.tokenInput * this.nowRate), 0);\r\n      } else {\r\n        this.fiatInput = fixInput(value, 0);\r\n        this.tokenInput = fixD((this.fiatInput / this.nowRate), fix);\r\n      }\r\n    },\r\n    init() {\r\n      this.getLogos();\r\n      this.getCoins();\r\n    },\r\n    // 获取头部logo\r\n    getLogos() {\r\n      // this.axios({\r\n      //   url: 'middleman/bankList',\r\n      //   hostType: 'fe-credit-api',\r\n      //   params: {},\r\n      //   method: 'post',\r\n      // }).then((data) => {\r\n      //   if (data.code === '0') {\r\n      //     console.log(data);\r\n      //   } else {\r\n      //     this.$bus.$emit('tip', { text: data.msg, type: 'error' });\r\n      //   }\r\n      // });\r\n    },\r\n    // 获取币种列表\r\n    getCoins() {\r\n      this.axios({\r\n        url: 'credit/availableCoins',\r\n        hostType: 'fe-credit-api',\r\n        params: {},\r\n        method: 'post',\r\n      }).then((data) => {\r\n        if (data.code === '0') {\r\n          const { fiatList, tokenList } = data.data;\r\n          const fiatArr = [];\r\n          fiatList.forEach((item) => {\r\n            fiatArr.push({\r\n              value: item.fiatCoin,\r\n              code: item.fiatCoin,\r\n            });\r\n            if (item.isDefault) {\r\n              this.activeFiat = item.fiatCoin;\r\n            }\r\n            this.spks[item.fiatCoin] = item;\r\n          });\r\n          const tokenArr = [];\r\n          tokenList.forEach((item) => {\r\n            let value = item.coin;\r\n            if (value === 'EUSDT') {\r\n              value = 'USDT(ERC20)';\r\n            }\r\n            tokenArr.push({\r\n              value,\r\n              code: item.coin,\r\n            });\r\n            if (item.isDefault) {\r\n              this.activeToken = item.coin;\r\n            }\r\n          });\r\n          this.fiatList = fiatArr;\r\n          this.tokenList = tokenArr;\r\n          this.getMess();\r\n        } else {\r\n          // this.$bus.$emit('tip', { text: data.msg, type: 'error' });\r\n        }\r\n      });\r\n    },\r\n    getMess() {\r\n      this.axios({\r\n        url: 'credit/moonPayRate',\r\n        hostType: 'fe-credit-api',\r\n        params: {\r\n          token: this.activeToken, // 加密货币\r\n          fiatCoin: this.activeFiat, // 法定货币\r\n        },\r\n        method: 'post',\r\n      }).then((data) => {\r\n        if (data.code === '0') {\r\n          if (this.fiatInput || this.tokenInput) {\r\n            this.fiatInput = '';\r\n            this.tokenInput = '';\r\n            // 汇率已更新，请重新下单\r\n            this.$bus.$emit('tip', {\r\n              text: this.$t('creditCard.warningText'),\r\n              type: 'warning',\r\n            });\r\n          }\r\n          this.nowRate = data.data.moonPayRate;\r\n          // this.sourceID = data.data.serverList[0].id;\r\n        } else {\r\n          // this.$bus.$emit('tip', { text: data.msg, type: 'error' });\r\n        }\r\n      });\r\n    },\r\n    reset() {\r\n      this.tokenInput = '';\r\n      this.fiatInput = '';\r\n      this.nowRate = 0;\r\n      this.getMess();\r\n    },\r\n    tokenChange(item) {\r\n      if (item.code === this.activeToken) return;\r\n      this.activeToken = item.code;\r\n      this.reset();\r\n    },\r\n    fiatChange(item) {\r\n      if (item.code === this.activeFiat) return;\r\n      this.activeFiat = item.code;\r\n      this.reset();\r\n    },\r\n  },\r\n};\r\n"]}]}