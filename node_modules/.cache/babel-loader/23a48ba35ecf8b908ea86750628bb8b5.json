{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/market/index/index.js","dependencies":[{"path":"/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/market/index/index.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.object.keys\";\nimport _slicedToArray from \"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _defineProperty from \"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { mapState } from 'vuex';\nimport _worker from '@/utils/webWorker';\nimport { myStorage, getCoinShowName } from '@/utils';\nexport default {\n  data: function data() {\n    return {\n      // 市场数据\n      marketData: null,\n      // MywebSocket\n      MywebSocket: null,\n      // 当前市场\n      marketCurrent: null,\n      // 当前币对\n      symbolCurrent: null,\n      // 当前币对列表\n      symbolCurrentList: [],\n      // 筛选 货币对\n      listfilter: null,\n      // 表格加载LOADING\n      tableLoading: false,\n      // 表格 超过 20条出现滚动条\n      lineNumber: 20,\n      // 24小时行情WS数据\n      marketDataObj: [],\n      marketDataList: [],\n      // 推荐位数据\n      recommendDataList: {},\n      klineDataList: {},\n      // 自选币对\n      mySymbolList: myStorage.get('mySymbol') || [],\n      setMyMarketSwitch: true,\n      // 是否显示左侧数据栏\n      isShowRecommend: true\n    };\n  },\n  computed: _objectSpread(_objectSpread({\n    coinTagLangs: function coinTagLangs() {\n      return this.$store.state.baseData.coinTagLangs;\n    },\n    coinTagOpen: function coinTagOpen() {\n      return this.$store.state.baseData.coin_tag_open;\n    }\n  }, mapState({\n    baseInfo: function baseInfo(_ref) {\n      var baseData = _ref.baseData;\n      this.marketData = baseData.market; // 获取当前市场\n\n      this.marketCurrent = myStorage.get('homeMarkTitle'); // 获取当前币对\n\n      this.symbolCurrent = myStorage.get('sSymbolName');\n      return baseData;\n    }\n  })), {}, {\n    // WS worker\n    worker: function worker() {\n      return _worker();\n    },\n    // 全部 货币对\n    symbolAll: function symbolAll() {\n      return this.$store.state.baseData.symbolAll;\n    },\n    // 当前市场列表\n    currentMarketList: function currentMarketList() {\n      return this.marketData ? this.marketData.market : null;\n    },\n    coinList: function coinList() {\n      if (this.$store.state.baseData.market) {\n        return this.$store.state.baseData.market.coinList;\n      }\n\n      return null;\n    },\n    // 当前币对列表\n    symbolList: function symbolList() {\n      var _this = this;\n\n      // 如果 当前市场 是 自选市场\n      if (this.marketCurrent === 'myMarket') {\n        var mySymbol = myStorage.get('mySymbol') || [];\n        var marketList = {};\n\n        if (mySymbol.length) {\n          mySymbol.forEach(function (item) {\n            if (item && _this.symbolAll[item]) {\n              marketList[item] = _this.symbolAll[item];\n            }\n          });\n        }\n\n        return marketList;\n      }\n\n      if (this.currentMarketList && this.marketCurrent) {\n        return this.currentMarketList[this.marketCurrent];\n      }\n\n      return null;\n    },\n    // 汇率单位\n    rateData: function rateData() {\n      return this.$store.state.baseData.rate;\n    },\n    isLogin: function isLogin() {\n      return this.$store.state.baseData.isLogin;\n    },\n    optionalSymbolServerOpen: function optionalSymbolServerOpen() {\n      return this.$store.state.baseData.optional_symbol_server_open;\n    }\n  }),\n  watch: {\n    symbolList: function symbolList(val, oldVal) {\n      if (oldVal) {\n        this.webSocketSend('Market', 'unsub', this.symbolCurrent, oldVal);\n        this.webSocketSend('Market', 'sub', this.symbolCurrent, val);\n      }\n    },\n    // 监听 是否登录\n    isLogin: function isLogin(val) {\n      if (val) {\n        this.mySymbolList = myStorage.get('mySymbol') || [];\n      }\n    },\n    // 监听获取到 market 接口的数据\n    marketData: function marketData(val) {\n      if (val.wsUrl) {\n        // 创建WS\n        this.worker.postMessage({\n          type: 'CREAT_WEBSOCKET',\n          data: {\n            wsUrl: val.wsUrl,\n            lan: this.$store.state.baseData.lan,\n            rate: this.rateData,\n            symbolAll: this.symbolAll\n          }\n        });\n      }\n    },\n    // 监听 webSocket 创建成功\n    MywebSocket: function MywebSocket(val) {\n      if (val) {\n        // 发送 24小时行情历史数据 Send\n        this.webSocketSend('Review', null, this.symbolCurrent, this.symbolAll); // 发送 24小时行情实时数据 Send\n\n        this.webSocketSend('Market', 'sub', this.symbolCurrent, this.symbolList); // 发送 推荐位 kline数据 Send\n\n        if (this.symbolCurrent) {\n          this.klneSend();\n        }\n      }\n    },\n    symbolCurrent: function symbolCurrent(val, oldVal) {\n      if (val && this.MywebSocket) {\n        this.isShowRecommend = true;\n        this.klneSend(oldVal);\n      }\n    },\n    mySymbolList: function mySymbolList(val) {\n      if (val) {\n        this.$bus.$emit('MYSYMBOL-LIST', val);\n      }\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.webSocketSend('Market', 'unsub', this.symbolCurrent, this.symbolList);\n    window.onscroll = null;\n  },\n  methods: {\n    init: function init() {\n      var _this2 = this;\n\n      this.onmessageWorker(); // 监听 市场切换\n\n      this.$bus.$on('SWITCH-MARKET', function (data) {\n        _this2.marketCurrent = data;\n\n        _this2.setMarketData();\n      });\n      this.$bus.$on('SWITCH-STORE', function (data) {\n        _this2.setMyMarket(data);\n\n        _this2.setMarketData();\n      });\n      this.$bus.$on('SWITCH-SYMBOL', function (data) {\n        _this2.symbolCurrent = data;\n\n        _this2.setRecommendData();\n      });\n      this.$bus.$emit('MYSYMBOL-LIST', this.mySymbolList); // 监听 窗口的大小改变\n\n      this.$bus.$on('WINFOW_ON_RESIIZE', function () {\n        _this2.isShowRecommend = true;\n      });\n    },\n    klneSend: function klneSend(oldVal) {\n      var symbolArr = this.symbolCurrent.toLowerCase().split('/');\n      var symbol = symbolArr[0] + symbolArr[1];\n\n      if (oldVal) {\n        var oldSymbolArr = oldVal.toLowerCase().split('/');\n        var oldSsymbol = oldSymbolArr[0] + oldSymbolArr[1];\n        this.worker.postMessage({\n          type: 'WEBSOCKET_KLINE_SEND',\n          data: {\n            symbol: oldSsymbol,\n            type: 'unsub',\n            lastTimeS: '1min'\n          }\n        });\n      }\n\n      this.worker.postMessage({\n        type: 'WEBSOCKET_KLINE_SEND',\n        data: {\n          symbol: symbol,\n          type: 'req',\n          lastTimeS: '1min',\n          lTime: false,\n          number: 100,\n          symbolCurrent: this.symbolCurrent\n        }\n      });\n      this.worker.postMessage({\n        type: 'WEBSOCKET_KLINE_SEND',\n        data: {\n          symbol: symbol,\n          type: 'sub',\n          lastTimeS: '1min',\n          lTime: false,\n          symbolCurrent: this.symbolCurrent\n        }\n      });\n    },\n    onmessageWorker: function onmessageWorker() {\n      var _this3 = this;\n\n      this.worker.onmessage = function (event) {\n        var data = event.data; // 监听 WebSocket 链接成功\n\n        if (data.type === 'WEBSOCKET_ON_OPEN') {\n          _this3.MywebSocket = data.data.type;\n        } // 监听 WS 数据\n\n\n        if (data.type === 'WEBSOCKET_DATA') {\n          _this3.listenWSData(data.data);\n        }\n      };\n    },\n    // 监听 WS 返回的数据\n    listenWSData: function listenWSData(data) {\n      var _this4 = this;\n\n      var type = data.type,\n          WsData = data.WsData; // 24小时行情数据\n\n      if (type === 'MARKET_DATA') {\n        this.marketDataObj = WsData;\n        this.setMarketData();\n        this.setRecommendData();\n      }\n\n      if (type.indexOf('KLINE_DATA') > -1) {\n        var _WsData$channel$split = WsData.channel.split('_'),\n            _WsData$channel$split2 = _slicedToArray(_WsData$channel$split, 2),\n            symbolType = _WsData$channel$split2[1];\n\n        var key = this.symbolCurrent;\n        var symbolArr = this.symbolCurrent.toLowerCase().split('/');\n        var symbol = symbolArr[0] + symbolArr[1];\n\n        if (symbol === symbolType) {\n          if (WsData.event_rep === 'rep') {\n            var kData = WsData.data;\n            this.klineDataList[key] = [];\n            var lengthNumber = kData.slice(-20);\n            lengthNumber.forEach(function (item) {\n              _this4.klineDataList[key].push([item.id, item.close]);\n            });\n          } else {\n            var _kData = WsData.tick;\n            var keyYs = this.klineDataList[key] || [];\n            var lengths = keyYs.length;\n\n            if (this.klineDataList[key].length) {\n              var lastId = this.klineDataList[key][lengths - 1][0];\n\n              if (lastId === _kData.id) {\n                this.klineDataList[key].pop();\n              }\n\n              if (this.klineDataList[key].length > 20) {\n                this.klineDataList[key].shift();\n              }\n\n              if (lastId <= _kData.id) {\n                this.klineDataList[key].push([_kData.id, _kData.close]);\n              }\n            }\n          }\n        }\n\n        this.$bus.$emit('RECOMMEEND_KLINE_DATA', this.klineDataList);\n      }\n    },\n    // 发送 Send\n    webSocketSend: function webSocketSend(type, sendType, symbolData, symbolList) {\n      this.worker.postMessage({\n        type: 'WEBSOCKET_SEND',\n        data: {\n          type: type,\n          sendType: sendType,\n          symbolData: symbolData,\n          symbolList: symbolList\n        }\n      });\n    },\n    // 格式化 推荐位的 K线数据\n    setRecommendData: function setRecommendData() {\n      if (this.marketDataObj && this.marketDataObj[this.symbolCurrent]) {\n        this.$bus.$emit('RECOMMEEND_DATA', this.marketDataObj[this.symbolCurrent]);\n      }\n    },\n    getCoinLabel: function getCoinLabel(name) {\n      var coinList = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (coinList && coinList[name.toUpperCase()]) {\n        var _coinList$name$toUppe = coinList[name.toUpperCase()].coinTag,\n            coinTag = _coinList$name$toUppe === void 0 ? '' : _coinList$name$toUppe;\n        return coinTag ? this.coinTagLangs[coinTag] : '';\n      }\n\n      return '';\n    },\n    // 格式化 推荐位的24小时行情数据\n    setMarketData: function setMarketData() {\n      var _this5 = this;\n\n      if (!this.symbolList) return;\n      var marketDataList = [];\n      var keyarr = Object.keys(this.symbolList);\n      keyarr.forEach(function (item) {\n        if (_this5.symbolList[item].newcoinFlag) {\n          _this5.newcoinFlag = true;\n        }\n\n        var itemData = _this5.marketDataObj[item];\n\n        if (itemData) {\n          var showName = getCoinShowName(itemData.name, _this5.symbolAll);\n\n          var coinLabel = _this5.getCoinLabel(itemData.symbol.symbol, _this5.coinList);\n\n          var iconSvg = \"<span>\".concat(showName, \"</span>\");\n\n          if (coinLabel && _this5.coinTagOpen) {\n            var str = \"<div class=\\\"coin-label\\\">\\n              <span class=\\\"coin-text a-12-cl\\\">\".concat(coinLabel, \"</span>\\n              <span class=\\\"coin-bg a-12-bg\\\"></span>\\n            </div>\");\n            iconSvg = \"\".concat(iconSvg).concat(str);\n          }\n\n          marketDataList.push({\n            isShow: _this5.symbolList[item].isShow,\n            id: itemData.name,\n            showName: showName,\n            data: [[{\n              iconSvg: _this5.myMarketIcon(itemData.name),\n              type: 'icon',\n              eventType: 'store'\n            }, {\n              iconSvg: iconSvg,\n              type: 'icon',\n              eventType: 'symbol',\n              classes: 'symbolName',\n              sortVal: itemData.sort,\n              key: 'sort'\n            }], [{\n              text: itemData.close.data,\n              classes: ['fontSize14'],\n              sortVal: itemData.closes,\n              key: 'closes',\n              subContent: {\n                text: itemData.close.price !== '--' ? \"\\u2248 \".concat(itemData.close.price) : itemData.close.price,\n                classes: ['b-2-cl'] // 默认没有\n\n              }\n            }], [{\n              type: 'label',\n              text: itemData.rose.data,\n              sortVal: itemData.roses,\n              key: 'roses',\n              classes: _this5.itemRoseClass(itemData.rose)\n            }], [{\n              text: itemData.high\n            }], [{\n              text: itemData.low\n            }], [{\n              text: itemData.vol\n            }], [{\n              text: itemData.amount\n            }]]\n          });\n        }\n      });\n      this.marketDataList = marketDataList.sort(function (a, b) {\n        return a.sort - b.sort;\n      });\n    },\n    // 设置币对是否收藏的ICON\n    myMarketIcon: function myMarketIcon(symbol) {\n      if (this.mySymbolList.indexOf(symbol) === -1) {\n        return \"<svg class=\\\"icon icon-16\\\" aria-hidden=\\\"true\\\">\\n                <use xlink:href=\\\"#icon-c_11\\\">\\n              </use></svg>\";\n      }\n\n      return \"<svg class=\\\"icon icon-16\\\" aria-hidden=\\\"true\\\">\\n                <use xlink:href=\\\"#icon-c_11_1\\\">\\n              </use></svg>\";\n    },\n    // 设置 自选币对\n    setMyMarket: function setMyMarket(symbol) {\n      var _this6 = this;\n\n      var url = this.$store.state.url.common.optional_symbol;\n\n      if (this.optionalSymbolServerOpen === 1) {\n        url = this.$store.state.url.common.optional_symbols;\n      } // 防止重复点击\n\n\n      if (!this.setMyMarketSwitch) return;\n      this.setMyMarketSwitch = false;\n      var mySymbol = myStorage.get('mySymbol') || [];\n      var addOrDelete = true;\n\n      if (mySymbol.length && mySymbol.indexOf(symbol) > -1) {\n        mySymbol = mySymbol.filter(function (item) {\n          return item !== symbol;\n        });\n        addOrDelete = false;\n      } else {\n        mySymbol.push(symbol);\n        addOrDelete = true;\n      }\n\n      if (this.optionalSymbolServerOpen === 1 && this.isLogin) {\n        this.axios({\n          url: url,\n          headers: {},\n          params: {\n            operationType: addOrDelete === true ? '1' : '2',\n            // 0批量添加 1单个添加 2单个删除\n            symbols: symbol\n          },\n          method: 'post'\n        }).then(function (data) {\n          if (data.code === '0') {\n            _this6.setMyMarketSwitch = true;\n            _this6.mySymbolList = mySymbol;\n            myStorage.set('mySymbol', mySymbol);\n          } else {\n            _this6.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'error'\n            });\n          }\n        });\n      } else {\n        this.setMyMarketSwitch = true;\n        this.mySymbolList = mySymbol;\n        myStorage.set('mySymbol', mySymbol);\n      }\n    },\n    // 24小时行情 涨跌幅 的背景、样色的class\n    itemRoseClass: function itemRoseClass(rose) {\n      var bgClass = null;\n\n      if (rose.class === 'u-1-cl') {\n        bgClass = 'rose-label u-3-bg';\n      } else if (rose.class === 'u-4-cl') {\n        bgClass = 'rose-label u-6-bg';\n      }\n\n      return [rose.class, bgClass];\n    },\n    closeRecommend: function closeRecommend() {\n      this.isShowRecommend = false;\n    }\n  }\n};",{"version":3,"sources":["/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/market/index/index.js"],"names":["mapState","worker","myStorage","getCoinShowName","data","marketData","MywebSocket","marketCurrent","symbolCurrent","symbolCurrentList","listfilter","tableLoading","lineNumber","marketDataObj","marketDataList","recommendDataList","klineDataList","mySymbolList","get","setMyMarketSwitch","isShowRecommend","computed","coinTagLangs","$store","state","baseData","coinTagOpen","coin_tag_open","baseInfo","market","symbolAll","currentMarketList","coinList","symbolList","mySymbol","marketList","length","forEach","item","rateData","rate","isLogin","optionalSymbolServerOpen","optional_symbol_server_open","watch","val","oldVal","webSocketSend","wsUrl","postMessage","type","lan","klneSend","$bus","$emit","beforeDestroy","window","onscroll","methods","init","onmessageWorker","$on","setMarketData","setMyMarket","setRecommendData","symbolArr","toLowerCase","split","symbol","oldSymbolArr","oldSsymbol","lastTimeS","lTime","number","onmessage","event","listenWSData","WsData","indexOf","channel","symbolType","key","event_rep","kData","lengthNumber","slice","push","id","close","tick","keyYs","lengths","lastId","pop","shift","sendType","symbolData","getCoinLabel","name","toUpperCase","coinTag","keyarr","Object","keys","newcoinFlag","itemData","showName","coinLabel","iconSvg","str","isShow","myMarketIcon","eventType","classes","sortVal","sort","text","closes","subContent","price","rose","roses","itemRoseClass","high","low","vol","amount","a","b","url","common","optional_symbol","optional_symbols","addOrDelete","filter","axios","headers","params","operationType","symbols","method","then","code","set","msg","bgClass","class","closeRecommend"],"mappings":"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","sourcesContent":["import { mapState } from 'vuex';\r\nimport worker from '@/utils/webWorker';\r\nimport {\r\n  myStorage, getCoinShowName,\r\n} from '@/utils';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      // 市场数据\r\n      marketData: null,\r\n      // MywebSocket\r\n      MywebSocket: null,\r\n      // 当前市场\r\n      marketCurrent: null,\r\n      // 当前币对\r\n      symbolCurrent: null,\r\n      // 当前币对列表\r\n      symbolCurrentList: [],\r\n      // 筛选 货币对\r\n      listfilter: null,\r\n      // 表格加载LOADING\r\n      tableLoading: false,\r\n      // 表格 超过 20条出现滚动条\r\n      lineNumber: 20,\r\n      // 24小时行情WS数据\r\n      marketDataObj: [],\r\n      marketDataList: [],\r\n      // 推荐位数据\r\n      recommendDataList: {},\r\n      klineDataList: {},\r\n      // 自选币对\r\n      mySymbolList: myStorage.get('mySymbol') || [],\r\n      setMyMarketSwitch: true,\r\n      // 是否显示左侧数据栏\r\n      isShowRecommend: true,\r\n\r\n    };\r\n  },\r\n  computed: {\r\n    coinTagLangs() {\r\n      return this.$store.state.baseData.coinTagLangs;\r\n    },\r\n    coinTagOpen() {\r\n      return this.$store.state.baseData.coin_tag_open;\r\n    },\r\n    ...mapState({\r\n      baseInfo({ baseData }) {\r\n        this.marketData = baseData.market;\r\n        // 获取当前市场\r\n        this.marketCurrent = myStorage.get('homeMarkTitle');\r\n        // 获取当前币对\r\n        this.symbolCurrent = myStorage.get('sSymbolName');\r\n        return baseData;\r\n      },\r\n    }),\r\n    // WS worker\r\n    worker() {\r\n      return worker();\r\n    },\r\n    // 全部 货币对\r\n    symbolAll() {\r\n      return this.$store.state.baseData.symbolAll;\r\n    },\r\n    // 当前市场列表\r\n    currentMarketList() {\r\n      return this.marketData ? this.marketData.market : null;\r\n    },\r\n    coinList() {\r\n      if (this.$store.state.baseData.market) {\r\n        return this.$store.state.baseData.market.coinList;\r\n      }\r\n      return null;\r\n    },\r\n    // 当前币对列表\r\n    symbolList() {\r\n      // 如果 当前市场 是 自选市场\r\n      if (this.marketCurrent === 'myMarket') {\r\n        const mySymbol = myStorage.get('mySymbol') || [];\r\n        const marketList = {};\r\n        if (mySymbol.length) {\r\n          mySymbol.forEach((item) => {\r\n            if (item && this.symbolAll[item]) {\r\n              marketList[item] = this.symbolAll[item];\r\n            }\r\n          });\r\n        }\r\n        return marketList;\r\n      }\r\n      if (this.currentMarketList && this.marketCurrent) {\r\n        return this.currentMarketList[this.marketCurrent];\r\n      }\r\n      return null;\r\n    },\r\n    // 汇率单位\r\n    rateData() {\r\n      return this.$store.state.baseData.rate;\r\n    },\r\n    isLogin() {\r\n      return this.$store.state.baseData.isLogin;\r\n    },\r\n    optionalSymbolServerOpen() {\r\n      return this.$store.state.baseData.optional_symbol_server_open;\r\n    },\r\n  },\r\n  watch: {\r\n    symbolList(val, oldVal) {\r\n      if (oldVal) {\r\n        this.webSocketSend('Market', 'unsub', this.symbolCurrent, oldVal);\r\n        this.webSocketSend('Market', 'sub', this.symbolCurrent, val);\r\n      }\r\n    },\r\n    // 监听 是否登录\r\n    isLogin(val) {\r\n      if (val) {\r\n        this.mySymbolList = myStorage.get('mySymbol') || [];\r\n      }\r\n    },\r\n    // 监听获取到 market 接口的数据\r\n    marketData(val) {\r\n      if (val.wsUrl) {\r\n        // 创建WS\r\n        this.worker.postMessage({\r\n          type: 'CREAT_WEBSOCKET',\r\n          data: {\r\n            wsUrl: val.wsUrl,\r\n            lan: this.$store.state.baseData.lan,\r\n            rate: this.rateData,\r\n            symbolAll: this.symbolAll,\r\n          },\r\n        });\r\n      }\r\n    },\r\n    // 监听 webSocket 创建成功\r\n    MywebSocket(val) {\r\n      if (val) {\r\n        // 发送 24小时行情历史数据 Send\r\n        this.webSocketSend('Review', null, this.symbolCurrent, this.symbolAll);\r\n        // 发送 24小时行情实时数据 Send\r\n        this.webSocketSend('Market', 'sub', this.symbolCurrent, this.symbolList);\r\n        // 发送 推荐位 kline数据 Send\r\n        if (this.symbolCurrent) {\r\n          this.klneSend();\r\n        }\r\n      }\r\n    },\r\n    symbolCurrent(val, oldVal) {\r\n      if (val && this.MywebSocket) {\r\n        this.isShowRecommend = true;\r\n        this.klneSend(oldVal);\r\n      }\r\n    },\r\n    mySymbolList(val) {\r\n      if (val) {\r\n        this.$bus.$emit('MYSYMBOL-LIST', val);\r\n      }\r\n    },\r\n  },\r\n  beforeDestroy() {\r\n    this.webSocketSend('Market', 'unsub', this.symbolCurrent, this.symbolList);\r\n    window.onscroll = null;\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.onmessageWorker();\r\n      // 监听 市场切换\r\n      this.$bus.$on('SWITCH-MARKET', (data) => {\r\n        this.marketCurrent = data;\r\n        this.setMarketData();\r\n      });\r\n      this.$bus.$on('SWITCH-STORE', (data) => {\r\n        this.setMyMarket(data);\r\n        this.setMarketData();\r\n      });\r\n      this.$bus.$on('SWITCH-SYMBOL', (data) => {\r\n        this.symbolCurrent = data;\r\n        this.setRecommendData();\r\n      });\r\n      this.$bus.$emit('MYSYMBOL-LIST', this.mySymbolList);\r\n      // 监听 窗口的大小改变\r\n      this.$bus.$on('WINFOW_ON_RESIIZE', () => {\r\n        this.isShowRecommend = true;\r\n      });\r\n    },\r\n    klneSend(oldVal) {\r\n      const symbolArr = this.symbolCurrent.toLowerCase().split('/');\r\n      const symbol = symbolArr[0] + symbolArr[1];\r\n      if (oldVal) {\r\n        const oldSymbolArr = oldVal.toLowerCase().split('/');\r\n        const oldSsymbol = oldSymbolArr[0] + oldSymbolArr[1];\r\n        this.worker.postMessage({\r\n          type: 'WEBSOCKET_KLINE_SEND',\r\n          data: {\r\n            symbol: oldSsymbol,\r\n            type: 'unsub',\r\n            lastTimeS: '1min',\r\n          },\r\n        });\r\n      }\r\n      this.worker.postMessage({\r\n        type: 'WEBSOCKET_KLINE_SEND',\r\n        data: {\r\n          symbol,\r\n          type: 'req',\r\n          lastTimeS: '1min',\r\n          lTime: false,\r\n          number: 100,\r\n          symbolCurrent: this.symbolCurrent,\r\n        },\r\n      });\r\n      this.worker.postMessage({\r\n        type: 'WEBSOCKET_KLINE_SEND',\r\n        data: {\r\n          symbol,\r\n          type: 'sub',\r\n          lastTimeS: '1min',\r\n          lTime: false,\r\n          symbolCurrent: this.symbolCurrent,\r\n        },\r\n      });\r\n    },\r\n    onmessageWorker() {\r\n      this.worker.onmessage = (event) => {\r\n        const { data } = event;\r\n        // 监听 WebSocket 链接成功\r\n        if (data.type === 'WEBSOCKET_ON_OPEN') {\r\n          this.MywebSocket = data.data.type;\r\n        }\r\n        // 监听 WS 数据\r\n        if (data.type === 'WEBSOCKET_DATA') {\r\n          this.listenWSData(data.data);\r\n        }\r\n      };\r\n    },\r\n    // 监听 WS 返回的数据\r\n    listenWSData(data) {\r\n      const { type, WsData } = data;\r\n      // 24小时行情数据\r\n      if (type === 'MARKET_DATA') {\r\n        this.marketDataObj = WsData;\r\n        this.setMarketData();\r\n        this.setRecommendData();\r\n      }\r\n      if (type.indexOf('KLINE_DATA') > -1) {\r\n        const [, symbolType] = WsData.channel.split('_');\r\n        const key = this.symbolCurrent;\r\n        const symbolArr = this.symbolCurrent.toLowerCase().split('/');\r\n        const symbol = symbolArr[0] + symbolArr[1];\r\n        if (symbol === symbolType) {\r\n          if (WsData.event_rep === 'rep') {\r\n            const kData = WsData.data;\r\n\r\n            this.klineDataList[key] = [];\r\n            const lengthNumber = kData.slice(-20);\r\n            lengthNumber.forEach((item) => {\r\n              this.klineDataList[key].push([\r\n                item.id,\r\n                item.close,\r\n              ]);\r\n            });\r\n          } else {\r\n            const kData = WsData.tick;\r\n            const keyYs = this.klineDataList[key] || [];\r\n            const lengths = keyYs.length;\r\n            if (this.klineDataList[key].length) {\r\n              const lastId = this.klineDataList[key][lengths - 1][0];\r\n              if (lastId === kData.id) {\r\n                this.klineDataList[key].pop();\r\n              }\r\n              if (this.klineDataList[key].length > 20) {\r\n                this.klineDataList[key].shift();\r\n              }\r\n              if (lastId <= kData.id) {\r\n                this.klineDataList[key].push([\r\n                  kData.id,\r\n                  kData.close,\r\n                ]);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        this.$bus.$emit('RECOMMEEND_KLINE_DATA', this.klineDataList);\r\n      }\r\n    },\r\n    // 发送 Send\r\n    webSocketSend(type, sendType, symbolData, symbolList) {\r\n      this.worker.postMessage({\r\n        type: 'WEBSOCKET_SEND',\r\n        data: {\r\n          type,\r\n          sendType,\r\n          symbolData,\r\n          symbolList,\r\n        },\r\n      });\r\n    },\r\n    // 格式化 推荐位的 K线数据\r\n    setRecommendData() {\r\n      if (this.marketDataObj && this.marketDataObj[this.symbolCurrent]) {\r\n        this.$bus.$emit('RECOMMEEND_DATA', this.marketDataObj[this.symbolCurrent]);\r\n      }\r\n    },\r\n    getCoinLabel(name, coinList = {}) {\r\n      if (coinList && coinList[name.toUpperCase()]) {\r\n        const { coinTag = '' } = coinList[name.toUpperCase()];\r\n        return coinTag ? this.coinTagLangs[coinTag] : '';\r\n      }\r\n\r\n      return '';\r\n    },\r\n    // 格式化 推荐位的24小时行情数据\r\n    setMarketData() {\r\n      if (!this.symbolList) return;\r\n      const marketDataList = [];\r\n      const keyarr = Object.keys(this.symbolList);\r\n      keyarr.forEach((item) => {\r\n        if (this.symbolList[item].newcoinFlag) {\r\n          this.newcoinFlag = true;\r\n        }\r\n        const itemData = this.marketDataObj[item];\r\n        if (itemData) {\r\n          const showName = getCoinShowName(itemData.name, this.symbolAll);\r\n          const coinLabel = this.getCoinLabel(itemData.symbol.symbol, this.coinList);\r\n          let iconSvg = `<span>${showName}</span>`;\r\n          if (coinLabel && this.coinTagOpen) {\r\n            const str = `<div class=\"coin-label\">\r\n              <span class=\"coin-text a-12-cl\">${coinLabel}</span>\r\n              <span class=\"coin-bg a-12-bg\"></span>\r\n            </div>`;\r\n            iconSvg = `${iconSvg}${str}`;\r\n          }\r\n          marketDataList.push({\r\n            isShow: this.symbolList[item].isShow,\r\n            id: itemData.name,\r\n            showName,\r\n            data: [\r\n              [\r\n                {\r\n                  iconSvg: this.myMarketIcon(itemData.name),\r\n                  type: 'icon',\r\n                  eventType: 'store',\r\n                },\r\n                {\r\n                  iconSvg,\r\n                  type: 'icon',\r\n                  eventType: 'symbol',\r\n                  classes: 'symbolName',\r\n                  sortVal: itemData.sort,\r\n                  key: 'sort',\r\n                },\r\n              ],\r\n              [\r\n                {\r\n                  text: itemData.close.data,\r\n                  classes: ['fontSize14'],\r\n                  sortVal: itemData.closes,\r\n                  key: 'closes',\r\n                  subContent: {\r\n                    text: itemData.close.price !== '--' ? `≈ ${itemData.close.price}` : itemData.close.price,\r\n                    classes: ['b-2-cl'], // 默认没有\r\n                  },\r\n                },\r\n              ],\r\n              [\r\n                {\r\n                  type: 'label',\r\n                  text: itemData.rose.data,\r\n                  sortVal: itemData.roses,\r\n                  key: 'roses',\r\n                  classes: this.itemRoseClass(itemData.rose),\r\n                },\r\n              ],\r\n              [\r\n                {\r\n                  text: itemData.high,\r\n                },\r\n              ],\r\n              [\r\n                {\r\n                  text: itemData.low,\r\n                },\r\n              ],\r\n              [\r\n                {\r\n                  text: itemData.vol,\r\n                },\r\n              ],\r\n              [\r\n                {\r\n                  text: itemData.amount,\r\n                },\r\n              ],\r\n            ],\r\n          });\r\n        }\r\n      });\r\n      this.marketDataList = marketDataList.sort((a, b) => a.sort - b.sort);\r\n    },\r\n    // 设置币对是否收藏的ICON\r\n    myMarketIcon(symbol) {\r\n      if (this.mySymbolList.indexOf(symbol) === -1) {\r\n        return `<svg class=\"icon icon-16\" aria-hidden=\"true\">\r\n                <use xlink:href=\"#icon-c_11\">\r\n              </use></svg>`;\r\n      }\r\n      return `<svg class=\"icon icon-16\" aria-hidden=\"true\">\r\n                <use xlink:href=\"#icon-c_11_1\">\r\n              </use></svg>`;\r\n    },\r\n    // 设置 自选币对\r\n    setMyMarket(symbol) {\r\n      let url = this.$store.state.url.common.optional_symbol;\r\n      if (this.optionalSymbolServerOpen === 1) {\r\n        url = this.$store.state.url.common.optional_symbols;\r\n      }\r\n      // 防止重复点击\r\n      if (!this.setMyMarketSwitch) return;\r\n      this.setMyMarketSwitch = false;\r\n\r\n      let mySymbol = myStorage.get('mySymbol') || [];\r\n      let addOrDelete = true;\r\n      if (mySymbol.length && mySymbol.indexOf(symbol) > -1) {\r\n        mySymbol = mySymbol.filter((item) => item !== symbol);\r\n        addOrDelete = false;\r\n      } else {\r\n        mySymbol.push(symbol);\r\n        addOrDelete = true;\r\n      }\r\n      if (this.optionalSymbolServerOpen === 1 && this.isLogin) {\r\n        this.axios({\r\n          url,\r\n          headers: {},\r\n          params: {\r\n            operationType: addOrDelete === true ? '1' : '2', // 0批量添加 1单个添加 2单个删除\r\n            symbols: symbol,\r\n          },\r\n          method: 'post',\r\n        }).then((data) => {\r\n          if (data.code === '0') {\r\n            this.setMyMarketSwitch = true;\r\n            this.mySymbolList = mySymbol;\r\n            myStorage.set('mySymbol', mySymbol);\r\n          } else {\r\n            this.$bus.$emit('tip', { text: data.msg, type: 'error' });\r\n          }\r\n        });\r\n      } else {\r\n        this.setMyMarketSwitch = true;\r\n        this.mySymbolList = mySymbol;\r\n        myStorage.set('mySymbol', mySymbol);\r\n      }\r\n    },\r\n    // 24小时行情 涨跌幅 的背景、样色的class\r\n    itemRoseClass(rose) {\r\n      let bgClass = null;\r\n      if (rose.class === 'u-1-cl') {\r\n        bgClass = 'rose-label u-3-bg';\r\n      } else if (rose.class === 'u-4-cl') {\r\n        bgClass = 'rose-label u-6-bg';\r\n      }\r\n      return [rose.class, bgClass];\r\n    },\r\n    closeRecommend() {\r\n      this.isShowRecommend = false;\r\n    },\r\n  },\r\n};\r\n"]}]}