{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/assets/lerverageFlowingWater/lerverageFlowingWater.js","dependencies":[{"path":"/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/assets/lerverageFlowingWater/lerverageFlowingWater.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.function.name\";\nimport { fixD, formatTime, getCoinShowName, colorMap, imgMap } from '@/utils';\nexport default {\n  name: 'page-flowingWater',\n  data: function data() {\n    return {\n      imgMap: imgMap,\n      colorMap: colorMap,\n      tabelLoading: true,\n      nowType: 1,\n      // 1为当前借贷 2为历史借贷 3为划转记录\n      symbol: '',\n      // 当前币种 (当前借贷/历史借贷使用)\n      tabelList: [],\n      // table数据列表\n      symbolList: [],\n      // 币种选择列表\n      otherType: '0',\n      // 其他记录 type\n      paginationObj: {\n        total: 0,\n        // 数据总条数\n        display: 10,\n        // 每页显示条数\n        currentPage: 1 // 当前页码\n\n      },\n      revokeList: [],\n      // 撤销队列\n      subContent: [],\n      // 展开的数据\n      subColumns: [],\n      // 展开的表头\n      subContentId: 0,\n      // 展开的id\n      subLoading: false,\n      // 展开的loading\n      dataList: {},\n      messData: null\n    };\n  },\n  computed: {\n    otherTypeList: function otherTypeList() {\n      return [// 全部\n      {\n        code: '0',\n        value: this.$t('assets.lerverageFlowingWater.directionAll')\n      }, // 转入杠杆\n      {\n        code: '1',\n        value: this.$t('assets.lerverageFlowingWater.directionIn')\n      }, // 转出杠杆\n      {\n        code: '2',\n        value: this.$t('assets.lerverageFlowingWater.directionOut')\n      }];\n    },\n    navTab: function navTab() {\n      var arr = [// 当前借贷\n      {\n        name: this.$t('assets.lerverageFlowingWater.tab1'),\n        index: 1\n      }, // 历史借贷\n      {\n        name: this.$t('assets.lerverageFlowingWater.tab2'),\n        index: 2\n      }, // 划转记录\n      {\n        name: this.$t('assets.lerverageFlowingWater.tab3'),\n        index: 3\n      }];\n      return arr;\n    },\n    // market 接口\n    market: function market() {\n      return this.$store.state.baseData.market;\n    },\n    // 表格title\n    columns: function columns() {\n      var list = [];\n\n      if (this.nowType === 1) {\n        list = [{\n          title: this.$t('assets.lerverageFlowingWater.tab1List1'),\n          width: '10%'\n        }, // 申请时间\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab1List2'),\n          width: '10%'\n        }, // 杠杆账户\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab1List3'),\n          width: '10%'\n        }, // 币种\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab1List4'),\n          width: '15%'\n        }, // 数量\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab1List5'),\n          width: '10%'\n        }, // 利率\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab1List6'),\n          width: '15%'\n        }, // 未还利息\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab1List7'),\n          width: '15%'\n        }, // 未还数量\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab1List8'),\n          width: '15%'\n        } // 操作\n        ];\n      }\n\n      if (this.nowType === 2) {\n        list = [{\n          title: this.$t('assets.lerverageFlowingWater.tab2List1'),\n          width: '10%'\n        }, // 申请时间\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab2List2'),\n          width: '10%'\n        }, // 杠杆账户\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab2List3'),\n          width: '10%'\n        }, // 币种\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab2List4'),\n          width: '15%'\n        }, // 数量\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab2List5'),\n          width: '15%'\n        }, // 利率\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab2List6'),\n          width: '15%'\n        }, // 未还利息\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab2List7'),\n          width: '15%'\n        }, // 操作\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab1List8'),\n          width: '10%'\n        } // 操作\n        ];\n      }\n\n      if (this.nowType === 3) {\n        list = [{\n          title: this.$t('assets.lerverageFlowingWater.tab3List1'),\n          width: '10%'\n        }, // 时间\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab3List2'),\n          width: '20%'\n        }, // 杠杆账户\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab3List3'),\n          width: '20%'\n        }, // 币种\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab3List4'),\n          width: '30%'\n        }, // 数量\n        {\n          title: this.$t('assets.lerverageFlowingWater.tab3List5'),\n          width: '20%'\n        } // 方向\n        ];\n      }\n\n      return list;\n    },\n    // 用于axios的symbol\n    axiosSymbol: function axiosSymbol() {\n      if (this.symbol === 'all') {\n        return null;\n      }\n\n      return this.symbol;\n    },\n    newcoinOpen: function newcoinOpen() {\n      return this.$store.state.baseData.newcoinOpen;\n    }\n  },\n  watch: {\n    market: function market(v) {\n      if (v && this.messData) {\n        this.setData();\n      }\n    },\n    messData: function messData(v) {\n      if (v && this.market) {\n        this.setData();\n      }\n    }\n  },\n  methods: {\n    init: function init() {\n      this.getMess();\n\n      if (this.market && this.messData) {\n        this.setData();\n      }\n    },\n    getShowSymbol: function getShowSymbol(v, coin) {\n      if (!this.market) return v;\n      var market = this.market.market;\n      var showSymbol = v;\n\n      if (this.market && market) {\n        var obj = market[coin][v];\n        showSymbol = obj.showName || obj.name;\n      }\n\n      return showSymbol;\n    },\n    getShowCoin: function getShowCoin(v) {\n      if (!this.market) return v;\n      var coinList = this.market.coinList;\n      var str = v;\n\n      if (this.market && coinList) {\n        str = getCoinShowName(v, coinList);\n      }\n\n      return str;\n    },\n    getMess: function getMess() {\n      var _this = this;\n\n      this.axios({\n        url: '/lever/finance/balance'\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          var arr = [];\n          Object.keys(data.data.leverMap).forEach(function (item) {\n            var sp = item.split('/');\n            arr[sp[0] + sp[1]] = data.data.leverMap[item];\n          });\n          _this.messData = arr;\n        }\n      });\n    },\n    symbolChange: function symbolChange(item) {\n      this.symbol = item.code;\n      this.paginationObj.currentPage = 1; // 页码\n\n      this.paginationObj.total = 0; // 总条数\n\n      this.tabelList = [];\n      this.tabelLoading = true;\n      this.getData();\n    },\n    otherTypeChange: function otherTypeChange(item) {\n      this.otherType = item.code;\n      this.paginationObj.currentPage = 1; // 页码\n\n      this.paginationObj.total = 0; // 总条数\n\n      this.tabelList = [];\n      this.tabelLoading = true;\n      this.getData();\n    },\n    // tab切换\n    currentType: function currentType(item) {\n      this.nowType = item.index; // this.symbol = 'all'\n\n      this.paginationObj.currentPage = 1; // 页码\n\n      this.paginationObj.total = 0; // 总条数\n\n      this.tabelList = [];\n      this.tabelLoading = true;\n      this.getData();\n    },\n    rateFixFn: function rateFixFn(v) {\n      return \"\".concat(fixD(v * 100, 2), \"%\");\n    },\n    setData: function setData() {\n      var _this2 = this;\n\n      var list = [{\n        code: 'all',\n        value: this.$t('assets.lerverageFlowingWater.allCoin')\n      }];\n      var market = this.market.market;\n      Object.keys(market).forEach(function (item) {\n        Object.keys(market[item]).forEach(function (cv) {\n          var obj = market[item][cv];\n\n          if (obj.is_open_lever) {\n            list.push({\n              code: obj.symbol,\n              value: _this2.getShowSymbol(obj.name, item)\n            });\n          }\n        });\n      });\n      this.symbolList = list;\n      this.symbol = 'all';\n      this.getData();\n    },\n    getData: function getData() {\n      if (this.nowType === 1) {\n        this.rechargeData();\n      } else if (this.nowType === 2) {\n        this.withdrawData();\n      } else {\n        this.otherData();\n      }\n    },\n    repaymentSuccess: function repaymentSuccess() {\n      this.getData();\n    },\n    pagechange: function pagechange(v) {\n      this.paginationObj.currentPage = v;\n      this.getData();\n    },\n    tableClick: function tableClick(type, data) {\n      if (type === 'repayment') {\n        var Did = data.split('_')[1];\n        var obj = this.dataList[Did];\n        this.$bus.$emit('coRepayment', obj);\n      } else if (type === 'details') {\n        this.getSubTableData(data);\n      }\n    },\n    typeText: function typeText(v) {\n      var str = '';\n\n      switch (v) {\n        case '1':\n          str = this.$t('assets.leverageToLoan.typeText1');\n          break;\n\n        case '2':\n          str = this.$t('assets.leverageToLoan.typeText2');\n          break;\n\n        default:\n          str = this.$t('assets.leverageToLoan.typeText3');\n      }\n\n      return str;\n    },\n    // 查看详情\n    getSubTableData: function getSubTableData(v) {\n      var _this3 = this;\n\n      if (v.open) {\n        var sp = v.id.split('_');\n        var vID = Number(sp[1]); // const symbol = sp[0];\n\n        this.subContentId = v.id;\n        this.subColumns = [this.$t('order.exchangeOrder.detailsTime'), // 时间\n        this.$t('assets.leverageToLoan.list3'), // 币种\n        this.$t('order.exchangeOrder.detailsVolume'), // 数量\n        this.$t('assets.flowingWater.type') // 类型\n        ];\n        this.subContent = [];\n        this.subLoading = true;\n        this.axios({\n          url: '/lever/return/info',\n          method: 'post',\n          params: {\n            id: vID.toString(),\n            pageSize: 10000\n          }\n        }).then(function (data) {\n          if (v.id !== _this3.subContentId) {\n            return;\n          }\n\n          if (data.code.toString() === '0') {\n            var list = [];\n            data.data.financeList.forEach(function (item) {\n              // const [baseCoin, countCoin] = this.symbol.split('/');\n              // const { marketFix, coinFix } = this.getFix(countCoin, baseCoin);\n              // const obj = this.messData[symbol] || {};\n              // let returnFix = obj.baseReturnPrecision || 8;\n              var returnFix = 8; // if (item.coin === obj.quoteCoin) {\n              //   returnFix = obj.quoteReturnPrecision || 8;\n              // }\n\n              list.push({\n                ctime: formatTime(Number(item.repaymentTime)),\n                coin: _this3.getShowCoin(item.coin),\n                volume: fixD(item.returnMoney, returnFix),\n                type: _this3.typeText(item.type.toString())\n              });\n            });\n            _this3.subLoading = false;\n            _this3.subContent = list;\n          } else {\n            _this3.subLoading = false;\n\n            _this3.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'error'\n            });\n          }\n        });\n      }\n    },\n    // 当前借贷数据数据\n    rechargeData: function rechargeData() {\n      var _this4 = this;\n\n      this.axios({\n        url: 'lever/borrow/new',\n        params: {\n          pageSize: this.paginationObj.display,\n          // 每页条数\n          page: this.paginationObj.currentPage,\n          // 页码\n          symbol: this.axiosSymbol\n        }\n      }).then(function (data) {\n        if (_this4.nowType !== 1) return;\n\n        if (data.code.toString() === '0') {\n          var list = [];\n          data.data.financeList.forEach(function (item) {\n            var coinList = _this4.market.coinList;\n            var fix = coinList[item.coin] && coinList[item.coin].showPrecision || 0;\n            var obj = _this4.messData[item.symbol] || {};\n            var returnFix = obj.baseReturnPrecision || 8;\n\n            if (item.coin === obj.quoteCoin) {\n              returnFix = obj.quoteReturnPrecision || 8;\n            } // 新增修改精度为 8\n\n\n            returnFix = 8;\n            fix = 8;\n            _this4.dataList[item.id] = item;\n            list.push({\n              id: \"\".concat(item.symbol, \"_\").concat(item.id),\n              data: [formatTime(Number(item.ctime)), item.showName || item.symbol.toUpperCase(), _this4.getShowCoin(item.coin.toUpperCase()), fixD(item.borrowMoney, fix), _this4.rateFixFn(item.interestRate), fixD(item.oweInterest, returnFix), fixD(item.oweAmount, returnFix), [{\n                type: 'subTable',\n                // 'link' ' button' ,'html', 'label', 'icon' ‘str’\n                text: _this4.$t('order.exchangeOrder.details'),\n                // 详情\n                eventType: 'details'\n              }, {\n                type: 'button',\n                // 'link' ' button' ,'html', 'label', 'icon' ‘str’\n                text: _this4.$t('assets.lerverageFlowingWater.repayment'),\n                // 归还\n                eventType: 'repayment'\n              }]]\n            });\n          });\n          _this4.tabelLoading = false;\n          _this4.tabelList = list;\n          _this4.paginationObj.total = data.data.count;\n        }\n      });\n    },\n    getHisStatus: function getHisStatus(status) {\n      var str = '';\n\n      switch (status) {\n        case 1:\n          str = this.$t('assets.lerverageFlowingWater.status1');\n          break;\n\n        case 2:\n          str = this.$t('assets.lerverageFlowingWater.status2');\n          break;\n\n        case 3:\n          str = this.$t('assets.lerverageFlowingWater.status3');\n          break;\n\n        case 4:\n          str = this.$t('assets.lerverageFlowingWater.status4');\n          break;\n\n        case 5:\n          str = this.$t('assets.lerverageFlowingWater.status5');\n          break;\n\n        case 6:\n          str = this.$t('assets.lerverageFlowingWater.status6');\n          break;\n\n        case 7:\n          str = this.$t('assets.lerverageFlowingWater.status7');\n          break;\n\n        default:\n          str = '';\n      }\n\n      return str;\n    },\n    withdrawData: function withdrawData() {\n      var _this5 = this;\n\n      this.axios({\n        url: '/lever/borrow/history',\n        params: {\n          pageSize: this.paginationObj.display,\n          // 每页条数\n          page: this.paginationObj.currentPage,\n          // 页码\n          symbol: this.axiosSymbol\n        }\n      }).then(function (data) {\n        if (_this5.nowType !== 2) return;\n\n        if (data.code.toString() === '0') {\n          var list = [];\n          data.data.financeList.forEach(function (item) {\n            var coinList = _this5.market.coinList;\n            var fix = coinList[item.coin] && coinList[item.coin].showPrecision || 0;\n            var obj = _this5.messData[item.symbol] || {};\n            var returnFix = obj.baseReturnPrecision;\n\n            if (item.coin === obj.quoteCoin) {\n              returnFix = obj.quoteReturnPrecision || 8;\n            } // 新增修改精度为 8\n\n\n            returnFix = 8;\n            fix = 8;\n            list.push({\n              id: \"\".concat(item.symbol, \"_\").concat(item.id),\n              data: [formatTime(Number(item.ctime)), item.showName || item.symbol.toUpperCase(), _this5.getShowCoin(item.coin.toUpperCase()), fixD(item.borrowMoney, fix), _this5.rateFixFn(item.interestRate), fixD(item.interest, returnFix), _this5.getHisStatus(item.status), [{\n                type: 'subTable',\n                // 'link' ' button' ,'html', 'label', 'icon' ‘str’\n                text: _this5.$t('order.exchangeOrder.details'),\n                // 详情\n                eventType: 'details'\n              }]]\n            });\n          });\n          _this5.tabelLoading = false;\n          _this5.tabelList = list;\n          _this5.paginationObj.total = data.data.count;\n        }\n      });\n    },\n    // 划转记录\n    otherData: function otherData() {\n      var _this6 = this;\n\n      this.axios({\n        url: 'lever/finance/transfer/list',\n        params: {\n          pageSize: this.paginationObj.display,\n          // 每页条数\n          page: this.paginationObj.currentPage,\n          // 页码\n          symbol: this.axiosSymbol,\n          transactionType: this.otherType === '0' ? undefined : this.otherType\n        }\n      }).then(function (data) {\n        if (_this6.nowType !== 3) return;\n\n        if (data.code.toString() === '0') {\n          var _data$data = data.data,\n              financeList = _data$data.financeList,\n              count = _data$data.count;\n          var list = [];\n          financeList.forEach(function (item, index) {\n            var coinList = _this6.market.coinList;\n            var fix = coinList[item.coinSymbol] && coinList[item.coinSymbol].showPrecision || 0;\n            fix = 8;\n            var side = item.transferType === 1 ? _this6.$t('assets.lerverageFlowingWater.directionIn') : _this6.$t('assets.lerverageFlowingWater.directionOut'); // 状态\n\n            list.push({\n              id: index,\n              data: [formatTime(item.createTime), // 时间\n              item.showName || item.symbol, // 杠杆账户\n              _this6.getShowCoin(item.coinSymbol), // 币种\n              fixD(item.amount, fix), // 数量\n              [{\n                text: side,\n                classes: item.transferType === 1 ? 'e-5-cl' : 'e-6-cl'\n              }]]\n            });\n          });\n          _this6.tabelLoading = false;\n          _this6.tabelList = list;\n          _this6.paginationObj.total = count;\n        }\n      });\n    }\n  }\n};",null]}