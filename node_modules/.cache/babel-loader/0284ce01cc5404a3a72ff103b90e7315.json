{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/assets/leverageToLoan/leverageToLoan.js","dependencies":[{"path":"/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/assets/leverageToLoan/leverageToLoan.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport { fixD, fixInput, formatTime, getCoinShowName, colorMap, imgMap } from '@/utils';\nexport default {\n  name: 'page-withdraw',\n  data: function data() {\n    return {\n      tabelLoading: true,\n      imgMap: imgMap,\n      colorMap: colorMap,\n      tabelList: [],\n      paginationObj: {\n        total: 0,\n        // 数据总条数\n        display: 10,\n        // 每页显示条数\n        currentPage: 1 // 当前页码\n\n      },\n      messData: {},\n      // 当前币对信息\n      broCoin: '',\n      // 当前借贷的币种\n      broNum: '',\n      // 借贷数量\n      btnLoading: false,\n      // loading\n      subContent: [],\n      // 展开的数据\n      subColumns: [],\n      // 展开的表头\n      subContentId: 0,\n      // 展开的id\n      subLoading: false,\n      // 展开的loading\n      dataList: {}\n    };\n  },\n  filters: {\n    fixDFn: function fixDFn(v, that, type) {\n      return fixD(v, that.coinFix[type]);\n    },\n    fixDFnTwo: function fixDFnTwo(v, type) {\n      return fixD(v, type);\n    },\n    rateFix: function rateFix(v) {\n      var data = v || 0;\n      return \"\".concat(fixD(data * 100, 2), \"%\");\n    }\n  },\n  watch: {\n    messData: function messData(v) {\n      if (Object.keys(v).length) {\n        this.broCoin = v.baseCoin;\n\n        if (Object.keys(this.market).length) {\n          this.getTableList();\n        }\n      }\n    },\n    market: function market(v) {\n      if (Object.keys(v).length && Object.keys(this.messData).length) {\n        this.getTableList();\n      }\n    },\n    broNum: function broNum(v) {\n      this.broNum = fixInput(v, 3);\n    }\n  },\n  computed: {\n    btnDisabled: function btnDisabled() {\n      var flag = true;\n\n      if (this.broErrorObj.flag || this.btnLoading) {\n        flag = false;\n      }\n\n      return flag;\n    },\n    // 借贷币种的信息\n    broMessage: function broMessage() {\n      var obj = {\n        total: '0',\n        // 总额度\n        can: '0',\n        // 可借\n        borrowed: '0',\n        // 已借\n        type: 'base',\n        min: '0' // 最小借贷量\n\n      };\n      var _this$messData = this.messData,\n          baseCoin = _this$messData.baseCoin,\n          baseTotalBorrow = _this$messData.baseTotalBorrow,\n          baseCanBorrow = _this$messData.baseCanBorrow,\n          baseBorrowBalance = _this$messData.baseBorrowBalance,\n          baseMinBorrow = _this$messData.baseMinBorrow,\n          quoteCoin = _this$messData.quoteCoin,\n          quoteTotalBorrow = _this$messData.quoteTotalBorrow,\n          quoteCanBorrow = _this$messData.quoteCanBorrow,\n          quoteBorrowBalance = _this$messData.quoteBorrowBalance,\n          quoteMinBorrow = _this$messData.quoteMinBorrow;\n\n      if (this.broCoin === baseCoin) {\n        obj.total = baseTotalBorrow || 0;\n        obj.can = baseCanBorrow || 0;\n        obj.borrowed = baseBorrowBalance || 0;\n        obj.type = 'base';\n        obj.min = baseMinBorrow || 0;\n      } else if (this.broCoin === quoteCoin) {\n        obj.total = quoteTotalBorrow || 0;\n        obj.can = quoteCanBorrow || 0;\n        obj.borrowed = quoteBorrowBalance || 0;\n        obj.type = 'quote';\n        obj.min = quoteMinBorrow || 0;\n      }\n\n      return obj;\n    },\n    // market 接口\n    market: function market() {\n      return this.$store.state.baseData.market || {};\n    },\n    // 表格title\n    columns: function columns() {\n      return [{\n        title: this.$t('assets.leverageToLoan.list1'),\n        width: '10%'\n      }, // 申请时间\n      {\n        title: this.$t('assets.leverageToLoan.list2'),\n        width: '10%',\n        align: 'left'\n      }, // 杠杆账户\n      {\n        title: this.$t('assets.leverageToLoan.list3'),\n        width: '10%'\n      }, // 币种\n      {\n        title: this.$t('assets.leverageToLoan.list4'),\n        width: '15%'\n      }, // 数量\n      {\n        title: this.$t('assets.leverageToLoan.list5'),\n        width: '10%'\n      }, // 利率\n      {\n        title: this.$t('assets.leverageToLoan.list6'),\n        width: '15%'\n      }, // 未还利息\n      {\n        title: this.$t('assets.leverageToLoan.list7'),\n        width: '15%'\n      }, // 未还数量\n      {\n        title: this.$t('assets.leverageToLoan.list8'),\n        width: '15%'\n      } // 操作\n      ];\n    },\n    coinFix: function coinFix() {\n      var coinList = this.market.coinList;\n      var obj = {\n        base: 0,\n        quote: 0\n      };\n\n      if (coinList && Object.keys(this.messData).length) {\n        var _this$messData2 = this.messData,\n            baseCoin = _this$messData2.baseCoin,\n            quoteCoin = _this$messData2.quoteCoin;\n\n        if (coinList[baseCoin]) {\n          obj.base = coinList[baseCoin].showPrecision;\n        }\n\n        if (coinList[quoteCoin]) {\n          obj.quote = coinList[quoteCoin].showPrecision;\n        }\n      }\n\n      return obj;\n    },\n    broWarningText: function broWarningText() {\n      var can = this.broMessage.can; // const num = fixD(can, this.coinFix[type]);\n\n      var num = fixD(can, 3);\n      return \"\".concat(this.$t('assets.leverageToLoan.canToLoan'), \" \").concat(num, \"\\n        \").concat(this.getShowCoin(this.broCoin));\n    },\n    broErrorObj: function broErrorObj() {\n      var obj = {\n        flag: false,\n        // 是否通过验证\n        text: '',\n        // 错误文案\n        showError: false // 是否提示错误\n\n      };\n\n      if (Number(this.broNum) === 0) {\n        obj.flag = false;\n        obj.text = '';\n        obj.showError = false;\n      } else if (Number(this.broNum) > Number(this.broMessage.can)) {\n        obj.flag = false; // 借贷数量不得大于可借贷数量\n\n        obj.text = this.$t('assets.leverageToLoan.inputError1');\n        obj.showError = true;\n      } else if (Number(this.broNum) < Number(this.broMessage.min)) {\n        obj.flag = false;\n        var _this$broMessage = this.broMessage,\n            min = _this$broMessage.min,\n            type = _this$broMessage.type;\n        var num = fixD(min, this.coinFix[type]); // 借贷数量不得小于\n\n        var str = this.$t('assets.leverageToLoan.inputError2');\n        obj.text = \"\".concat(str, \" \").concat(num, \" \").concat(this.broCoin);\n        obj.showError = true;\n      } else {\n        obj.flag = true;\n        obj.text = '';\n        obj.showError = false;\n      }\n\n      return obj;\n    }\n  },\n  methods: {\n    init: function init() {\n      // 如果不存在币种跳走\n      if (this.$route.query.symbol) {\n        this.symbol = this.$route.query.symbol.toUpperCase();\n      } else {\n        this.$router.push('/assets/leverageAccount');\n        return;\n      }\n\n      this.getData();\n\n      if (Object.keys(this.market).length && Object.keys(this.messData).length) {\n        this.getTableList();\n      }\n    },\n    getShowSymbol: function getShowSymbol(v) {\n      if (!this.market) return v;\n      var market = this.market.market;\n      var showSymbol = v;\n\n      if (this.market && market) {\n        var obj = market[this.messData.quoteCoin][this.messData.name];\n        showSymbol = obj.showName || obj.name;\n      }\n\n      return showSymbol;\n    },\n    getShowCoin: function getShowCoin(v) {\n      if (!this.market) return v;\n      var coinList = this.market.coinList;\n      var str = v;\n\n      if (this.market && coinList) {\n        str = getCoinShowName(v, coinList);\n      }\n\n      return str;\n    },\n    rateFixFn: function rateFixFn(v) {\n      return \"\".concat(fixD(v * 100, 2), \"%\");\n    },\n    // 全部借贷\n    allBro: function allBro() {\n      this.broNum = this.broMessage.can;\n    },\n    transferSuccess: function transferSuccess() {\n      this.getData();\n    },\n    repaymentSuccess: function repaymentSuccess() {\n      this.getData();\n      this.getTableList();\n    },\n    getData: function getData() {\n      var _this = this;\n\n      var params = {\n        symbol: this.symbol\n      }; // fetch('http://localhost:7001/financeLeverageFinance').then((data) => {\n      //   return data.json()\n      // }).then((data) => {\n      //   if(data.code.toString() === '0') {\n      //     this.messData = data.data\n      //   }\n      // })\n\n      this.axios({\n        url: '/lever/finance/symbol/balance',\n        params: params\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          _this.messData = data.data;\n        }\n      });\n    },\n    // 分页器\n    pagechange: function pagechange(v) {\n      this.paginationObj.currentPage = v;\n      this.getTableList();\n    },\n    // 划转\n    transfer: function transfer(coin) {\n      this.$bus.$emit('coTransfer', this.messData.symbol, coin);\n    },\n    // 修改借贷币种\n    setBroCoin: function setBroCoin(v) {\n      if (this.broCoin === v) return;\n      this.broCoin = v;\n      this.broNum = '';\n    },\n    inputChange: function inputChange(v, name) {\n      this[name] = v;\n    },\n    // 借贷点击\n    broClick: function broClick() {\n      var _this2 = this;\n\n      this.btnLoading = true;\n      this.axios({\n        url: '/lever/finance/borrow',\n        params: {\n          symbol: this.symbol,\n          coin: this.broCoin,\n          amount: this.broNum\n        }\n      }).then(function (data) {\n        _this2.btnLoading = false;\n\n        if (data.code.toString() === '0') {\n          _this2.getData();\n\n          _this2.getTableList();\n\n          _this2.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'success'\n          });\n\n          _this2.broNum = '';\n        } else {\n          _this2.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      }); // fetch('http://localhost:7001/leverFinanceTransfer').then((data) => {\n      //   return data.json()\n      // })\n    },\n    tableClick: function tableClick(type, data) {\n      if (type === 'repayment') {\n        var obj = this.dataList[data];\n        this.$bus.$emit('coRepayment', obj);\n      } else if (type === 'details') {\n        this.getSubTableData(data);\n      }\n    },\n    typeText: function typeText(v) {\n      var str = '';\n\n      switch (v) {\n        case '1':\n          str = this.$t('assets.leverageToLoan.typeText1');\n          break;\n\n        case '2':\n          str = this.$t('assets.leverageToLoan.typeText2');\n          break;\n\n        default:\n          str = this.$t('assets.leverageToLoan.typeText3');\n      }\n\n      return str;\n    },\n    // 查看详情\n    getSubTableData: function getSubTableData(v) {\n      var _this3 = this;\n\n      if (v.open) {\n        this.subContentId = v.id;\n        this.subColumns = [this.$t('order.exchangeOrder.detailsTime'), // 时间\n        this.$t('assets.leverageToLoan.list3'), // 币种\n        this.$t('order.exchangeOrder.detailsVolume'), // 数量\n        this.$t('assets.flowingWater.type') // 类型\n        ];\n        this.subContent = [];\n        this.subLoading = true;\n        this.axios({\n          url: '/lever/return/info',\n          method: 'post',\n          params: {\n            id: v.id.toString(),\n            pageSize: 10000\n          }\n        }).then(function (data) {\n          if (v.id !== _this3.subContentId) {\n            return;\n          }\n\n          if (data.code.toString() === '0') {\n            var list = [];\n            data.data.financeList.forEach(function (item) {\n              // const [baseCoin, countCoin] = this.symbol.split('/');\n              // const { marketFix, coinFix } = this.getFix(countCoin, baseCoin);\n              var returnFix = _this3.messData.baseReturnPrecision;\n\n              if (item.coin === _this3.messData.quoteCoin) {\n                returnFix = _this3.messData.quoteReturnPrecision;\n              }\n\n              list.push({\n                ctime: formatTime(Number(item.repaymentTime)),\n                coin: _this3.getShowCoin(item.coin),\n                volume: fixD(item.returnMoney, returnFix),\n                type: _this3.typeText(item.type.toString())\n              });\n            });\n            _this3.subLoading = false;\n            _this3.subContent = list;\n          } else {\n            _this3.subLoading = false;\n\n            _this3.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'error'\n            });\n          }\n        });\n      }\n    },\n    getTableList: function getTableList() {\n      var _this4 = this;\n\n      this.axios({\n        url: 'lever/borrow/new',\n        params: {\n          pageSize: this.paginationObj.display,\n          // 每页条数\n          page: this.paginationObj.currentPage,\n          // 页码\n          symbol: this.symbol\n        }\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          _this4.tabelLoading = false;\n          var _data$data = data.data,\n              count = _data$data.count,\n              financeList = _data$data.financeList;\n          var list = []; // const { coinList } = this.market;\n\n          financeList.forEach(function (item) {\n            // const fix = coinList[item.coin.toUpperCase()].showPrecision;\n            var fix = 8;\n            var returnFix = 8;\n            _this4.dataList[item.id] = item;\n            list.push({\n              id: item.id,\n              data: [formatTime(Number(item.ctime)), item.showName || item.symbol.toUpperCase(), _this4.getShowCoin(item.coin.toUpperCase()), fixD(item.borrowMoney, fix), _this4.rateFixFn(item.interestRate), fixD(item.oweInterest, returnFix), fixD(item.oweAmount, returnFix), [{\n                type: 'subTable',\n                // 'link' ' button' ,'html', 'label', 'icon' ‘str’\n                text: _this4.$t('order.exchangeOrder.details'),\n                // 详情\n                eventType: 'details'\n              }, {\n                type: 'button',\n                // 'link' ' button' ,'html', 'label', 'icon' ‘str’\n                text: _this4.$t('assets.leverageToLoan.repayment'),\n                // 归还\n                eventType: 'repayment'\n              }]]\n            });\n          });\n          _this4.tabelList = list;\n          _this4.paginationObj.total = count > 30 ? 30 : count;\n        }\n      });\n    }\n  }\n};",null]}