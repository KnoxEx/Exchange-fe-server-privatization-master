{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/singpassLogin/singpassLogin.js","dependencies":[{"path":"/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/singpassLogin/singpassLogin.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport { imgMap, setCookie, getScript } from '@/utils';\nexport default {\n  name: 'singPassLogin',\n  data: function data() {\n    return {\n      ko64: imgMap.ko6_4,\n      dialogFlag: false,\n      dialogConfirmLoading: false,\n      dialogConfirmDisabled: false,\n      dialoghaveOption: false,\n      assDialogFlag: false,\n      assDialogConfirmLoading: false,\n      assDialogConfirmDisabled: false,\n      isShowRefresh: false,\n      sTime: 0,\n      setInterval: null,\n      clientId: 'ECXX',\n      clientCodeRequestUrl: null,\n      redirectUri: null\n    };\n  },\n  props: {\n    isShow: {\n      default: true,\n      type: Boolean\n    }\n  },\n  watch: {\n    // isShow() {\n    //   // this.dialogFlag = val;\n    //   // if (val) {\n    //   //   this.initSingPass();\n    //   // }\n    // },\n    thirdPartyLoginData: function thirdPartyLoginData(data) {\n      if (data !== null) {\n        if (data.text === 'success') {\n          this.dialogFlag = true;\n          this.clientId = data.data.client_id;\n          this.clientCodeRequestUrl = data.data.client_code_request_url;\n          this.redirectUri = data.data.redirect_uri;\n          this.initSingPass();\n        }\n      }\n    }\n  },\n  computed: {\n    titleText: function titleText() {\n      return this.$t('singPassLogin.mainText2'); // 'SingPass第三方登录';\n    },\n    singPassCode: function singPassCode() {\n      return this.$route.query.code;\n    },\n    singpassState: function singpassState() {\n      return this.$route.query.state;\n    },\n    singpassSource: function singpassSource() {\n      return this.$route.query.source;\n    },\n    // 获取二维码的信息\n    thirdPartyLoginData: function thirdPartyLoginData() {\n      return this.$store.state.baseData.thirdPartyLoginData;\n    },\n    // 当前域名\n    domainName: function domainName() {\n      return window.location.origin;\n    }\n  },\n  methods: {\n    init: function init() {\n      getScript('../../static/js/jquery-3.3.1.min.js').then(function () {\n        getScript('https://saml.singpass.gov.sg/spcpextrest/resources/js/spcp-pvt-qr-v1.0.0.js').then(function () {});\n      });\n\n      if (this.singPassCode && this.singpassState && !this.singpassSource) {\n        this.singPassRelation();\n      }\n    },\n    // 查询 授权用户与平台用户是都关联\n    singPassRelation: function singPassRelation() {\n      var _this = this;\n\n      this.axios({\n        url: 'thirdPartLogin/singPassRelation',\n        method: 'post',\n        header: {},\n        params: {\n          singPassCode: this.singPassCode\n        }\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          // 已存在关联 登录成功\n          if (data.data.exitSingPass === 1) {\n            setCookie('token', data.data.token); // 存储cookie\n            // 登录成功\n\n            _this.$bus.$emit('tip', {\n              text: _this.$t('login.loginSuccess'),\n              type: 'success'\n            }); // 获取 userinfo\n\n\n            _this.$store.dispatch('getUserInfo');\n\n            _this.getMySymbol();\n\n            _this.$router.push('/');\n          } else {\n            // 不存在关联\n            _this.singPassCode = data.data.singPassCode;\n            _this.assDialogFlag = true;\n          }\n        } else {\n          _this.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      }).catch(function () {});\n    },\n    refreshHandler: function refreshHandler() {\n      window.SPCPQR.refresh();\n      this.isShowRefresh = false;\n      this.setsTime();\n    },\n    initSingPass: function initSingPass() {\n      var _this2 = this;\n\n      this.sTime = 0;\n      this.isShowRefresh = false;\n      setTimeout(function () {\n        window.SPCPQR.init('qr_wrapper', {\n          state: new Date().getTime(),\n          nonce: new Date().getTime(),\n          clientId: _this2.clientId,\n          responseType: 'code',\n          redirectUri: \"\".concat(_this2.redirectUri),\n          scope: 'openid'\n        }, _this2.refreshHandler);\n\n        _this2.setsTime();\n      });\n    },\n    accountLogin: function accountLogin() {\n      var state = new Date().getTime();\n      var nonce = new Date().getTime();\n      var clientId = this.clientId;\n      var responseType = 'code'; // const redirectUri = `${this.domainName}/${this.redirectUri}`;\n      // const redirectUri = 'http://rd3www.chaindown.com/zh_CN/login';\n\n      var scope = 'openid';\n      var url = \"\".concat(this.clientCodeRequestUrl, \"?response_type=\").concat(responseType, \"&scope=\").concat(scope, \"&client_id=\").concat(clientId, \"&nonce=\").concat(nonce, \"&state=\").concat(state, \"&redirect_uri=\").concat(this.redirectUri);\n      window.open(url);\n    },\n    goDow: function goDow() {\n      window.open('https://singpassmobile.sg/');\n    },\n    dialogClose: function dialogClose() {\n      this.dialogFlag = false;\n    },\n    dialogClosetwo: function dialogClosetwo() {\n      this.assDialogFlag = false;\n      this.$router.push('login');\n    },\n    dialogConfirm: function dialogConfirm() {},\n    assDialogConfirm: function assDialogConfirm() {},\n    setsTime: function setsTime() {\n      var _this3 = this;\n\n      clearInterval(this.setInterval);\n      this.sTime = 0;\n      this.setInterval = setInterval(function () {\n        _this3.sTime += 1;\n\n        if (_this3.sTime >= 120) {\n          _this3.isShowRefresh = true;\n          clearInterval(_this3.setInterval);\n        }\n      }, 1000);\n    },\n    singPassLogin: function singPassLogin(val) {\n      this.assDialogFlag = false; // 跳转注册\n\n      if (val === 1) {\n        this.$router.push(\"register?singPassCode=\".concat(this.singPassCode, \"&singPassState=\").concat(this.singpassState));\n      } else {\n        this.$bus.$emit('setLoginMode', 'SingPass');\n      }\n    }\n  }\n};",null]}