{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/personal/exccAuthForm/exccAuthForm.js","dependencies":[{"path":"/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/personal/exccAuthForm/exccAuthForm.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport _slicedToArray from \"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.regexp.match\";\n// @ is an alias to /src\nimport { imgMap } from '@/utils';\nimport livePhotos from '@/assets/images/1/livePhoto.png';\nimport countryMinix from \"../../countryList/countryList\";\nvar upload1 = imgMap.kyc_passport_a;\nvar upload2 = imgMap.kyc_passport_b;\nvar upload3 = imgMap.kyc_passport_c;\nvar upload4 = imgMap.livePhoto || livePhotos;\nexport default {\n  name: 'exccAuthForm',\n  mixins: [countryMinix],\n  components: {},\n  data: function data() {\n    return {\n      promptTextType: this.$t('personal.idAuth.promptTextType'),\n      promptText: this.$t('personal.label.promptText'),\n      errorText: this.$t('personal.label.errorText'),\n      authLevel: 3,\n      text1: this.$t('personal.label.idCard'),\n      text2: this.$t('personal.label.passport'),\n      loading: false,\n      firstPhotoImg: '',\n      secondPhotoImg: '',\n      thirdPhotoImg: '',\n      livePhotoImg: '',\n      firstPhotoLoading: false,\n      secondPhotoLoading: false,\n      thirdPhotoLoading: false,\n      livePhotoLoading: false,\n      checkValue1: '',\n      // 证件号\n      promptText1: this.$t('personal.label.idCardNum'),\n      errorText1: '',\n      checkErrorFlag1: false,\n      promptText2: this.$t('personal.label.name'),\n      errorText2: '',\n      checkErrorFlag2: false,\n      active: '1',\n      disabled2: true,\n      incomeErrorFlag: false,\n      certificateTypeErrorFlag: false,\n      imageType: '1',\n      certificateTypeList: [{\n        value: this.$t('personal.label.idCard'),\n        code: 1\n      }],\n      kycPhone: '',\n      kycMetaText: '',\n      // 上传图片说明文案\n      // 国家不可编辑\n      countryDisabled: true,\n      firstPhoto: '',\n      // 身份证正面\n      secondPhoto: '',\n      // 身份证反面\n      thirdPhoto: '',\n      // 手持证件\n      uploadName: '',\n      // 当前选中的上传模块\n      livePhoto: '',\n      // 居住证图片\n      full_name: '',\n      // 姓名\n      sex: '',\n      // 性别\n      birthday: '',\n      // 出生日期\n      city: '',\n      // 市\n      address: '',\n      // 住在地址\n      postcode: '',\n      // 邮政编码\n      certificateNumber: '',\n      // 证件号码\n      income: '0',\n      // 收入来源\n      qtTExt: '',\n      // 收入来源选择其他的文案\n      birthdayErrorText: '',\n      birthdayErrorFlag: false\n    };\n  },\n  watch: {\n    birthday: function birthday(val) {\n      if (!val.match(/^(\\d{4})(-)(\\d{2})(-)(\\d{2})$/)) {\n        this.birthdayErrorText = this.$t('personal.exccAuthForm.text16');\n        this.birthdayErrorFlag = true;\n      } else if (val && this.ageLimit && !this.validateAge()) {\n        this.birthdayErrorText = '';\n        this.birthdayErrorFlag = false;\n        this.$bus.$emit('tip', {\n          text: \"\".concat(this.$t('personal.exccAuthForm.text14')).concat(this.ageLimit),\n          type: 'error'\n        });\n      } else {\n        var ar = val.split('-');\n\n        if (Number(ar[0] > 2020) || Number(ar[1]) > 12 || Number(ar[2]) > 31) {\n          this.birthdayErrorText = this.$t('personal.exccAuthForm.text16');\n          this.birthdayErrorFlag = true;\n        } else {\n          this.birthdayErrorText = '';\n          this.birthdayErrorFlag = false;\n        }\n      }\n    },\n    clientUploadType: function clientUploadType() {\n      this.getImageToken();\n    },\n    userInfo: function userInfo(v) {\n      if (v) {\n        this.authLevel = this.userInfo.authLevel;\n\n        if (this.authLevel === 2 || this.authLevel === 3) {\n          this.active = '1';\n        } else if (this.authLevel === 0) {\n          this.active = '3';\n        } else {\n          // this.authLevel为1 审核通过\n          this.$router.push('/personal/userManagement');\n        }\n      }\n    },\n    authRealname: function authRealname(_authRealname) {\n      if (_authRealname !== null) {\n        this.loading = false;\n\n        if (_authRealname.text === 'success') {\n          this.$bus.$emit('tip', {\n            text: _authRealname.msg,\n            type: 'success'\n          });\n          this.active = '3';\n          this.$store.dispatch('resetType');\n        } else {\n          this.$bus.$emit('tip', {\n            text: _authRealname.msg,\n            type: 'error'\n          });\n          this.active = '1';\n          this.$store.dispatch('resetType');\n        }\n      }\n    }\n  },\n  computed: {\n    exccKycConfig: function exccKycConfig() {\n      return this.$store.state.personal.exccKycConfig;\n    },\n    ageLimit: function ageLimit() {\n      return this.exccKycConfig ? Number(this.exccKycConfig.data.ageLimit) : 0;\n    },\n    defaultShowDate: function defaultShowDate() {\n      if (this.ageLimit && Number(this.ageLimit) > 0) {\n        var curDate = new Date().getTime();\n        var fourYearsTime = 31536000000 * Number(this.ageLimit);\n        return curDate - fourYearsTime;\n      }\n\n      return null;\n    },\n    // 国籍\n    kycNationality: function kycNationality() {\n      var str = '';\n      var current = this.countryRealMap[\"+\".concat(this.kycPhone)];\n\n      if (this.kycPhone && current) {\n        var val = current.value;\n\n        var _val$split = val.split(' +');\n\n        var _val$split2 = _slicedToArray(_val$split, 1);\n\n        str = _val$split2[0];\n      }\n\n      return str;\n    },\n    // 收入来源列表\n    incomeList: function incomeList() {\n      return [{\n        code: '0',\n        value: this.$t('personal.exccAuthorization.income1')\n      }, {\n        code: '1',\n        value: this.$t('personal.exccAuthorization.income2')\n      }, {\n        code: '2',\n        value: this.$t('personal.exccAuthorization.income3')\n      }, {\n        code: '3',\n        value: this.$t('personal.exccAuthorization.income4')\n      }, {\n        code: '4',\n        value: this.$t('personal.exccAuthorization.income5')\n      }, {\n        code: '5',\n        value: this.$t('personal.exccAuthorization.income6')\n      }, {\n        code: '6',\n        value: this.$t('personal.exccAuthorization.income7')\n      }];\n    },\n    isOpenUploadImg: function isOpenUploadImg() {\n      return this.$store.state.baseData.is_open_upload_img;\n    },\n    imgToken: function imgToken() {\n      return this.$store.state.baseData.imgToken || {};\n    },\n    clientUploadType: function clientUploadType() {\n      return this.$store.state.baseData.client_img_upload_open;\n    },\n    // 该用户是否完成nice认证\n    krwPhoneAuth: function krwPhoneAuth() {\n      var str = '0';\n\n      if (this.userInfo && this.userInfo.is_krw_phone_auth) {\n        str = this.userInfo.is_krw_phone_auth.toString();\n      }\n\n      return str;\n    },\n    bg1: function bg1() {\n      return {\n        backgroundImage: \"url(\".concat(upload1, \")\")\n      };\n    },\n    bg2: function bg2() {\n      return {\n        backgroundImage: \"url(\".concat(upload2, \")\")\n      };\n    },\n    bg3: function bg3() {\n      return {\n        backgroundImage: \"url(\".concat(upload3, \")\")\n      };\n    },\n    bg4: function bg4() {\n      return {\n        backgroundImage: \"url(\".concat(upload4, \")\")\n      };\n    },\n    authRealname: function authRealname() {\n      return this.$store.state.personal.authRealname;\n    },\n    userInfo: function userInfo() {\n      return this.$store.state.baseData.userInfo;\n    },\n    activeP1: function activeP1() {\n      if (this.active !== '1') {\n        return '';\n      }\n\n      return 'b-2-cl';\n    },\n    activeP2: function activeP2() {\n      if (this.active !== '2') {\n        return '';\n      }\n\n      return 'b-2-cl';\n    },\n    activeP3: function activeP3() {\n      if (this.active === '3') {\n        return 'b-2-cl';\n      }\n\n      return '';\n    },\n    activeS2: function activeS2() {\n      if (this.active !== '1') {\n        return 'a-12-bg';\n      }\n\n      return 'a-1-bg';\n    },\n    activeS3: function activeS3() {\n      if (this.active === '3') {\n        return 'a-12-bg';\n      }\n\n      return 'a-1-bg';\n    },\n    disabled: function disabled() {\n      if (this.income === '6' && !this.qtTExt) {\n        return true;\n      }\n\n      return !(this.full_name && this.sex && this.birthday && this.city && this.address && this.postcode && this.certificateNumber && this.country && this.validateAge() && !this.birthdayErrorFlag);\n    }\n  },\n  methods: {\n    init: function init() {\n      this.getImageToken();\n      this.countryInit();\n      this.getLang();\n\n      if (this.userInfo) {\n        this.authLevel = this.userInfo.authLevel;\n\n        if (this.authLevel === 2 || this.authLevel === 3) {\n          this.active = '1';\n        } else if (this.authLevel === 0) {\n          this.active = '3';\n        } else {\n          // this.authLevel为1 审核通过\n          this.$router.push('/personal/userManagement');\n        }\n      }\n    },\n    getLang: function getLang() {\n      var _this = this;\n\n      this.axios({\n        url: '/kyc/Api/getUploadImgCopywriting'\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          if (data.data.language) {\n            _this.kycMetaText = data.data.language;\n          }\n        } else {\n          _this.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    mountedInit: function mountedInit() {\n      if (!this.exccKycConfig) {\n        this.$store.dispatch('exccKycConfig');\n      }\n    },\n    countryInit: function countryInit() {\n      if (this.$route.query) {\n        if (this.$route.query.country) {\n          this.kycPhone = this.$route.query.country;\n          this.country = this.$route.query.countryKeyCode;\n        } else if (this.$route.query.countryKeyCode) {\n          this.kycPhone = this.countryMap[\"+\".concat(this.$route.query.countryKeyCode)].code.replace('+', '');\n          this.country = this.$route.query.countryKeyCode;\n        } else {\n          this.kycPhone = '156';\n          this.country = '86';\n        }\n      }\n    },\n    getImageToken: function getImageToken() {\n      var tokenData = this.imgToken[this.imageType];\n\n      if ((!tokenData || new Date(tokenData.Expiration).getTime() - new Date().getTime() < 30000) && Number(this.clientUploadType)) {\n        this.$store.dispatch('getImgToken', this.imageType);\n      }\n    },\n    uploadFinish: function uploadFinish(obj) {\n      if (obj.name) {\n        this.uploadName = obj.name;\n      }\n\n      if (obj.error) {\n        this.$bus.$emit('tip', {\n          text: obj.error,\n          type: 'error'\n        });\n        return;\n      }\n\n      this[\"\".concat(this.uploadName, \"Img\")] = obj.url;\n      this[\"\".concat(this.uploadName, \"Loading\")] = false;\n      this[this.uploadName] = obj.fileName;\n\n      if (this.firstPhotoImg && this.secondPhotoImg && this.thirdPhotoImg && this.livePhotoImg) {\n        this.disabled2 = false;\n      }\n    },\n    onChangeFileFun: function onChangeFileFun(obj) {\n      if (obj.code && obj.code === 'maxSize') {\n        this.$bus.$emit('tip', {\n          text: this.$t('personal.exccAuthForm.text3'),\n          type: 'error'\n        });\n      }\n\n      this.uploadName = obj.name;\n      this[\"\".concat(this.uploadName, \"Loading\")] = true;\n    },\n    incomeChange: function incomeChange(item) {\n      this.income = item.code;\n    },\n    inputChanges: function inputChanges(value, name) {\n      this[name] = value.trim();\n    },\n    checkFocus: function checkFocus(name) {\n      switch (name) {\n        case 'email':\n          {\n            // email\n            this.checkErrorFlag1 = false;\n            this.errorText1 = '';\n            break;\n          }\n\n        case '2':\n          {\n            // emailCode\n            break;\n          }\n\n        default:\n          {// newpassword again\n            // console.log(1);\n          }\n      }\n    },\n    btnLink: function btnLink(num) {\n      if (num === 1) {\n        this.active = '2';\n      } else if (num === 3) {\n        this.active = '1';\n      } else {\n        this.loading = true;\n        var info = {\n          fullName: this.full_name,\n          // 性别\n          sex: this.sex,\n          birthday: this.birthday,\n          city: this.city,\n          address: this.address,\n          postcode: this.postcode,\n          certificateNumber: this.certificateNumber,\n          country: \"+\".concat(this.country),\n          numberCode: this.kycPhone,\n          income: this.income,\n          firstPhoto: this.firstPhoto,\n          secondPhoto: this.secondPhoto,\n          thirdPhoto: this.thirdPhoto,\n          livePhoto: this.livePhoto,\n          otherIncomeDesc: this.qtTExt\n        };\n        this.$store.dispatch('exccAuthRealname', info);\n      }\n    },\n    onChangeCalendar: function onChangeCalendar(data) {\n      this.birthday = data;\n    },\n    // 选择性别\n    selectGender: function selectGender(id) {\n      this.sex = id;\n    },\n    countryChange: function countryChange(item) {\n      this.country = item.code;\n      this.countryKeyCode = item.keyCode;\n    },\n    validateAge: function validateAge() {\n      if (!this.ageLimit) {\n        return true;\n      }\n\n      var birthday1 = this.birthday.split('-');\n      var convert2Date = new Date(birthday1[0], birthday1[1], birthday1[2]);\n      var nowDate = new Date(); // 获取当前时间\n\n      var year = nowDate.getFullYear();\n      var month = nowDate.getMonth() + 1;\n      var date = nowDate.getDate();\n      nowDate = new Date(year, month, date);\n      var age = nowDate.getTime() - convert2Date.getTime(); // 毫秒\n\n      var leapYear = 0; // 有多少个闰年\n\n      for (var i = 0; i <= this.ageLimit; i += 1) {\n        if (i % 4 === 0 && i % 100 !== 0 || i % 400 === 0) {\n          leapYear += 1;\n        }\n      }\n\n      var YearNumber = this.ageLimit - leapYear;\n      var betweenNumer = 86400000 * 365 * YearNumber + 86400000 * 366 * leapYear;\n      return age >= betweenNumer;\n    }\n  }\n};",null]}