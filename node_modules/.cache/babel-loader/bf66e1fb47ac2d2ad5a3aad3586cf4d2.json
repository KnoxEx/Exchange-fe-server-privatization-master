{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/BlockChain-ui/PC/common-mixin/modules/coTrade/components/setMarginCoin/setMarginCoin.js","dependencies":[{"path":"/Users/h/partTimeJob/BlockChain-ui/PC/common-mixin/modules/coTrade/components/setMarginCoin/setMarginCoin.js","mtime":1623835967000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.to-string\";\n// 调节逐仓仓位保证金\nimport { nul, add, cut, division, fixD, fixInput, thousandsComma as _thousandsComma } from '@/utils';\nexport default {\n  name: 'setMarginCoin',\n  data: function data() {\n    return {\n      // 是否加载成功\n      dialogConfirmLoading: false,\n      // 修改保证金类型 1: 增加 2：减少\n      marginReviseType: 1,\n      // 修改保证金 数量\n      marginValue: '',\n      // 保证金错误提示语\n      marginErrorText: null,\n      // 保证金是否输入错误\n      marginErrorFlag: false,\n      // 确认修改保证金防止双击\n      sumbitFla: true\n    };\n  },\n  props: {\n    isShow: {\n      default: false,\n      type: Boolean\n    },\n    close: {\n      default: function _default() {},\n      type: Function\n    },\n    marginData: {\n      default: function _default() {},\n      type: Object\n    }\n  },\n  computed: {\n    lanText: function lanText() {\n      return {\n        titleText: this.$t('futures.setMarginCoin.titleText'),\n        // '调节逐仓仓位保证金',\n        text1: this.$t('futures.setMarginCoin.text1'),\n        // '当前',\n        text2: this.$t('futures.setMarginCoin.text2'),\n        // '变更后',\n        text3: this.$t('futures.setMarginCoin.text3'),\n        // '仓位',\n        text4: this.$t('futures.setMarginCoin.text4'),\n        // '仓位保证金',\n        text5: this.$t('futures.setMarginCoin.text5'),\n        // '实际杠杆',\n        text6: this.$t('futures.setMarginCoin.text6'),\n        // '强平价',\n        text7: this.$t('futures.setMarginCoin.text7'),\n        // '可用',\n        text8: this.$t('futures.setMarginCoin.text8'),\n        // '可减少保证金',\n        text9: this.$t('futures.setMarginCoin.text9'),\n        // '全部',\n        text10: this.$t('futures.setMarginCoin.text10'),\n        // '增加保证金',\n        text11: this.$t('futures.setMarginCoin.text11'),\n        // '减少保证金',\n        text12: this.$t('futures.setMarginCoin.text12'),\n        // '增加保证金数量',\n        text13: this.$t('futures.setMarginCoin.text13'),\n        // '减少保证金数量',\n        text14: this.$t('futures.setMarginCoin.text14'),\n        // '余额不足',\n        text15: this.$t('futures.setMarginCoin.text15') // '可减少保证金不足',\n\n      };\n    },\n    // 数量单位类型Number(1标的货币 2张)\n    coUnitType: function coUnitType() {\n      return this.$store.state.future.coUnitType;\n    },\n    // 保证金模式列表\n    categoryList: function categoryList() {\n      return [{\n        id: 1,\n        text: this.lanText.text10,\n        // '增加保证金',\n        classes: this.marginReviseType === 1 ? 'u-8-bg' : 'a-3-bg'\n      }, {\n        id: 2,\n        text: this.lanText.text11,\n        // '减少保证金',\n        classes: this.marginReviseType === 2 ? 'u-8-bg' : 'a-3-bg'\n      }];\n    },\n    // 增加&减少保证金 提示文案\n    marginPromptText: function marginPromptText() {\n      if (this.marginReviseType === 1) {\n        return this.lanText.text12; // '增加保证金数量';\n      }\n\n      return this.lanText.text13; // '减少保证金数量';\n    },\n    // 修改保证金是否可以提交\n    dialogConfirmDisabled: function dialogConfirmDisabled() {\n      if (this.marginValue && this.marginValue > 0 && !this.marginErrorText) {\n        return false;\n      }\n\n      return true;\n    },\n    // 保证金精度\n    mCionFix: function mCionFix() {\n      if (this.marginData.mCionFix) {\n        return this.marginData.mCionFix;\n      }\n\n      return 8;\n    },\n    // 修改后的保证金数量\n    modifiedMargin: function modifiedMargin() {\n      if (this.marginValue) {\n        var holdAmount = this.marginData.holdAmount || 0;\n        var value = 0; // 如果是减少保证金\n\n        if (this.marginReviseType === 2) {\n          value = fixD(cut(holdAmount, this.marginValue), this.mCionFix);\n          if (value < 0) value = 0;\n          return value;\n        }\n\n        value = fixD(add(holdAmount, this.marginValue), this.mCionFix);\n        if (value < 0) value = 0;\n        return value;\n      }\n\n      return this.marginData.holdAmount;\n    },\n    // 修改后的强平价格\n    modifiedReducePrice: function modifiedReducePrice() {\n      if (!this.marginValue) return this.marginData.reducePrice; // 保证金汇率 标记价格 维持保证金率 手续费率 合约方向(1正向 0反向)， 价格精度\n\n      var _this$marginData = this.marginData,\n          marginRate = _this$marginData.marginRate,\n          indexPrice = _this$marginData.indexPrice,\n          keepRate = _this$marginData.keepRate,\n          maxFeeRate = _this$marginData.maxFeeRate,\n          contractSide = _this$marginData.contractSide,\n          priceFix = _this$marginData.priceFix;\n      if (!marginRate.toString() || !indexPrice.toString() || !keepRate.toString() || !maxFeeRate.toString() || !contractSide.toString()) return ''; // 逐仓权益 / 保证金汇率\n\n      var N1 = division(this.interests, marginRate); // 仓位数量 * 仓位方向 * 标记价格\n\n      var N2 = nul(nul(this.positionNumber, this.sideNumber), indexPrice); // 逐仓权益 / 保证金汇率 - 仓位数量 * 仓位方向 * 标记价格\n\n      var N3 = cut(N1, N2); // 维持保证金率 + 手续费率\n\n      var X1 = add(keepRate, maxFeeRate); // (维持保证金率 + 手续费率)* 仓位数量\n\n      var X2 = nul(X1, this.positionNumber); // 仓位 * 仓位方向\n\n      var X3 = nul(this.positionNumber, this.sideNumber); // (维持保证金率 + 手续费率)* 仓位数量 - 仓位数量 * 仓位方向\n\n      var X4 = cut(X2, X3); // 正向合约 =(逐仓权益 / 保证金汇率 - 仓位数量 * 仓位方向 * 标记价格) / (维持保证金率 + 手续费率)* 仓位数量 - 仓位数量 * 仓位方向)\n\n      var value = division(N3, X4);\n\n      if (contractSide === 0) {\n        X4 = add(X2, X3); // 仓位数量 * 仓位方向 / 标记价格\n\n        var Y1 = division(nul(this.positionNumber, this.sideNumber), indexPrice);\n        var Y2 = add(N1, Y1); // 反向合约 =(维持保证金率 + 手续费率)* 仓位数量 + 仓位数量 * 仓位方向) / (逐仓权益 / 保证金汇率 + 仓位数量 * 仓位方向 / 标记价格)\n\n        value = division(X4, Y2);\n      }\n\n      if (value <= 0) {\n        return '--';\n      }\n\n      return fixD(value, priceFix);\n    },\n    // 仓位方向：多仓是1，空仓是-1\n    sideNumber: function sideNumber() {\n      return this.marginData.orderSide === 'BUY' ? 1 : -1;\n    },\n    // 仓位数量 = 仓位张数 * 面值\n    positionNumber: function positionNumber() {\n      var multiplier = this.marginData.multiplier;\n      var vol = this.marginData.positionVolumeOriginal; // 算出标的货币数量(数量 * 合约面值)\n\n      vol = multiplier ? nul(vol, multiplier) : 0;\n      return vol;\n    },\n    // 逐仓权益 = 仓位保证金 + 已实现盈亏 + 未实现盈亏\n    interests: function interests() {\n      var _this$marginData2 = this.marginData,\n          realizedAmount = _this$marginData2.realizedAmount,\n          unRealizedAmount = _this$marginData2.unRealizedAmount;\n      return add(add(this.modifiedMargin, realizedAmount), unRealizedAmount);\n    }\n  },\n  watch: {\n    marginValue: function marginValue(v) {\n      var _this = this;\n\n      this.$nextTick(function () {\n        _this.marginValue = fixInput(v, _this.mCionFix);\n      });\n      var _this$marginData3 = this.marginData,\n          canUseAmount = _this$marginData3.canUseAmount,\n          canSubMarginAmount = _this$marginData3.canSubMarginAmount;\n\n      if (this.marginReviseType === 1) {\n        if (Number(this.marginValue) > Number(canUseAmount)) {\n          this.$nextTick(function () {\n            _this.marginErrorText = _this.lanText.text14; // '余额不足';\n\n            _this.marginErrorFlag = true;\n          });\n        } else {\n          this.$nextTick(function () {\n            _this.marginErrorText = '';\n            _this.marginErrorFlag = false;\n          });\n        }\n      } else if (Number(this.marginValue) > Number(canSubMarginAmount)) {\n        this.$nextTick(function () {\n          _this.marginErrorText = _this.lanText.text15; // '可减少保证金不足';\n\n          _this.marginErrorFlag = true;\n        });\n      } else {\n        this.$nextTick(function () {\n          _this.marginErrorText = '';\n          _this.marginErrorFlag = false;\n        });\n      }\n    }\n  },\n  methods: {\n    // 实际杠杆\n    activeLeverage: function activeLeverage(type) {\n      //  标记价格, 保证金汇率, 合约方向(1正向 0反向)\n      var _this$marginData4 = this.marginData,\n          indexPrice = _this$marginData4.indexPrice,\n          marginRate = _this$marginData4.marginRate,\n          contractSide = _this$marginData4.contractSide; // 保证金\n\n      var holdAmount = this.marginData.holdAmount; // 如果要获取变更后的实际杠杆\n\n      if (type === 2) {\n        // 获取修改后的保证金\n        holdAmount = this.modifiedMargin;\n      }\n\n      var value = 0;\n\n      if (this.positionNumber && indexPrice && holdAmount && marginRate) {\n        if (contractSide === 1) {\n          // 正向合约 = 仓位数量 * 标记价格 / 仓位保证金 / 保证金汇率\n          value = division(division(nul(this.positionNumber, indexPrice), holdAmount), marginRate);\n        } else {\n          // (反向合约) = 仓位数量 / 标记价格 / 仓位保证金 / 保证金汇率\n          value = division(division(division(this.positionNumber, indexPrice), holdAmount), marginRate);\n        }\n      }\n\n      var data = fixD(value, 1);\n\n      if (Number(data) < 0.1) {\n        data = '<0.1';\n      }\n\n      return data;\n    },\n    // 切换 修改保证金类型\n    selectCategory: function selectCategory(id) {\n      this.marginReviseType = id;\n      this.marginValue = '';\n    },\n    // 保证金输入\n    inputChanges: function inputChanges(value, name) {\n      this[name] = value;\n    },\n    // 确认修改保证金\n    dialogConfirm: function dialogConfirm() {\n      var _this2 = this;\n\n      if (this.sumbitFla) {\n        this.sumbitFla = false;\n        var paramsData = {\n          type: this.marginReviseType,\n          contractId: this.marginData.contractId,\n          positionId: this.marginData.positionId,\n          amount: this.marginReviseType === 1 ? this.marginValue : \"-\".concat(this.marginValue)\n        };\n        this.axios({\n          url: this.$store.state.url.futures.changePositionMargin,\n          hostType: 'co',\n          params: paramsData\n        }).then(function (data) {\n          _this2.sumbitFla = true;\n\n          if (data.code === '0') {\n            _this2.marginValue = '';\n\n            _this2.close(); // 重新请仓位列表\n\n\n            _this2.$store.dispatch('getPositionList'); // 操作成功\n\n\n            _this2.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'success'\n            });\n          } else {\n            _this2.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'error'\n            });\n          }\n        }).catch(function () {\n          _this2.sumbitFla = true; // 系统错误\n\n          _this2.$bus.$emit('tip', {\n            text: _this2.$t('contract.c_error'),\n            type: 'error'\n          });\n        });\n      }\n    },\n    // 点击全部\n    allevent: function allevent() {\n      if (this.marginReviseType === 1) {\n        this.marginValue = this.marginData.canUseAmount;\n      } else {\n        this.marginValue = this.marginData.canSubMarginAmount;\n      }\n    },\n    thousandsComma: function thousandsComma(num) {\n      if (num) {\n        return _thousandsComma(num);\n      }\n\n      return num;\n    }\n  }\n};",{"version":3,"sources":["/Users/h/partTimeJob/BlockChain-ui/PC/common-mixin/modules/coTrade/components/setMarginCoin/setMarginCoin.js"],"names":["nul","add","cut","division","fixD","fixInput","thousandsComma","name","data","dialogConfirmLoading","marginReviseType","marginValue","marginErrorText","marginErrorFlag","sumbitFla","props","isShow","default","type","Boolean","close","Function","marginData","Object","computed","lanText","titleText","$t","text1","text2","text3","text4","text5","text6","text7","text8","text9","text10","text11","text12","text13","text14","text15","coUnitType","$store","state","future","categoryList","id","text","classes","marginPromptText","dialogConfirmDisabled","mCionFix","modifiedMargin","holdAmount","value","modifiedReducePrice","reducePrice","marginRate","indexPrice","keepRate","maxFeeRate","contractSide","priceFix","toString","N1","interests","N2","positionNumber","sideNumber","N3","X1","X2","X3","X4","Y1","Y2","orderSide","multiplier","vol","positionVolumeOriginal","realizedAmount","unRealizedAmount","watch","v","$nextTick","canUseAmount","canSubMarginAmount","Number","methods","activeLeverage","selectCategory","inputChanges","dialogConfirm","paramsData","contractId","positionId","amount","axios","url","futures","changePositionMargin","hostType","params","then","code","dispatch","$bus","$emit","msg","catch","allevent","num"],"mappings":"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","sourcesContent":["// 调节逐仓仓位保证金\nimport {\n  nul, add, cut, division, fixD, fixInput, thousandsComma,\n} from '@/utils';\n\nexport default {\n  name: 'setMarginCoin',\n  data() {\n    return {\n      // 是否加载成功\n      dialogConfirmLoading: false,\n      // 修改保证金类型 1: 增加 2：减少\n      marginReviseType: 1,\n      // 修改保证金 数量\n      marginValue: '',\n      // 保证金错误提示语\n      marginErrorText: null,\n      // 保证金是否输入错误\n      marginErrorFlag: false,\n      // 确认修改保证金防止双击\n      sumbitFla: true,\n\n    };\n  },\n  props: {\n    isShow: {\n      default: false,\n      type: Boolean,\n    },\n    close: {\n      default() {},\n      type: Function,\n    },\n    marginData: {\n      default: () => {},\n      type: Object,\n    },\n  },\n  computed: {\n    lanText() {\n      return {\n        titleText: this.$t('futures.setMarginCoin.titleText'), // '调节逐仓仓位保证金',\n        text1: this.$t('futures.setMarginCoin.text1'), // '当前',\n        text2: this.$t('futures.setMarginCoin.text2'), // '变更后',\n        text3: this.$t('futures.setMarginCoin.text3'), // '仓位',\n        text4: this.$t('futures.setMarginCoin.text4'), // '仓位保证金',\n        text5: this.$t('futures.setMarginCoin.text5'), // '实际杠杆',\n        text6: this.$t('futures.setMarginCoin.text6'), // '强平价',\n        text7: this.$t('futures.setMarginCoin.text7'), // '可用',\n        text8: this.$t('futures.setMarginCoin.text8'), // '可减少保证金',\n        text9: this.$t('futures.setMarginCoin.text9'), // '全部',\n        text10: this.$t('futures.setMarginCoin.text10'), // '增加保证金',\n        text11: this.$t('futures.setMarginCoin.text11'), // '减少保证金',\n        text12: this.$t('futures.setMarginCoin.text12'), // '增加保证金数量',\n        text13: this.$t('futures.setMarginCoin.text13'), // '减少保证金数量',\n        text14: this.$t('futures.setMarginCoin.text14'), // '余额不足',\n        text15: this.$t('futures.setMarginCoin.text15'), // '可减少保证金不足',\n      };\n    },\n    // 数量单位类型Number(1标的货币 2张)\n    coUnitType() {\n      return this.$store.state.future.coUnitType;\n    },\n    // 保证金模式列表\n    categoryList() {\n      return [\n        {\n          id: 1,\n          text: this.lanText.text10, // '增加保证金',\n          classes: this.marginReviseType === 1 ? 'u-8-bg' : 'a-3-bg',\n        },\n        {\n          id: 2,\n          text: this.lanText.text11, // '减少保证金',\n          classes: this.marginReviseType === 2 ? 'u-8-bg' : 'a-3-bg',\n        },\n      ];\n    },\n    // 增加&减少保证金 提示文案\n    marginPromptText() {\n      if (this.marginReviseType === 1) {\n        return this.lanText.text12; // '增加保证金数量';\n      }\n      return this.lanText.text13; // '减少保证金数量';\n    },\n    // 修改保证金是否可以提交\n    dialogConfirmDisabled() {\n      if (this.marginValue && this.marginValue > 0 && !this.marginErrorText) {\n        return false;\n      }\n      return true;\n    },\n    // 保证金精度\n    mCionFix() {\n      if (this.marginData.mCionFix) {\n        return this.marginData.mCionFix;\n      }\n      return 8;\n    },\n    // 修改后的保证金数量\n    modifiedMargin() {\n      if (this.marginValue) {\n        const holdAmount = this.marginData.holdAmount || 0;\n        let value = 0;\n        // 如果是减少保证金\n        if (this.marginReviseType === 2) {\n          value = fixD(cut(holdAmount, this.marginValue), this.mCionFix);\n          if (value < 0) value = 0;\n          return value;\n        }\n        value = fixD(add(holdAmount, this.marginValue), this.mCionFix);\n        if (value < 0) value = 0;\n        return value;\n      }\n      return this.marginData.holdAmount;\n    },\n    // 修改后的强平价格\n    modifiedReducePrice() {\n      if (!this.marginValue) return this.marginData.reducePrice;\n      // 保证金汇率 标记价格 维持保证金率 手续费率 合约方向(1正向 0反向)， 价格精度\n      const {\n        marginRate, indexPrice, keepRate, maxFeeRate, contractSide, priceFix,\n      } = this.marginData;\n      if (!marginRate.toString()\n        || !indexPrice.toString()\n        || !keepRate.toString()\n        || !maxFeeRate.toString()\n        || !contractSide.toString()) return '';\n      // 逐仓权益 / 保证金汇率\n      const N1 = division(this.interests, marginRate);\n      // 仓位数量 * 仓位方向 * 标记价格\n      const N2 = nul(nul(this.positionNumber, this.sideNumber), indexPrice);\n      // 逐仓权益 / 保证金汇率 - 仓位数量 * 仓位方向 * 标记价格\n      const N3 = cut(N1, N2);\n      // 维持保证金率 + 手续费率\n      const X1 = add(keepRate, maxFeeRate);\n      // (维持保证金率 + 手续费率)* 仓位数量\n      const X2 = nul(X1, this.positionNumber);\n      // 仓位 * 仓位方向\n      const X3 = nul(this.positionNumber, this.sideNumber);\n      // (维持保证金率 + 手续费率)* 仓位数量 - 仓位数量 * 仓位方向\n      let X4 = cut(X2, X3);\n      // 正向合约 =(逐仓权益 / 保证金汇率 - 仓位数量 * 仓位方向 * 标记价格) / (维持保证金率 + 手续费率)* 仓位数量 - 仓位数量 * 仓位方向)\n      let value = division(N3, X4);\n      if (contractSide === 0) {\n        X4 = add(X2, X3);\n        // 仓位数量 * 仓位方向 / 标记价格\n        const Y1 = division(nul(this.positionNumber, this.sideNumber), indexPrice);\n        const Y2 = add(N1, Y1);\n\n        // 反向合约 =(维持保证金率 + 手续费率)* 仓位数量 + 仓位数量 * 仓位方向) / (逐仓权益 / 保证金汇率 + 仓位数量 * 仓位方向 / 标记价格)\n        value = division(X4, Y2);\n      }\n      if (value <= 0) {\n        return '--';\n      }\n      return fixD(value, priceFix);\n    },\n    // 仓位方向：多仓是1，空仓是-1\n    sideNumber() {\n      return this.marginData.orderSide === 'BUY' ? 1 : -1;\n    },\n    // 仓位数量 = 仓位张数 * 面值\n    positionNumber() {\n      const { multiplier } = this.marginData;\n      let vol = this.marginData.positionVolumeOriginal;\n      // 算出标的货币数量(数量 * 合约面值)\n      vol = multiplier ? nul(vol, multiplier) : 0;\n      return vol;\n    },\n    // 逐仓权益 = 仓位保证金 + 已实现盈亏 + 未实现盈亏\n    interests() {\n      const { realizedAmount, unRealizedAmount } = this.marginData;\n      return add(add(this.modifiedMargin, realizedAmount), unRealizedAmount);\n    },\n  },\n  watch: {\n    marginValue(v) {\n      this.$nextTick(() => {\n        this.marginValue = fixInput(v, this.mCionFix);\n      });\n      const { canUseAmount, canSubMarginAmount } = this.marginData;\n      if (this.marginReviseType === 1) {\n        if (Number(this.marginValue) > Number(canUseAmount)) {\n          this.$nextTick(() => {\n            this.marginErrorText = this.lanText.text14; // '余额不足';\n            this.marginErrorFlag = true;\n          });\n        } else {\n          this.$nextTick(() => {\n            this.marginErrorText = '';\n            this.marginErrorFlag = false;\n          });\n        }\n      } else if (Number(this.marginValue) > Number(canSubMarginAmount)) {\n        this.$nextTick(() => {\n          this.marginErrorText = this.lanText.text15; // '可减少保证金不足';\n          this.marginErrorFlag = true;\n        });\n      } else {\n        this.$nextTick(() => {\n          this.marginErrorText = '';\n          this.marginErrorFlag = false;\n        });\n      }\n    },\n  },\n  methods: {\n    // 实际杠杆\n    activeLeverage(type) {\n      //  标记价格, 保证金汇率, 合约方向(1正向 0反向)\n      const {\n        indexPrice, marginRate, contractSide,\n      } = this.marginData;\n      // 保证金\n      let { holdAmount } = this.marginData;\n\n      // 如果要获取变更后的实际杠杆\n      if (type === 2) {\n        // 获取修改后的保证金\n        holdAmount = this.modifiedMargin;\n      }\n      let value = 0;\n      if (this.positionNumber && indexPrice && holdAmount && marginRate) {\n        if (contractSide === 1) {\n        // 正向合约 = 仓位数量 * 标记价格 / 仓位保证金 / 保证金汇率\n          value = division(\n            division(nul(this.positionNumber, indexPrice), holdAmount), marginRate,\n          );\n        } else {\n          // (反向合约) = 仓位数量 / 标记价格 / 仓位保证金 / 保证金汇率\n          value = division(\n            division(division(this.positionNumber, indexPrice), holdAmount), marginRate,\n          );\n        }\n      }\n      let data = fixD(value, 1);\n      if (Number(data) < 0.1) {\n        data = '<0.1';\n      }\n      return data;\n    },\n    // 切换 修改保证金类型\n    selectCategory(id) {\n      this.marginReviseType = id;\n      this.marginValue = '';\n    },\n    // 保证金输入\n    inputChanges(value, name) {\n      this[name] = value;\n    },\n    // 确认修改保证金\n    dialogConfirm() {\n      if (this.sumbitFla) {\n        this.sumbitFla = false;\n        const paramsData = {\n          type: this.marginReviseType,\n          contractId: this.marginData.contractId,\n          positionId: this.marginData.positionId,\n          amount: this.marginReviseType === 1 ? this.marginValue : `-${this.marginValue}`,\n        };\n        this.axios({\n          url: this.$store.state.url.futures.changePositionMargin,\n          hostType: 'co',\n          params: paramsData,\n        }).then((data) => {\n          this.sumbitFla = true;\n          if (data.code === '0') {\n            this.marginValue = '';\n            this.close();\n            // 重新请仓位列表\n            this.$store.dispatch('getPositionList');\n            // 操作成功\n            this.$bus.$emit('tip', { text: data.msg, type: 'success' });\n          } else {\n            this.$bus.$emit('tip', { text: data.msg, type: 'error' });\n          }\n        }).catch(() => {\n          this.sumbitFla = true;\n          // 系统错误\n          this.$bus.$emit('tip', { text: this.$t('contract.c_error'), type: 'error' });\n        });\n      }\n    },\n    // 点击全部\n    allevent() {\n      if (this.marginReviseType === 1) {\n        this.marginValue = this.marginData.canUseAmount;\n      } else {\n        this.marginValue = this.marginData.canSubMarginAmount;\n      }\n    },\n    thousandsComma(num) {\n      if (num) {\n        return thousandsComma(num);\n      }\n      return num;\n    },\n  },\n};\n"]}]}