{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/mobility/mobility.js","dependencies":[{"path":"/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/mobility/mobility.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/web.dom.iterable\";\nimport { fixD, fixInput } from '@/utils';\nexport default {\n  name: 'page-mobility',\n  data: function data() {\n    return {\n      buyPayments: [],\n      buyPayActive: '',\n      buyPayLoading: true,\n      sellPayments: [],\n      sellPayActive: '',\n      sellPayLoading: true,\n      side: '',\n      // 购买方向 买BUY 卖SELL\n      legal: '',\n      // 法币币种\n      coin: '',\n      // 数字货币\n      tradeType: '',\n      // 购买类型 1按金额交易 2按数量交易\n      tradeValue: '',\n      // 购买量\n      activePay: '',\n      // 当前选中的交易方式\n      consultPrice: '',\n      // 参考价格\n      balanceList: {},\n      // 所以币种余额\n      amountMax: '',\n      // 最大交易数量\n      amountMin: '',\n      // 最小交易数量\n      priceMax: '',\n      // 最小交易价格\n      priceMin: '',\n      // 最大交易价格\n      getBalanceReady: false,\n      // 是否获取完余额\n      firstGetNewPrice: false,\n      // 是否第一次获取报价\n      consultPriceReady: false,\n      // 是否拿到参考单价\n      balanceReady: false,\n      // 是否取得余额\n      dealLoading: false,\n      // 获取报价的loading\n      newPrice: {},\n      axiosTimer: null,\n      axiosTime: null,\n      showNewGet: false,\n      // 按钮展示是否重新获取 - 黄色button\n      btnLoading: false\n    };\n  },\n  watch: {\n    tradeValue: function tradeValue(v, oldV) {\n      if (this.selectCode === 1) {\n        this.tradeValue = fixInput(v, this.priceFix);\n      } else {\n        this.tradeValue = fixInput(v, this.valueFix);\n      }\n\n      if (parseFloat(v) !== parseFloat(oldV)) {\n        this.getNewPrice();\n      }\n    },\n    market: {\n      immediate: true,\n      handler: function handler(v) {\n        if (v) {\n          this.getInfo();\n          this.getBalance();\n        }\n      }\n    }\n  },\n  computed: {\n    btnObj: function btnObj() {\n      var obj = {\n        disbaled: true,\n        text: '',\n        class: '',\n        showTime: false\n      };\n      obj.disbaled = this.dealObj.btnDisabled;\n      obj.text = this.title;\n\n      if (!this.dealObj.btnDisabled && this.axiosTime) {\n        obj.showTime = true;\n      }\n\n      if (!this.dealObj.btnDisabled && this.showNewGet) {\n        obj.class = 'b-7-bg f-1-cl'; // 报价已过期，点击获取最新价格\n\n        obj.text = this.$t('mobilityTrade.btnHis');\n      }\n\n      return obj;\n    },\n    dealText: function dealText() {\n      var str = '';\n\n      if (this.side === 'BUY') {\n        if (this.tradeType === '1') {\n          // 输入购买金额后获取\n          str = this.$t('mobilityTrade.warn1');\n        } else if (this.tradeType === '2') {\n          // 输入购买数量后获取\n          str = this.$t('mobilityTrade.warn2');\n        }\n      } else if (this.side === 'SELL') {\n        if (this.tradeType === '1') {\n          // 输入出售金额后获取\n          str = this.$t('mobilityTrade.warn3');\n        } else if (this.tradeType === '2') {\n          // 输入出售数量后获取\n          str = this.$t('mobilityTrade.warn4');\n        }\n      }\n\n      return str;\n    },\n    axiosSellPayments: function axiosSellPayments() {\n      var str = '';\n      this.sellPayments.forEach(function (item) {\n        str += \"\".concat(item.payment, \",\");\n      });\n      return str;\n    },\n    axiosBuyPayments: function axiosBuyPayments() {\n      var str = '';\n      this.buyPayments.forEach(function (item) {\n        str += \"\".concat(item.key, \",\");\n      });\n      return str;\n    },\n    getNewPriceFlag: function getNewPriceFlag() {\n      var flag = false;\n\n      if (this.side === 'BUY') {\n        if (this.coin && this.legal && this.tradeType && this.errorObj.flag && this.buyPayments.length && this.consultPriceReady) {\n          flag = true;\n        }\n      } else if (this.side === 'SELL') {\n        if (this.coin && this.legal && this.tradeType && this.errorObj.flag && this.sellPayments.length && this.consultPriceReady) {\n          flag = true;\n        }\n      }\n\n      return flag;\n    },\n    errorObj: function errorObj() {\n      var obj = {\n        flag: true,\n        text: '',\n        showError: false\n      };\n      var tradeValue = parseFloat(this.tradeValue);\n      var amountMax = parseFloat(this.amountMax);\n      var amountMin = parseFloat(this.amountMin);\n      var priceMax = parseFloat(this.priceMax);\n      var priceMin = parseFloat(this.priceMin);\n      var valueBalance = parseFloat(this.nowBalance.value);\n      var priceBalance = parseFloat(this.nowBalance.price);\n\n      if (!tradeValue) {\n        obj.flag = false;\n        obj.text = '';\n        obj.showError = false;\n        return obj;\n      }\n\n      if (!this.getBalanceReady && this.side === 'SELL') {\n        obj.flag = false;\n        obj.text = '';\n        obj.showError = false;\n        return obj;\n      }\n\n      if (this.tradeType === '1') {\n        // 最大下单金额为 1 CNY\n        if (tradeValue > priceBalance && this.side === 'SELL') {\n          obj.flag = false;\n          obj.text = \"\".concat(this.$t('mobilityTrade.error1'), \" \").concat(this.nowBalance.price, \" \").concat(this.legal);\n          obj.showError = true;\n          return obj;\n        } // 下单数量需在1-2 CNY 之间”\n\n\n        if (priceMin > tradeValue || tradeValue > priceMax) {\n          obj.flag = false;\n          obj.text = \"\".concat(this.$t('mobilityTrade.error2'), \" \").concat(this.priceMin, \"-\").concat(this.priceMax, \" \").concat(this.legal);\n          obj.showError = true;\n          return obj;\n        }\n      } else if (this.tradeType === '2') {\n        // 最大下单金额为 1 BTC\n        if (tradeValue > valueBalance && this.side === 'SELL') {\n          obj.flag = false;\n          obj.text = \"\".concat(this.$t('mobilityTrade.error3'), \" \").concat(this.nowBalance.value, \" \").concat(this.coin);\n          obj.showError = true;\n          return obj;\n        } // 下单数量需在 1-2 BTC 之间”\n\n\n        if (amountMin > tradeValue || tradeValue > amountMax) {\n          obj.flag = false;\n          obj.text = \"\".concat(this.$t('mobilityTrade.error4'), \" \").concat(this.amountMin, \"-\").concat(this.amountMax, \" \").concat(this.coin);\n          obj.showError = true;\n          return obj;\n        }\n      }\n\n      return obj;\n    },\n    market: function market() {\n      return this.$store.state.baseData.market;\n    },\n    valueFix: function valueFix() {\n      var fix = this.$store.state.baseData.defaultFiatPrecision;\n\n      if (this.market && this.market.coinList[this.coin] && this.market.coinList[this.coin].showPrecision) {\n        fix = this.market.coinList[this.coin].showPrecision;\n      }\n\n      return fix;\n    },\n    priceFix: function priceFix() {\n      var fix = this.$store.state.baseData.defaultFiatPrecision;\n\n      if (this.market && this.market.coinList[this.coin] && this.market.coinList[this.coin].fiatPrecision && this.market.coinList[this.coin].fiatPrecision[this.legal.toLowerCase()]) {\n        fix = this.market.coinList[this.coin].fiatPrecision[this.legal.toLowerCase()];\n      }\n\n      return Number(fix);\n    },\n    nowBalance: function nowBalance() {\n      var price = '';\n      var value = '';\n\n      if (this.balanceList[this.coin] && this.consultPrice) {\n        value = fixD(this.balanceList[this.coin], this.valueFix);\n        price = fixD(this.balanceList[this.coin] * this.consultPrice * 0.9, this.priceFix);\n      }\n\n      return {\n        price: price,\n        value: value\n      };\n    },\n    priceText: function priceText() {\n      if (this.side === 'BUY') {\n        // 按金额购买\n        return this.$t('mobilityTrade.priceBuy');\n      }\n\n      if (this.side === 'SELL') {\n        // 按金额出售\n        return this.$t('mobilityTrade.priceSell');\n      }\n\n      return '';\n    },\n    valueText: function valueText() {\n      if (this.side === 'BUY') {\n        // 按数量购买\n        return this.$t('mobilityTrade.volumeBuy');\n      }\n\n      if (this.side === 'SELL') {\n        // 按数量出售\n        return this.$t('mobilityTrade.volumeSell');\n      }\n\n      return '';\n    },\n    sideTab: function sideTab() {\n      if (this.side === 'BUY') {\n        return 1;\n      }\n\n      if (this.side === 'SELL') {\n        return 2;\n      }\n\n      return 0;\n    },\n    sideList: function sideList() {\n      return [{\n        name: this.$t('mobilityTrade.immediatelyBuy'),\n        index: 1\n      }, {\n        name: this.$t('mobilityTrade.immediatelySell'),\n        index: 2\n      }];\n    },\n    inputCoin: function inputCoin() {\n      if (this.tradeType === '1') {\n        return this.legal;\n      }\n\n      return this.coin;\n    },\n    title: function title() {\n      if (this.side === 'BUY') {\n        return this.$t('mobilityTrade.immediatelyBuy');\n      }\n\n      if (this.side === 'SELL') {\n        return this.$t('mobilityTrade.immediatelySell');\n      }\n\n      return '';\n    },\n    nowObj: function nowObj() {\n      var obj = {};\n\n      if (this.side === 'BUY') {\n        obj = this.newPrice[this.buyPayActive] || {};\n      } else if (this.side === 'SELL') {\n        obj = this.newPrice[this.sellPayActive] || {};\n      }\n\n      return obj;\n    },\n    dealObj: function dealObj() {\n      var obj = this.nowObj;\n      var ret = {\n        price: '--',\n        value: '--',\n        sum: '--',\n        priceClass: '',\n        btnDisabled: true\n      };\n\n      if (this.side === 'SELL' && this.sellPayments.length || this.side === 'BUY') {\n        if (this.getNewPriceFlag) {\n          // 未找到合适报价，请修改下单条件\n          ret.price = obj.hasValue ? obj.price : this.$t('mobilityTrade.error5');\n          ret.value = obj.hasValue ? obj.amount : '--';\n          ret.sum = obj.hasValue ? obj.totalPrice : '--';\n          ret.priceClass = obj.hasValue ? '' : 'b-7-cl';\n          ret.btnDisabled = !obj.hasValue;\n        } else {\n          ret.price = this.dealText;\n          ret.btnDisabled = true;\n        }\n      } else {\n        // 请您先添加收款方式\n        ret.price = this.$t('mobilityTrade.error6');\n        ret.btnDisabled = true;\n      } // newPrice\n\n\n      return ret;\n    }\n  },\n  methods: {\n    btnClick: function btnClick() {\n      var _this = this;\n\n      if (this.showNewGet) {\n        this.btnLoading = true;\n        this.getNewPrice();\n      } else {\n        this.btnLoading = true;\n        this.axios({\n          url: this.side === 'BUY' ? '/flow/buy' : '/flow/sell',\n          params: {\n            side: this.side,\n            advertId: this.nowObj.advertId,\n            volume: this.nowObj.amount,\n            totalPrice: this.nowObj.totalPrice,\n            price: this.nowObj.price,\n            payment: this.nowObj.payment,\n            coinSymbol: this.nowObj.coin,\n            paySymbol: this.nowObj.payCoin,\n            payType: this.tradeType === '1' ? 'PRICE' : 'AMOUNT'\n          }\n        }).then(function (data) {\n          _this.btnLoading = false;\n\n          if (data.code.toString() === '0') {\n            _this.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'success'\n            });\n\n            window.open(data.data);\n\n            _this.$router.push('/order/otcOrder');\n          } else if (data.code.toString() === '101162') {\n            _this.axiosTime = 0;\n            clearInterval(_this.axiosTimer);\n            _this.showNewGet = true;\n            _this.btnLoading = false;\n          } else {\n            _this.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'error'\n            });\n          }\n        });\n      }\n    },\n    // 获取当前报价\n    getNewPrice: function getNewPrice() {\n      var _this2 = this;\n\n      if (!this.getNewPriceFlag) return;\n      this.dealLoading = true;\n      this.newPrice = {};\n      this.axios({\n        url: '/chainup/otc/coin/price',\n        params: {\n          symbol: this.coin,\n          payCoin: this.legal,\n          side: this.side === 'BUY' ? 'SELL' : 'BUY',\n          payType: this.tradeType === '1' ? 'PRICE' : 'AMOUNT',\n          payPrice: this.tradeType === '1' ? this.tradeValue : undefined,\n          payAmount: this.tradeType === '2' ? this.tradeValue : undefined,\n          payments: this.side === 'BUY' ? this.axiosBuyPayments : this.axiosSellPayments\n        }\n      }).then(function (data) {\n        _this2.axiosTime = 60;\n        _this2.showNewGet = false;\n        _this2.btnLoading = false;\n        clearInterval(_this2.axiosTimer);\n        _this2.axiosTimer = setInterval(function () {\n          _this2.axiosTime -= 1;\n\n          if (_this2.axiosTime === 0) {\n            clearInterval(_this2.axiosTimer);\n            _this2.showNewGet = true;\n            _this2.btnLoading = false;\n          }\n        }, 1000);\n\n        if (data.code.toString() === '0') {\n          setTimeout(function () {\n            _this2.dealLoading = false;\n            _this2.newPrice = data.data;\n          }, 1000);\n        } else {\n          _this2.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    allClick: function allClick() {\n      var amountMax = parseFloat(this.amountMax);\n      var priceMax = parseFloat(this.priceMax);\n      var valueBalance = parseFloat(this.nowBalance.value);\n      var priceBalance = parseFloat(this.nowBalance.price);\n\n      if (this.tradeType === '1') {\n        if (priceBalance <= priceMax) {\n          this.tradeValue = this.nowBalance.price;\n        } else {\n          this.tradeValue = this.priceMax;\n        }\n      } else if (this.tradeType === '2') {\n        if (valueBalance <= amountMax) {\n          this.tradeValue = this.nowBalance.value;\n        } else {\n          this.tradeValue = this.amountMax;\n        }\n      }\n    },\n    inputChanges: function inputChanges(value) {\n      this.tradeValue = value;\n    },\n    getInfo: function getInfo() {\n      var _this3 = this;\n\n      this.axios({\n        url: 'otc_flow_coin/info',\n        hostType: 'otc'\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          _this3.init(data.data);\n\n          _this3.getBuyPayments(data.data.payments);\n\n          _this3.getSellPayments();\n\n          _this3.getConsultPrice();\n        } else {\n          _this3.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    add: function add() {\n      this.$router.push('/personal/leaglTenderSet');\n    },\n    // 获取参考价格\n    getConsultPrice: function getConsultPrice() {\n      var _this4 = this;\n\n      this.consultPriceReady = false;\n      this.axios({\n        url: '/otc_flow_coin/consider_price_v4',\n        hostType: 'otc',\n        params: {\n          baseSymbol: this.coin,\n          coinSymbol: this.legal\n        }\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          _this4.consultPrice = data.data.referencePrice;\n          _this4.amountMax = fixD(data.data.amountMax, _this4.valueFix);\n          _this4.amountMin = fixD(data.data.amountMin, _this4.valueFix);\n          _this4.priceMax = fixD(data.data.priceMax, _this4.priceFix);\n          _this4.priceMin = fixD(data.data.priceMin, _this4.priceFix);\n          _this4.consultPriceReady = true;\n\n          if (_this4.side === 'BUY') {\n            _this4.getNewPrice();\n          } else if (_this4.side === 'SELL' && _this4.sellPayments.length && _this4.balanceReady) {\n            _this4.getNewPrice();\n          }\n        } else {\n          _this4.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    // 获取支付方式\n    getBuyPayments: function getBuyPayments(payments) {\n      // payments = [\n      //   { key: 'otc.payment.alipay', title: '支付宝' },\n      //   { key: 'otc.payment.wxpay', title: '微信' },\n      //   { key: 'otc.payment.domestic.bank.transfer', title: '银行卡' },\n      // ];\n      this.buyPayments = payments;\n\n      if (this.buyPayments.length) {\n        this.buyPayActive = this.buyPayments[0].key;\n      }\n\n      this.buyPayLoading = false;\n    },\n    // 获取收款方式\n    getSellPayments: function getSellPayments() {\n      var _this5 = this;\n\n      this.axios({\n        url: 'otc/payment/find',\n        hostType: 'otc'\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          var arr = [];\n          data.data.forEach(function (item) {\n            if (item.isOpen) {\n              arr.push(item);\n            }\n          });\n          _this5.sellPayments = arr;\n\n          if (arr.length) {\n            _this5.sellPayActive = arr[0].payment;\n          }\n\n          _this5.sellPayLoading = false;\n\n          if (_this5.side === 'SELL' && arr.length && _this5.balanceReady) {\n            _this5.getNewPrice();\n          }\n        } else {\n          _this5.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    // 初始化\n    init: function init(_ref) {\n      var defaultCoin = _ref.defaultCoin,\n          defaultSeach = _ref.defaultSeach,\n          otcDefaultPaycoin = _ref.otcDefaultPaycoin;\n      var _this$$route$query = this.$route.query,\n          side = _this$$route$query.side,\n          legal = _this$$route$query.legal,\n          coin = _this$$route$query.coin,\n          tradeType = _this$$route$query.tradeType,\n          tradeValue = _this$$route$query.tradeValue;\n      this.side = side || defaultSeach;\n      this.legal = legal || otcDefaultPaycoin;\n      this.coin = coin || defaultCoin;\n      this.tradeType = tradeType || '1';\n      this.tradeValue = tradeValue || '';\n    },\n    sideChange: function sideChange(item) {\n      if (item.index === this.sideTab) return;\n\n      if (item.index === 1) {\n        this.side = 'BUY';\n        this.tradeType = '1';\n      } else {\n        this.side = 'SELL';\n        this.tradeType = '2';\n      }\n\n      this.tradeValue = '';\n    },\n    setTradeType: function setTradeType(v) {\n      this.tradeType = v;\n      this.tradeValue = '';\n    },\n    buyPaymentsChange: function buyPaymentsChange(v) {\n      this.buyPayActive = v;\n    },\n    sellPaymentsChange: function sellPaymentsChange(v) {\n      this.sellPayActive = v;\n    },\n    getBalance: function getBalance() {\n      var _this6 = this;\n\n      this.axios({\n        url: 'finance/v4/otc_account_list'\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          _this6.balanceReady = true;\n          var obj = {};\n          data.data.allCoinMap.forEach(function (item) {\n            obj[item.coinSymbol] = item.normal;\n          });\n          _this6.balanceList = obj;\n          _this6.getBalanceReady = true;\n\n          if (_this6.side === 'SELL' && _this6.sellPayments.length && _this6.balanceReady) {\n            _this6.getNewPrice();\n          }\n        } else {\n          _this6.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    }\n  }\n};",null]}