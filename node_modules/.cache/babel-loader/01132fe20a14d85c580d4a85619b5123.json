{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/modules/trade/orderList/orderList.js","dependencies":[{"path":"/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/modules/trade/orderList/orderList.js","mtime":1642318930041},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport { fixD, formatTime, getCoinShowName, myStorage, imgMap, colorMap } from '@/utils';\nexport default {\n  name: 'orderList',\n  data: function data() {\n    return {\n      imgMap: imgMap,\n      colorMap: colorMap,\n      orderType: 1,\n      // 订单类型 1: 当前委托 2:历史委托\n      pagination: {\n        // 翻页数据\n        count: 0,\n        // 总数量\n        pageSize: 10,\n        // 每页显示条数\n        page: 1 // 当前页数\n\n      },\n      subTableDataId: null,\n      subTableDataIds: null,\n      // 当前货币对\n      symbolCurrent: myStorage.get('sSymbolName'),\n      // 撤销订单 防止重复点击\n      cancelFla: true,\n      getDataInter: null,\n      subTableData: [],\n      subLoading: false,\n      orderIdArrar: [],\n      tableLoading: false,\n      cancelOrderId: null,\n      timer: 15000,\n      cellHeight: 56\n    };\n  },\n  props: {\n    moduleType: {\n      type: String,\n      default: 'ex'\n    }\n  },\n  watch: {\n    isLogin: function isLogin(val) {\n      if (val) {\n        this.getData();\n      }\n    },\n    orderData: function orderData(val) {\n      if (val) {\n        if (val.count > 0) {\n          this.timer = 2000;\n        } else {\n          this.timer = 15000;\n        } // 轮训请求数据\n\n\n        this.intervalGet();\n        this.tableLoading = false;\n        this.pagination.count = val.count;\n      }\n    },\n    subData: function subData(val) {\n      if (val) {\n        this.subLoading = false;\n\n        if (val.id === this.subTableDataId) {\n          this.subTableData = this.setSubTableData(val.trade_list);\n        }\n      }\n    }\n  },\n  computed: {\n    coinSymbols: function coinSymbols() {\n      if (this.symbolCurrent) {\n        return this.symbolCurrent.replace('/', ',');\n      }\n\n      return '';\n    },\n    // 全部币种列表\n    coinList: function coinList() {\n      if (this.$store.state.baseData && this.$store.state.baseData.market) {\n        return this.$store.state.baseData.market.coinList;\n      }\n\n      return null;\n    },\n    titleBlockClass: function titleBlockClass() {\n      if (this.$store.state.baseData.templateLayoutType === '2') {\n        return 'a-5-bg';\n      }\n\n      return 'a-7-bg';\n    },\n    // 是否Login\n    isLogin: function isLogin() {\n      return this.$store.state.baseData.isLogin;\n    },\n    openOrderCollect: function openOrderCollect() {\n      if (this.$store.state.baseData.publicInfo) {\n        return this.$store.state.baseData.publicInfo.open_order_collect;\n      }\n\n      return null;\n    },\n    subData: function subData() {\n      return this.$store.state.tradeOrderList.subTableData;\n    },\n    // tab 项\n    tabTypeItem: function tabTypeItem() {\n      return [this.$t('trade.activeOrder'), // 当前委托\n      this.$t('trade.historyOrder') // 历史委托\n      ];\n    },\n    // 表头\n    columns: function columns() {\n      if (this.orderType === 2) {\n        return [{\n          title: this.$t('trade.time'),\n          // '时间',\n          width: '100px'\n        }, {\n          title: this.$t('trade.class'),\n          // '类别'\n          width: '200px'\n        }, {\n          title: this.$t('trade.transaction') // '交易对'\n\n        }, {\n          title: \"\".concat(this.$t('trade.price'), \"\\n            (\").concat(getCoinShowName(this.symbolUnit.units, this.coinList), \")\") // 价格\n\n        }, {\n          title: \"\".concat(this.$t('trade.number'), \"\\n            (\").concat(getCoinShowName(this.symbolUnit.symbol, this.coinList), \")\") // 数量\n\n        }, {\n          title: this.$t('trade.average') // '成交均价'\n\n        }, {\n          title: this.$t('trade.status') // '状态'\n\n        }, {\n          title: this.$t('trade.opera'),\n          // '操作'\n          width: '100px'\n        }];\n      }\n\n      return [{\n        title: this.$t('trade.time'),\n        // '时间',\n        width: '100px'\n      }, {\n        title: this.$t('trade.class'),\n        // '类别'\n        width: '150px'\n      }, {\n        title: \"\".concat(this.$t('trade.price'), \"\\n          (\").concat(getCoinShowName(this.symbolUnit.units, this.coinList), \")\") // 价格\n\n      }, {\n        title: \"\".concat(this.$t('trade.number'), \"\\n          (\").concat(getCoinShowName(this.symbolUnit.symbol, this.coinList), \")\") // 数量\n\n      }, {\n        title: \"\".concat(this.$t('trade.dealMoney'), \"\\n          (\").concat(getCoinShowName(this.symbolUnit.units, this.coinList), \")\") // 交易额\n\n      }, {\n        title: this.$t('trade.average') // '成交均价'\n\n      }, {\n        title: \"\".concat(this.$t('trade.deal'), \"/\").concat(this.$t('trade.noDeal')) // 已成交/未成交\n\n      }, {\n        title: this.$t('trade.opera'),\n        // '操作'\n        width: '100px',\n        classes: 'opera'\n      }];\n    },\n    subColumns: function subColumns() {\n      return [this.$t('trade.time'), this.$t('trade.price'), this.$t('trade.number'), this.$t('trade.turnover'), this.$t('trade.serviceCharge')];\n    },\n    // 当前币对小写\n    symbols: function symbols() {\n      if (this.symbolCurrent) {\n        var symbolArr = this.symbolCurrent.split('/');\n        var symbol = symbolArr[0].toLowerCase() + symbolArr[1].toLowerCase();\n        return symbol;\n      }\n\n      return null;\n    },\n    // 全部币对列表\n    symbolAll: function symbolAll() {\n      return this.$store.state.baseData.symbolAll;\n    },\n    // 当前币对\n    symbolUnit: function symbolUnit() {\n      if (this.symbolCurrent) {\n        return {\n          symbol: this.symbolCurrent.split('/')[0],\n          units: this.symbolCurrent.split('/')[1]\n        };\n      }\n\n      return {};\n    },\n    // 当前币对精度计算的值\n    fixValue: function fixValue() {\n      if (this.symbolAll && this.symbolCurrent) {\n        var symbol = this.symbolAll[this.symbolCurrent];\n        return {\n          priceFix: symbol.price,\n          volumeFix: symbol.volume\n        };\n      }\n\n      return {\n        priceFix: 2,\n        volumeFix: 8\n      };\n    },\n    orderData: function orderData() {\n      if (this.$store.state.tradeOrderList) {\n        return this.$store.state.tradeOrderList.nowOrderData;\n      } // if (this.orderType === 1 && this.$store.state.tradeOrderList) {\n      //   return this.$store.state.tradeOrderList.nowOrderData;\n      // }\n      // if (this.orderType === 2 && this.$store.state.tradeOrderList) {\n      //   return this.$store.state.tradeOrderList.historyData;\n      // }\n\n\n      return null;\n    },\n    dataList: function dataList() {\n      if (this.orderData && this.orderData.orderType === this.orderType) {\n        if (this.orderType === 1) {\n          return this.formData(this.orderData.orderList, this.cancelOrderId);\n        }\n\n        return this.formHistoryData(this.orderData.orderList);\n      }\n\n      return [];\n    }\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      // 获取 当前选中的货币对\n      this.symbolCurrent = myStorage.get('sSymbolName');\n\n      if (this.moduleType === 'lever') {\n        this.symbolCurrent = myStorage.get('leverSymbolName');\n      }\n\n      if (this.isLogin) {\n        this.getData(); // 轮训请求数据\n\n        this.intervalGet();\n      }\n\n      this.$bus.$on('SYMBOL_CURRENT', function (val) {\n        _this.symbolCurrent = val;\n\n        if (_this.isLogin) {\n          _this.pagination.page = 1;\n          _this.subTableDataId = null;\n          _this.tableLoading = true;\n\n          _this.getData();\n        }\n      }); // 监听下单成功\n\n      this.$bus.$on('ORDER_CREATE', function () {\n        _this.pagination.page = 1;\n\n        _this.getData();\n      });\n    },\n    // 查看全部订单\n    goOrderPage: function goOrderPage() {\n      // this.$router.push({path: '/order/exchangeOrder', query: {nowType: this.orderType}});\n      if (this.moduleType === 'lever') {\n        window.location.href = \"/order/leverageOrder?nowType=\".concat(this.orderType);\n      } else {\n        window.location.href = \"/order/exchangeOrder?nowType=\".concat(this.orderType);\n      }\n    },\n    // 轮训请求数据\n    intervalGet: function intervalGet() {\n      var _this2 = this;\n\n      clearInterval(this.getDataInter);\n      this.getDataInter = setInterval(function () {\n        _this2.getData(true);\n      }, this.timer);\n    },\n    // 判断 限价单 还是 市价单\n    setPrice: function setPrice(data) {\n      if (data.type === 1) {\n        return fixD(data.price, this.fixValue.priceFix);\n      }\n\n      return this.$t('trade.marketPrice');\n    },\n    // 格式化数据\n    formData: function formData(data, cancelOrderId) {\n      var _this3 = this;\n\n      var dataArray = data || [];\n      var newData = [];\n\n      if (dataArray.length) {\n        dataArray.forEach(function (item) {\n          if (cancelOrderId !== item.id) {\n            var showClose = true;\n\n            if (item.type === 2 || item.isCloseCancelOrder && item.isCloseCancelOrder.toString() === '1') {\n              showClose = false;\n            }\n\n            var tableData = {\n              id: item.id,\n              data: [formatTime(item.time_long), [{\n                text: item.side_text,\n                classes: item.side === 'BUY' ? 'u-1-cl' : 'u-4-cl'\n              }], [{\n                text: _this3.setPrice(item)\n              }], [{\n                text: fixD(item.volume, _this3.fixValue.volumeFix)\n              }], [{\n                text: fixD(item.total_price, _this3.fixValue.priceFix)\n              }], [{\n                text: fixD(item.avg_price, _this3.fixValue.priceFix)\n              }], [{\n                text: fixD(item.deal_volume, _this3.fixValue.volumeFix),\n                subContent: {\n                  text: fixD(item.remain_volume, _this3.fixValue.volumeFix)\n                }\n              }], [{\n                type: 'button',\n                text: _this3.$t('trade.cancelOrder'),\n                // 撤单\n                eventType: 'cancel',\n                classes: !showClose ? 'marketPriceOrder' : ''\n              }]]\n            };\n            newData.push(tableData);\n          }\n        });\n        return newData;\n      }\n\n      return [];\n    },\n    // 历史委托数据格式化\n    formHistoryData: function formHistoryData(data) {\n      var _this4 = this;\n\n      var dataArray = data || [];\n      var newData = [];\n      var idArr = [];\n\n      if (dataArray.length) {\n        dataArray.forEach(function (item) {\n          idArr.push(item.id);\n          var tableData = {\n            id: item.id,\n            data: [formatTime(item.time_long), [{\n              text: item.side_text,\n              classes: item.side === 'BUY' ? 'u-1-cl' : 'u-4-cl'\n            }], [{\n              text: \"\".concat(getCoinShowName(item.baseCoin, _this4.coinList), \"\\n                    /\").concat(getCoinShowName(item.countCoin, _this4.coinList))\n            }], [{\n              text: _this4.setPrice(item)\n            }], [{\n              text: fixD(item.volume, _this4.fixValue.volumeFix)\n            }], [{\n              text: fixD(item.avg_price, _this4.fixValue.priceFix)\n            }], [{\n              text: item.status_text\n            }]]\n          };\n          var subTableBtn = [];\n\n          if (item.status === 2 || item.status === 4 && parseFloat(item.deal_volume) !== 0) {\n            subTableBtn = [{\n              type: 'subTable',\n              text: _this4.$t('trade.view'),\n              // 详情\n              eventType: 'view'\n            }];\n          } else {\n            subTableBtn = [{\n              type: 'subTable',\n              text: _this4.$t('trade.view'),\n              // 详情\n              eventType: 'view',\n              classes: 'notShowe'\n            }];\n          }\n\n          tableData.data.push(subTableBtn);\n          newData.push(tableData);\n        }); // this.orderIdArrar = idArr;\n\n        return newData;\n      }\n\n      return [];\n    },\n    // sub table Data 格式化\n    setSubTableData: function setSubTableData(data) {\n      var _this5 = this;\n\n      var arr = [];\n\n      if (data.length) {\n        data.forEach(function (item) {\n          var ctime = item.ctime,\n              price = item.price,\n              volume = item.volume,\n              fee = item.fee,\n              feeCoin = item.feeCoin;\n          var dealPrice = item.deal_price;\n          arr.push({\n            ctime: ctime,\n            price: fixD(price, _this5.fixValue.priceFix),\n            volume: fixD(volume, _this5.fixValue.volumeFix),\n            dealPrice: fixD(dealPrice, _this5.fixValue.priceFix),\n            fee: \"\".concat(fee, \" \").concat(getCoinShowName(feeCoin, _this5.coinList).toUpperCase())\n          });\n        });\n        return arr;\n      }\n\n      return [];\n    },\n    // 切换订单类型\n    switchType: function switchType(index) {\n      this.orderType = index;\n      this.getData();\n\n      if (this.isLogin) {\n        this.subTableDataId = null;\n        this.pagination.page = 1;\n        this.subTableData = [];\n        this.orderIdArrar = [];\n        this.tableLoading = true;\n      }\n    },\n    elementClick: function elementClick(type, data) {\n      if (type === 'cancel') {\n        this.cancelOrderEvent(data);\n      } else {\n        this.getSubTableData(data);\n      }\n    },\n    // 查看详情\n    getSubTableData: function getSubTableData(data) {\n      if (data.open) {\n        this.subTableData = [];\n        this.subLoading = true;\n        this.subTableDataId = data.id;\n        var symbolArr = this.symbolCurrent.split('/');\n        var symbol = symbolArr[0].toLowerCase() + symbolArr[1].toLowerCase();\n        var url = this.$store.state.url.ordercenter.orderDetail;\n\n        if (this.moduleType === 'lever') {\n          url = this.$store.state.url.lever.list_by_order;\n        }\n\n        var params = {\n          url: url,\n          params: {\n            symbol: symbol,\n            order_id: data.id,\n            pageSize: this.pagination.pageSize\n          }\n        };\n        this.$store.dispatch('getSubTableData', params);\n      }\n    },\n    // 撤单\n    cancelOrderEvent: function cancelOrderEvent(id) {\n      var _this6 = this;\n\n      if (this.cancelFla) {\n        this.cancelFla = false;\n        var data = {\n          orderId: id,\n          symbol: this.symbols\n        };\n        var url = this.$store.state.url.ordercenter.cancelorder;\n\n        if (this.moduleType === 'lever') {\n          url = this.$store.state.url.lever.cancel;\n        }\n\n        this.axios({\n          url: url,\n          method: 'post',\n          params: data\n        }).then(function (rep) {\n          if (rep.code === '0') {\n            // this.getData();\n            _this6.cancelOrderId = id; // 重新请求资产\n\n            _this6.$store.dispatch('assetsExchangeData', {\n              auto: false,\n              coinSymbols: _this6.coinSymbols\n            }); // 撤单成功 提示\n\n\n            _this6.$bus.$emit('tip', {\n              text: _this6.$t('trade.cancelled'),\n              type: 'success'\n            });\n\n            _this6.cancelFla = true;\n          } else {\n            _this6.$bus.$emit('tip', {\n              text: rep.msg,\n              type: 'error'\n            });\n\n            _this6.cancelFla = true;\n          }\n        });\n      }\n    },\n    // 请求订单数据\n    getData: function getData(auto) {\n      if (this.symbolCurrent && this.isLogin) {\n        var url = this.$store.state.url.cointran.orderNew;\n\n        if (this.orderType === 2) {\n          url = this.$store.state.url.ordercenter.historyNew;\n        }\n\n        if (this.moduleType === 'lever') {\n          url = this.$store.state.url.lever.new;\n\n          if (this.orderType === 2) {\n            url = this.$store.state.url.lever.all;\n          }\n        }\n\n        var symbolArr = this.symbolCurrent.split('/');\n        var symbol = symbolArr[0].toLowerCase() + symbolArr[1].toLowerCase();\n        var data = {\n          url: url,\n          orderType: this.orderType,\n          params: {\n            symbol: symbol,\n            pageSize: this.pagination.pageSize\n          }\n        };\n\n        if (this.orderIdArrar.length && this.orderType === 2) {\n          data.params.idList = this.orderIdArrar;\n        } else {\n          data.params.page = this.pagination.page;\n        }\n\n        if (auto) {\n          data.auto = true;\n        }\n\n        this.$store.dispatch('getOrderListData', data);\n      }\n    },\n    // 翻页事件\n    pagechange: function pagechange(num) {\n      this.pagination.page = num;\n      this.subTableData = null;\n      this.subTableDataId = null;\n      this.orderIdArrar = [];\n      this.getData();\n    }\n  }\n};",null]}