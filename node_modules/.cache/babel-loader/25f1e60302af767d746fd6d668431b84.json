{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/h/partTimeJob/exchange-fe-server-privatization-master/app/view/src/components/modules/trade/gridDialog/GridDialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/app/view/src/components/modules/trade/gridDialog/GridDialog.vue","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport _toConsumableArray from \"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _defineProperty from \"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.number.constructor\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { colorMap, formatTime, fixD, getCoinShowName } from 'blockchain-ui-privatization/utils';\nimport GridTabel from \"./GridTabel.vue\";\nexport default {\n  name: 'GridDialog',\n  props: {\n    gridShowFlag: {\n      default: false,\n      type: Boolean\n    },\n    dataId: {\n      default: null,\n      type: [Number, String]\n    },\n    fixValue: {\n      default: null,\n      type: Object\n    },\n    type: {\n      // 网格状态已完成和正在执行\n      default: null,\n      type: [Number, String]\n    }\n  },\n  data: function data() {\n    return {\n      beingTabelList: [],\n      endTabelList: [],\n      tableLoading: false,\n      cellHeight: 38,\n      pagination: {\n        total: 0,\n        // 数据总条数\n        pageSize: 30,\n        // 每页显示条数\n        page: 1 // 当前页码\n\n      },\n      transactionType: 1,\n      // 选择哪个tab\n      colorMap: colorMap,\n      BeingLoding: false,\n      endLoding: false,\n      subTableData: [],\n      subLoading: false,\n      subTableDataId: null,\n      getDataInter: null,\n      gridData: {},\n      beingLeng: 0,\n      endLeng: 0,\n      timer: 5000\n    };\n  },\n  components: {\n    GridTabel: GridTabel\n  },\n  watch: {\n    gridShowFlag: function gridShowFlag(v) {\n      var _this = this;\n\n      if (v) {\n        this.$nextTick(function () {\n          _this.getGridData();\n\n          _this.intervalGet();\n\n          if (_this.$refs.dialog.offsetHeight % 2 !== 0) {\n            var str = \"\".concat(_this.$refs.dialog.offsetHeight + 1, \"px\");\n            _this.$refs.dialog.style.height = str;\n          }\n        });\n      }\n    }\n  },\n  computed: {\n    // 表头\n    columns: function columns() {\n      if (this.transactionType === 2) {\n        return [{\n          title: this.$t('gridTrade.dialog7'),\n          // '买盘',\n          width: '10%'\n        }, {\n          title: this.$t('gridTrade.dialog8'),\n          // '买入价格'\n          width: '30%'\n        }, {\n          title: this.$t('gridTrade.dialog9'),\n          // '卖出价格'\n          width: '30%'\n        }, {\n          title: this.$t('gridTrade.dialog10'),\n          // 卖盘\n          width: '25%'\n        }];\n      }\n\n      if (this.transactionType === 3) {\n        return [{\n          title: this.$t('trade.time'),\n          // '时间',\n          width: '300px'\n        }, {\n          title: \"\".concat(this.$t('gridTrade.dialog11'), \"(\").concat(this.symbol ? getCoinShowName(this.symbol[1], this.coinList) : '', \")\") // '利润'\n\n        }];\n      }\n\n      return [];\n    },\n    symbol: function symbol() {\n      var symbol = null;\n\n      if (this.gridData && this.gridData.symbol) {\n        symbol = this.gridData.symbol.split('/');\n      }\n\n      return symbol;\n    },\n    // 全部币种列表\n    coinList: function coinList() {\n      if (this.$store.state.baseData && this.$store.state.baseData.market) {\n        return this.$store.state.baseData.market.coinList;\n      }\n\n      return null;\n    }\n  },\n  methods: {\n    formatTime: formatTime,\n    fixD: fixD,\n    getCoinShowName: getCoinShowName,\n    dialogClose: function dialogClose() {\n      this.beingTabelList = [];\n      this.endTabelList = [];\n      this.tableLoading = false;\n      this.pagination.total = 0;\n      this.transactionType = 1; // 选择哪个tab\n\n      this.gridData = {};\n      this.beingLeng = 0;\n      this.endLeng = 0;\n      clearInterval(this.getDataInter);\n      this.getDataInter = null;\n      this.$emit('gridDialogClose');\n    },\n    // 点击tab\n    switchTradeType: function switchTradeType(val) {\n      this.transactionType = val;\n      this.pagination.total = 0;\n      this.pagination.page = 1; // 当前页码\n\n      clearInterval(this.getDataInter);\n      this.getDataInter = null;\n\n      if (val === 2) {\n        this.getBeingData();\n      } else if (val === 3) {\n        this.getEndData();\n      } else {\n        this.getGridData();\n        this.intervalGet();\n      }\n    },\n    // 轮训请求数据\n    intervalGet: function intervalGet() {\n      var _this2 = this;\n\n      clearInterval(this.getDataInter); // 如果定时器没有和等于详情tab和是正在进行再论训\n\n      if (!this.getDataInter && this.transactionType === 1 && this.type === 1) {\n        this.getDataInter = setInterval(function () {\n          _this2.getGridData();\n        }, this.timer);\n      }\n    },\n    // 翻页事件\n    pagechange: function pagechange(num) {\n      this.pagination.page = num;\n      this.subTableData = null;\n      this.subTableDataId = null; // this.orderIdArrar = [];\n\n      if (this.transactionType === 3) {\n        this.getEndData();\n      } else if (this.transactionType === 2) {\n        this.getBeingData();\n      }\n    },\n    setTime: function setTime(startTime, endTime) {\n      if (!Number(startTime)) {\n        return \"0\".concat(this.$t('otcDetailOrder.day'), \"0\").concat(this.$t('gridTrade.hours'), \"0\").concat(this.$t('otcDetailOrder.min'));\n      }\n\n      var dateEnd = new Date().getTime();\n\n      if (endTime) {\n        dateEnd = endTime;\n      }\n\n      var dateDiff = dateEnd - startTime; // 时间差的毫秒数\n\n      var day = Math.floor(dateDiff / (24 * 3600 * 1000)); // 计算出相差天数\\\n\n      var leave1 = dateDiff % (24 * 3600 * 1000); // 计算天数后剩余的毫秒数\n\n      var hours = Math.floor(leave1 / (3600 * 1000)); // 计算出小时数\n      // 计算相差分钟数\n\n      var leave2 = leave1 % (3600 * 1000); // 计算小时数后剩余的毫秒数\n\n      var minutes = Math.floor(leave2 / (60 * 1000)); // 计算相差分钟数\n\n      function s(t) {\n        return t < 10 && t > 0 ? \"0\".concat(t) : t;\n      }\n\n      return \"\".concat(s(day)).concat(this.$t('otcDetailOrder.day')).concat(s(hours)).concat(this.$t('gridTrade.hours')).concat(s(minutes)).concat(this.$t('otcDetailOrder.min'));\n    },\n    // 请求详情\n    getGridData: function getGridData() {\n      var _this3 = this;\n\n      var params = {\n        id: this.dataId\n      };\n      this.axios({\n        url: 'quant/getStrategyById ',\n        hostType: 'quant',\n        method: 'post',\n        params: params\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          if (data.data) {\n            _this3.gridData = _objectSpread({}, data.data); // 正在执行总条数\n\n            _this3.beingLeng = _this3.gridData.orderingCount; // 已执行总条数\n\n            _this3.endLeng = _this3.gridData.finishCount;\n          }\n        } else {\n          _this3.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    // 请求正在执行tabel\n    getBeingData: function getBeingData() {\n      var _this4 = this;\n\n      if (this.BeingLoding) {\n        return;\n      }\n\n      this.BeingLoding = true;\n      this.beingTabelList = [];\n      var params = {\n        strategyId: this.dataId\n      };\n      this.axios({\n        url: 'quant/getOrderingGridList',\n        hostType: 'quant',\n        method: 'post',\n        params: params\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          var newList = [];\n\n          if (data.data && data.data) {\n            if (data.data.BUY && data.data.BUY.length) {\n              data.data.BUY.forEach(function (item, i) {\n                if (!data.data.SELL[i]) {\n                  newList[i] = {\n                    id: i,\n                    data: [i + 1, [{\n                      text: fixD(item, _this4.fixValue.priceFix),\n                      classes: 'u-1-cl'\n                    }], null, null]\n                  };\n                } else {\n                  newList[i] = {\n                    id: i,\n                    data: [i + 1, [{\n                      text: fixD(item, _this4.fixValue.priceFix),\n                      classes: 'u-1-cl'\n                    }]]\n                  };\n                }\n              });\n            }\n\n            if (data.data.SELL && data.data.SELL.length) {\n              data.data.SELL.forEach(function (item, i) {\n                if (!newList[i]) {\n                  newList[i] = {\n                    id: i,\n                    data: [null, null, [{\n                      text: fixD(item, _this4.fixValue.priceFix),\n                      classes: 'u-4-cl'\n                    }], i + 1]\n                  };\n                } else {\n                  newList[i].data.push([{\n                    text: fixD(item, _this4.fixValue.priceFix),\n                    classes: 'u-4-cl'\n                  }], i + 1);\n                }\n              });\n            }\n\n            _this4.beingLeng = data.data.BUY.length + data.data.SELL.length;\n          }\n\n          _this4.beingTabelList = [].concat(newList);\n          _this4.BeingLoding = false;\n        } else {\n          _this4.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    // 请求已完成tabel\n    getEndData: function getEndData() {\n      var _this5 = this;\n\n      if (this.endLoding) {\n        return;\n      }\n\n      this.endLoding = true;\n      this.endTabelList = [];\n\n      if (this.gridData) {\n        var params = {\n          strategyId: this.dataId,\n          pageSize: this.pagination.pageSize,\n          page: this.pagination.page // 页码\n\n        };\n        this.axios({\n          url: 'quant/getFinishGridList',\n          hostType: 'quant',\n          method: 'post',\n          params: params\n        }).then(function (data) {\n          if (data.code.toString() === '0') {\n            var list = [];\n\n            if (data.data && data.data && data.data.list.length) {\n              data.data.list.forEach(function (item, i) {\n                var subData = [];\n\n                if (item.buyOrder && !item.sellOrder) {\n                  subData.push({\n                    typeText: item.buyOrder.orderSide === 'BUY' ? _this5.$t('trade.buy') : _this5.$t('trade.sell'),\n                    balanceSymbol: _this5.symbol ? getCoinShowName(_this5.symbol[1], _this5.coinList) : '',\n                    numSymbol: _this5.symbol ? getCoinShowName(_this5.symbol[0], _this5.coinList) : '',\n                    avgPrice: fixD(item.buyOrder.avgPrice, _this5.fixValue.priceFix),\n                    // 成交均价\n                    dealMoney: fixD(item.buyOrder.dealMoney, _this5.fixValue.priceFix),\n                    // 成交金额\n                    orderCtime: formatTime(item.buyOrder.orderCtime),\n                    type: 1,\n                    dealVolume: fixD(item.buyOrder.dealVolume, _this5.fixValue.volumeFix) // 成交数量\n\n                  });\n                } else if (item.buyOrder && item.sellOrder) {\n                  subData.push({\n                    typeText: item.buyOrder.orderSide === 'BUY' ? _this5.$t('trade.buy') : _this5.$t('trade.sell'),\n                    balanceSymbol: _this5.symbol ? getCoinShowName(_this5.symbol[1], _this5.coinList) : '',\n                    numSymbol: _this5.symbol ? getCoinShowName(_this5.symbol[0], _this5.coinList) : '',\n                    avgPrice: fixD(item.buyOrder.avgPrice, _this5.fixValue.priceFix),\n                    // 成交均价\n                    dealMoney: fixD(item.buyOrder.dealMoney, _this5.fixValue.priceFix),\n                    // 成交金额\n                    orderCtime: formatTime(item.buyOrder.orderCtime),\n                    type: 1,\n                    dealVolume: fixD(item.buyOrder.dealVolume, _this5.fixValue.volumeFix) // 成交数量\n\n                  }, {\n                    typeText: item.sellOrder.orderSide === 'BUY' ? _this5.$t('trade.buy') : _this5.$t('trade.sell'),\n                    balanceSymbol: _this5.symbol ? getCoinShowName(_this5.symbol[1], _this5.coinList) : '',\n                    numSymbol: _this5.symbol ? getCoinShowName(_this5.symbol[0], _this5.coinList) : '',\n                    type: 2,\n                    orderCtime: formatTime(item.sellOrder.orderCtime),\n                    avgPrice: fixD(item.sellOrder.avgPrice, _this5.fixValue.priceFix),\n                    // 成交均价\n                    dealMoney: fixD(item.sellOrder.dealMoney, _this5.fixValue.priceFix),\n                    // 成交金额\n                    dealVolume: fixD(item.sellOrder.dealVolume, _this5.fixValue.volumeFix) // 成交数量\n\n                  });\n                } else if (!item.buyOrder && item.sellOrder) {\n                  subData.push({\n                    typeText: item.sellOrder.orderSide === 'BUY' ? _this5.$t('trade.buy') : _this5.$t('trade.sell'),\n                    balanceSymbol: _this5.symbol ? getCoinShowName(_this5.symbol[1], _this5.coinList) : '',\n                    numSymbol: _this5.symbol ? getCoinShowName(_this5.symbol[0], _this5.coinList) : '',\n                    type: 2,\n                    orderCtime: formatTime(item.sellOrder.orderCtime),\n                    avgPrice: fixD(item.sellOrder.avgPrice, _this5.fixValue.priceFix),\n                    // 成交均价\n                    dealMoney: fixD(item.sellOrder.dealMoney, _this5.fixValue.priceFix),\n                    // 成交金额\n                    dealVolume: fixD(item.sellOrder.dealVolume, _this5.fixValue.volumeFix) // 成交数量\n\n                  });\n                }\n\n                list.push({\n                  id: i,\n                  data: [[{\n                    classes: 'size_text',\n                    text: item.buyTime ? formatTime(item.buyTime) : '--'\n                  }], [{\n                    type: 'subTable',\n                    text: item.profit ? fixD(item.profit, _this5.fixValue.priceFix) : '--',\n                    eventType: 'view',\n                    classes: 'u-1-cl size_text'\n                  }]],\n                  subData: subData\n                });\n              });\n            }\n\n            _this5.endTabelList = [].concat(list);\n            _this5.endLeng = data.data.count; // 已执行总条数\n\n            _this5.endLoding = false;\n            _this5.pagination.total = data.data.count;\n          } else {\n            _this5.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'error'\n            });\n          }\n        });\n      }\n    },\n    elementClick: function elementClick(type, data) {\n      this.setSubTableData(data);\n    },\n    // 查看详情\n    setSubTableData: function setSubTableData(data) {\n      var _this6 = this;\n\n      this.subLoading = true;\n      this.subTableDataId = data.id;\n      this.subTableData = [];\n\n      if (this.endTabelList.length) {\n        this.endTabelList.forEach(function (item) {\n          if (item.id === data.id) {\n            _this6.subTableData = _toConsumableArray(item.subData);\n          }\n        });\n      }\n\n      this.subLoading = false;\n    }\n  }\n};",null]}