{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/assets/b2cWithdraw/b2cWithdraw.js","dependencies":[{"path":"/Users/h/partTimeJob/blockchain-ui-privatization/PC/common-mixin/assets/b2cWithdraw/b2cWithdraw.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport { fixD, fixInput, imgMap } from '@/utils';\nexport default {\n  data: function data() {\n    return {\n      imgMap: imgMap,\n      tabelLoading: true,\n      detailsList: [{\n        key: 'totalBalance',\n        value: '--'\n      }, {\n        key: 'normalBalance',\n        value: '--'\n      }, {\n        key: 'lockBalance',\n        value: '--'\n      }],\n      withdrawMin: '--',\n      // 最小提币额度\n      withdrawMax: '--',\n      // 最大提币额度\n      daywithdrawMax: '--',\n      // 最大提币额度\n      symbol: '',\n      addressValue: '',\n      // 提现地址\n      numberValue: '',\n      // 提币数量\n      addressList: [],\n      // 提现地址列表\n      dialogFlag: false,\n      // 弹窗开关\n      dialogConfirmLoading: false,\n      // 弹窗按钮loading\n      googleValue: '',\n      // 谷歌\n      phoneValue: '',\n      // 手机\n      nowSymbolMess: {},\n      feeList: {},\n      warning: ''\n    };\n  },\n  filters: {\n    fixDFn: function fixDFn(v, showPrecision) {\n      return fixD(v, showPrecision);\n    }\n  },\n  watch: {\n    numberValue: function numberValue(v) {\n      this.numberValue = fixInput(v, this.showPrecision);\n    },\n    market: {\n      handler: function handler(v) {\n        if (v && this.symbol) {\n          this.getMessage();\n        }\n      }\n    }\n  },\n  computed: {\n    inputW: function inputW() {\n      var str = '';\n\n      if (this.isOther) {\n        str = \"\".concat(this.$t('assets.withdraw.NumberOfCoins'), \"\\uFF08\").concat(this.symbol, \"\\uFF09\");\n      } else {\n        str = this.$t('assets.withdraw.NumberOfCoins');\n      }\n\n      return str;\n    },\n    aikrw: function aikrw() {\n      var str = '--';\n\n      if (this.isOther && this.arrivalAccount !== '--') {\n        str = this.arrivalAccount * 1000;\n      }\n\n      return str;\n    },\n    isOther: function isOther() {\n      return this.symbol === 'AIKRW';\n    },\n    buttonDisabled: function buttonDisabled() {\n      if (this.numberValueObj.flag && this.feeList[this.addressValue]) {\n        return false;\n      }\n\n      return true;\n    },\n    numberValueObj: function numberValueObj() {\n      var flag = true;\n      var showError = false;\n      var text = '';\n      var inp = parseFloat(this.numberValue);\n      var haveNum = parseFloat(this.detailsList[1].value) || 0; // 可用\n\n      var max = parseFloat(this.withdrawMax) || 0; // 最大\n\n      var min = parseFloat(this.withdrawMin) || 0; // 最小\n\n      var day = parseFloat(this.daywithdrawMax) || 0; // 最小\n\n      if (!inp) {\n        flag = false;\n        showError = false;\n      } else if (inp < min) {\n        flag = false;\n        showError = true; // 单笔提现金额不得小于\n\n        var warn = this.$t('assets.b2c.withdrawMinWarn');\n        text = \"\".concat(warn).concat(this.withdrawMin, \" \").concat(this.symbol);\n      } else if (inp > max) {\n        flag = false;\n        showError = true; // 单笔提现金额不得大于\n\n        var _warn = this.$t('assets.b2c.withdrawMaxWarn');\n\n        text = \"\".concat(_warn).concat(this.withdrawMax, \" \").concat(this.symbol);\n      } else if (inp > day) {\n        flag = false;\n        showError = true; // 今日可提现金额\n\n        var _warn2 = this.$t('assets.b2c.withdrawDayWarn');\n\n        text = \"\".concat(_warn2).concat(this.daywithdrawMax, \" \").concat(this.symbol);\n      } else if (inp > haveNum) {\n        flag = false;\n        showError = true; // 可用余额为\n\n        var _warn3 = this.$t('assets.b2c.withdrawHaveWarn');\n\n        text = \"\".concat(_warn3).concat(this.detailsList[1].value, \" \").concat(this.symbol);\n      }\n\n      return {\n        flag: flag,\n        showError: showError,\n        text: text\n      };\n    },\n    showSymbol: function showSymbol() {\n      var str = this.symbol;\n      return str;\n    },\n    // 当前币种精度\n    showPrecision: function showPrecision() {\n      var v = 0;\n      var market = this.$store.state.baseData.market;\n\n      if (market && market.coinList && market.coinList[this.symbol]) {\n        v = market.coinList[this.symbol].showPrecision;\n      }\n\n      return v;\n    },\n    // finance/account_balance 接口返回成功的数据\n    exchangeData: function exchangeData() {\n      return this.$store.state.assets.exchangeData;\n    },\n    // market 接口\n    market: function market() {\n      return this.$store.state.baseData.market;\n    },\n    // phoneValue 是否复合正则验证\n    phoneValueFlag: function phoneValueFlag() {\n      return this.$store.state.regExp.verification.test(this.phoneValue);\n    },\n    // googleValue 是否复合正则验证\n    googleValueFlag: function googleValueFlag() {\n      return this.$store.state.regExp.verification.test(this.googleValue);\n    },\n    phoneError: function phoneError() {\n      if (this.phoneValue.length !== 0 && !this.phoneValueFlag) return true;\n      return false;\n    },\n    googleError: function googleError() {\n      if (this.googleValue.length !== 0 && !this.googleValueFlag) return true;\n      return false;\n    },\n    // 弹窗确认按钮\n    dialogConfirmDisabled: function dialogConfirmDisabled() {\n      var phone = true;\n      var google = true;\n\n      if (this.OpenMobile) {\n        phone = this.phoneValueFlag;\n      }\n\n      if (this.OpenGoogle) {\n        google = this.googleValueFlag;\n      }\n\n      if (phone && google || this.dialogConfirmLoading) {\n        return false;\n      }\n\n      return true;\n    },\n    that: function that() {\n      return this;\n    },\n    arrivalAccount: function arrivalAccount() {\n      if (!this.numberValueObj.flag) return '--';\n\n      if (this.fee !== '--') {\n        return fixD(parseFloat(this.numberValue) - parseFloat(this.fee), this.showPrecision);\n      }\n\n      return '--';\n    },\n    fee: function fee() {\n      if (!this.numberValueObj.flag) return '--';\n\n      if (this.feeList[this.addressValue] && this.market) {\n        var _this$feeList$this$ad = this.feeList[this.addressValue],\n            fee = _this$feeList$this$ad.fee,\n            feeType = _this$feeList$this$ad.feeType; // if(this.addressValue === '81') {\n        //   fee = 1\n        //   feeType = 0\n        // }\n        // 百分比\n\n        if (feeType) {\n          var feeFix = fee / 100;\n          return fixD(this.numberValue * feeFix, this.showPrecision); // 固定值\n        }\n\n        return fixD(fee, this.showPrecision);\n      }\n\n      return '--';\n    }\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      // 如果不存在币种跳走\n      if (this.$route.query.symbol) {\n        this.symbol = this.$route.query.symbol.toUpperCase();\n      } else {\n        this.$router.push('/assets/exchangeAccount');\n      }\n\n      this.$bus.$on('getMess', function () {\n        _this.getMessage();\n      });\n\n      if (this.market && this.symbol) {\n        this.getMessage();\n      }\n\n      this.getBankList();\n    },\n    getMessage: function getMessage() {\n      var _this2 = this;\n\n      this.axios({\n        url: 'fiat/balance',\n        params: {\n          symbol: this.symbol\n        }\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          var obj = {};\n          data.data.allCoinMap.forEach(function (item) {\n            if (item.symbol === _this2.symbol) {\n              obj = item;\n            }\n          });\n          _this2.nowSymbolMess = obj;\n\n          _this2.detailsList.forEach(function (item, index) {\n            _this2.detailsList[index].value = fixD(obj[item.key], _this2.showPrecision);\n          });\n\n          _this2.withdrawMin = fixD(obj.withdrawMin, _this2.showPrecision);\n          _this2.withdrawMax = fixD(obj.withdrawMax, _this2.showPrecision);\n          _this2.daywithdrawMax = fixD(obj.canWithdrawBalance, _this2.showPrecision);\n          _this2.warning = data.data.withdrawTip;\n        } else {\n          _this2.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    getBankList: function getBankList() {\n      var _this3 = this;\n\n      this.axios({\n        url: '/bank/all',\n        params: {\n          symbol: this.symbol\n        }\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          var obj = {};\n          data.data.forEach(function (item) {\n            obj[item.bankNo.toString()] = item.accountName;\n          });\n\n          _this3.getUserBank(obj);\n        } else {\n          _this3.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    getUserBank: function getUserBank(bankObj) {\n      var _this4 = this;\n\n      this.axios({\n        url: 'user/bank/user_bank_list',\n        params: {\n          pageSize: 100,\n          // 每页条数\n          page: 1,\n          // 页码\n          symbol: this.symbol\n        }\n      }).then(function (data) {\n        if (data.code.toString() === '0') {\n          var list = [];\n          var feeList = {};\n          data.data.list.forEach(function (item) {\n            list.push({\n              code: \"\".concat(item.id),\n              value: \"\".concat(item.cardNo),\n              label: \"\".concat(bankObj[item.bankNo], \"(\").concat(item.name, \")\")\n            });\n            feeList[item.id] = item;\n          });\n          _this4.feeList = feeList;\n          _this4.addressList = list;\n        } else {\n          _this4.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    },\n    goAddress: function goAddress() {\n      this.$router.push(\"/assets/b2cAddressMent?symbol=\".concat(this.symbol));\n    },\n    inputChange: function inputChange(v, name) {\n      this[name] = v;\n    },\n    // 提现select框 change\n    addressChange: function addressChange(item) {\n      this.addressValue = item.code;\n    },\n    // 全部提现\n    allWithDraw: function allWithDraw() {\n      if (this.detailsList[1].value === '--') return;\n      this.numberValue = this.detailsList[1].value;\n    },\n    // 获取验证码\n    getCodeClick: function getCodeClick() {\n      this.sendSmsCode();\n    },\n    // 发送验证码\n    sendSmsCode: function sendSmsCode() {\n      var _this5 = this;\n\n      this.axios({\n        url: 'v4/common/smsValidCode',\n        params: {\n          operationType: '32'\n        }\n      }).then(function (data) {\n        if (data.code.toString() !== '0') {\n          setTimeout(function () {\n            // 倒计时重置\n            _this5.$bus.$emit('getCode-clear', 'withdrawGetcode'); // tip框提示错误\n\n\n            _this5.$bus.$emit('tip', {\n              text: data.msg,\n              type: 'error'\n            });\n          }, 2000);\n        } else {\n          _this5.$bus.$emit('tip', {\n            text: _this5.$t('assets.withdraw.phoneSendSuccess'),\n            type: 'success'\n          });\n        }\n      });\n    },\n    withdrawClick: function withdrawClick() {\n      this.dialogFlag = true;\n    },\n    // 弹窗关闭\n    dialogClose: function dialogClose() {\n      this.phoneValue = '';\n      this.googleValue = '';\n      this.dialogFlag = false;\n    },\n    // 弹窗确认\n    dialogConfirm: function dialogConfirm() {\n      var _this6 = this;\n\n      this.dialogConfirmLoading = true;\n      this.axios({\n        url: '/fiat/withdraw',\n        params: {\n          symbol: this.symbol,\n          userWithdrawBankId: this.addressValue,\n          amount: this.numberValue,\n          smsAuthCode: this.phoneValue || undefined,\n          googleCode: this.googleValue || undefined\n        }\n      }).then(function (data) {\n        _this6.dialogConfirmLoading = false;\n\n        if (data.code.toString() === '0') {\n          // this.getTableList(); // 获取列表\n          // this.$store.dispatch('assetsExchangeData'); // 更新额度\n          _this6.$bus.$emit('b2cWithdrawHisGet');\n\n          _this6.getMessage();\n\n          _this6.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'success'\n          });\n\n          _this6.addressValue = '';\n          _this6.numberValue = '';\n          _this6.phoneValue = '';\n          _this6.googleValue = '';\n          _this6.dialogFlag = false;\n        } else {\n          _this6.$bus.$emit('tip', {\n            text: data.msg,\n            type: 'error'\n          });\n        }\n      });\n    }\n  }\n};",null]}