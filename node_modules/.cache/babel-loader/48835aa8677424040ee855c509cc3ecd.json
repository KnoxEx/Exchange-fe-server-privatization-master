{"remainingRequest":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js!/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js??ref--13-0!/Users/h/Downloads/BlockChain-ui-privatization/PC/common-mixin/contract/index/index.js","dependencies":[{"path":"/Users/h/Downloads/BlockChain-ui-privatization/PC/common-mixin/contract/index/index.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/babel.config.js","mtime":1620459862000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/h/partTimeJob/exchange-fe-server-privatization-master/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import futureWorker from '@/utils/futureWorker';\nexport default {\n  name: 'trade',\n  data: function data() {\n    return {\n      // 数据\n      marketData: null,\n      // MywebSocket\n      MywebSocket: null,\n      // 深度值\n      depthValue: 0,\n      // 图表遮罩\n      coverKlineBox: null,\n      // 开通合约交易弹框\n      openFuturesDialogShow: false,\n      // 交易喜好设置弹框\n      setFuturesDialogShow: false,\n      // 计算器弹框\n      calculatorDialogShow: false,\n      // 轮训\n      getPositionTimer: null,\n      // 下单选择类型弹框是否显示\n      subOtderTypeShow: null\n    };\n  },\n  computed: {\n    worker: function worker() {\n      return futureWorker();\n    },\n    // 是否Login\n    isLogin: function isLogin() {\n      return this.$store.state.baseData.isLogin;\n    },\n    // WS URL\n    wsUrl: function wsUrl() {\n      return this.$store.state.future.wsUrl || null;\n    },\n    // 用户配置信息\n    userConfig: function userConfig() {\n      return this.$store.state.future.futureUserConfig;\n    },\n    // 合约币对列表\n    contractSymbolList: function contractSymbolList() {\n      return this.$store.state.future.contractSymbolList;\n    },\n    // 是否开通了合约交易\n    openContract: function openContract() {\n      return this.$store.state.future.openContract;\n    },\n    // 当前币对小写带类型\n    symbolCurrent: function symbolCurrent() {\n      return this.$store.state.future.coTypeSymbol;\n    },\n    contractName: function contractName() {\n      return this.$store.state.future.contractName || '';\n    }\n  },\n  watch: {\n    // wsUrl\n    wsUrl: function wsUrl(val, old) {\n      if (val && !old) {\n        this.worker.postMessage({\n          type: 'CREAT_WEBSOCKET',\n          data: {\n            wsUrl: val,\n            lan: this.$store.state.baseData.lan,\n            rate: '',\n            symbolAll: {}\n          }\n        });\n      }\n    },\n    // 监听 用户配置信息\n    openContract: function openContract(val) {\n      if (!val) {\n        this.openFuturesDialogShow = true;\n      }\n    },\n    // 监听 当前选中货币对的改变\n    contractName: function contractName(val) {\n      if (val) {\n        this.$router.push(\"/trade/\".concat(val));\n        this.$bus.$emit('SYMBOL_CURRENT', val);\n      }\n    },\n    symbolCurrent: function symbolCurrent(val, oldVla) {\n      if (oldVla && this.MywebSocket) {\n        // 停止 上一个币对的 实时成交 send\n        this.webSocketSend('Trade', 'unsub', oldVla); // 发送 实时成交 数据 Send\n\n        this.webSocketSend('Trade', 'req', val);\n        this.webSocketSend('Trade', 'sub', val); // 停止 盘口深度数据 Send\n\n        this.webSocketSend('Depth', 'unsub', oldVla, this.depthValue); // 发送 盘口深度 数据 Send\n\n        this.webSocketSend('Depth', 'sub', val, this.depthValue);\n      }\n    },\n    // 监听 webSocket 创建成功\n    MywebSocket: function MywebSocket(val) {\n      if (val) {\n        // 发送 24小时行情历史数据 Send\n        this.webSocketSend('Review'); // 发送 24小时行情实时数据 Send\n\n        this.webSocketSend('Market', 'sub', this.symbolCurrent, this.contractSymbolList); // 发送 盘口深度数据 Send\n\n        this.webSocketSend('Depth', 'sub', this.symbolCurrent, this.depthValue); // // 发送 实时成交 数据 Send\n\n        this.webSocketSend('Trade', 'req', this.symbolCurrent);\n        this.webSocketSend('Trade', 'sub', this.symbolCurrent);\n      }\n    },\n    // 深度值切换\n    depthValue: function depthValue(val, old) {\n      if (old) {\n        this.webSocketSend('Depth', 'unsub', this.symbolCurrent, old);\n      }\n\n      this.webSocketSend('Depth', 'sub', this.symbolCurrent, val);\n    }\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      // 轮训获取数据\n      this.intervalGetData(); // 获取worker信息\n\n      this.worker.onmessage = function (event) {\n        var data = event.data; // 监听 WebSocket 链接成功\n\n        if (data.type === 'WEBSOCKET_ON_OPEN') {\n          _this.MywebSocket = null;\n          _this.MywebSocket = data.data.type;\n\n          _this.$bus.$emit('WEBSOCKET_ON_OPEN', _this.MywebSocket);\n        } // 监听 WS 数据\n\n\n        if (data.type === 'WEBSOCKET_DATA') {\n          _this.listenWSData(data.data);\n        }\n      };\n\n      this.listenBusEvent();\n    },\n    listenBusEvent: function listenBusEvent() {\n      var _this2 = this;\n\n      if (this.wsUrl) {\n        this.worker.postMessage({\n          type: 'CREAT_WEBSOCKET',\n          data: {\n            wsUrl: this.wsUrl,\n            lan: this.$store.state.baseData.lan,\n            rate: '',\n            symbolAll: {}\n          }\n        });\n      } // 显示开通合约弹框\n\n\n      this.$bus.$on('OPEN_FUTURE', function () {\n        _this2.openFuturesDialogShow = true;\n      }); // 显示偏好设置弹框\n\n      this.$bus.$on('SET_FUTURE_CONFIG', function () {\n        if (_this2.isLogin && _this2.openContract) {\n          _this2.$store.dispatch('getUserConfig');\n        }\n\n        _this2.setFuturesDialogShow = true;\n      }); // 显示计算器弹框\n\n      this.$bus.$on('OPEN_CALCULATOR_DIALOG', function () {\n        _this2.calculatorDialogShow = true;\n      }); // 监听 深度级别的值\n\n      this.$bus.$on('DEPTH_VALUE', function (data) {\n        _this2.depthValue = data;\n      }); // 监听 kline 发送Send\n\n      this.$bus.$on('WEBSOCKET_KLINE_SEND', function (data) {\n        _this2.worker.postMessage({\n          type: 'WEBSOCKET_KLINE_SEND',\n          data: data\n        });\n      });\n    },\n    // 分发WS数据\n    listenWSData: function listenWSData(data) {\n      var type = data.type,\n          WsData = data.WsData;\n      this.$bus.$emit(type, WsData);\n    },\n    webSocketSend: function webSocketSend(type, sendType, symbolData, symbolList) {\n      this.worker.postMessage({\n        type: 'WEBSOCKET_SEND',\n        data: {\n          type: type,\n          sendType: sendType,\n          symbolData: symbolData,\n          symbolList: symbolList,\n          depthValue: 0\n        }\n      });\n    },\n    ondblclick: function ondblclick() {\n      return false;\n    },\n    onclickfun: function onclickfun(e) {\n      // 显示和隐藏币币交易页面 TradingView 的遮罩\n      if (e.target.className === 'coverKlineBox') {\n        this.coverKlineBox = e.target;\n      }\n\n      if (e.target.className === 'coverKlineBox') {\n        this.coverKlineBox.style.display = 'none';\n      } else if (this.coverKlineBox) {\n        this.coverKlineBox.style.display = 'block';\n        this.coverKlineBox = null;\n      }\n\n      if (e.target && e.target.className && e.target.className.indexOf && e.target.className.indexOf('ac-type') > -1) {\n        this.subOtderTypeShow = e.target.nextElementSibling;\n      } else if (this.subOtderTypeShow) {\n        this.subOtderTypeShow.style.display = 'none';\n        this.subOtderTypeShow = null;\n      }\n    },\n    // 关闭弹窗\n    closeDialog: function closeDialog() {\n      // 关闭开通合约交易弹框\n      this.openFuturesDialogShow = false; // 关闭喜好设置弹框\n\n      this.setFuturesDialogShow = false; // 关闭计算器弹框\n\n      this.calculatorDialogShow = false;\n    },\n    intervalGetData: function intervalGetData() {\n      var _this3 = this;\n\n      // 获取用户持仓和资产列表\n      clearInterval(this.getPositionTimer);\n      this.getPositionTimer = setInterval(function () {\n        if (_this3.isLogin && _this3.openContract) {\n          _this3.$store.dispatch('getPositionList');\n\n          _this3.$store.dispatch('getUserOrderCount');\n        } else {\n          clearInterval(_this3.getPositionTimer);\n          _this3.getPositionTimer = null;\n        }\n      }, 5000);\n    }\n  },\n  destroyed: function destroyed() {\n    this.$bus.$off('OPEN_FUTURE');\n    this.$bus.$off('SET_FUTURE_CONFIG');\n    this.$bus.$off('OPEN_CALCULATOR_DIALOG');\n    this.$bus.$off('DEPTH_VALUE');\n    this.$bus.$off('WEBSOCKET_KLINE_SEND');\n    clearInterval(this.getPositionTimer);\n    this.getPositionTimer = null;\n  }\n};",{"version":3,"sources":["/Users/h/Downloads/BlockChain-ui-privatization/PC/common-mixin/contract/index/index.js"],"names":["futureWorker","name","data","marketData","MywebSocket","depthValue","coverKlineBox","openFuturesDialogShow","setFuturesDialogShow","calculatorDialogShow","getPositionTimer","subOtderTypeShow","computed","worker","isLogin","$store","state","baseData","wsUrl","future","userConfig","futureUserConfig","contractSymbolList","openContract","symbolCurrent","coTypeSymbol","contractName","watch","val","old","postMessage","type","lan","rate","symbolAll","$router","push","$bus","$emit","oldVla","webSocketSend","methods","init","intervalGetData","onmessage","event","listenWSData","listenBusEvent","$on","dispatch","WsData","sendType","symbolData","symbolList","ondblclick","onclickfun","e","target","className","style","display","indexOf","nextElementSibling","closeDialog","clearInterval","setInterval","destroyed","$off"],"mappings":"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","sourcesContent":["import futureWorker from '@/utils/futureWorker';\r\n\r\nexport default {\r\n  name: 'trade',\r\n  data() {\r\n    return {\r\n      // 数据\r\n      marketData: null,\r\n      // MywebSocket\r\n      MywebSocket: null,\r\n      // 深度值\r\n      depthValue: 0,\r\n      // 图表遮罩\r\n      coverKlineBox: null,\r\n      // 开通合约交易弹框\r\n      openFuturesDialogShow: false,\r\n      // 交易喜好设置弹框\r\n      setFuturesDialogShow: false,\r\n      // 计算器弹框\r\n      calculatorDialogShow: false,\r\n      // 轮训\r\n      getPositionTimer: null,\r\n      // 下单选择类型弹框是否显示\r\n      subOtderTypeShow: null,\r\n    };\r\n  },\r\n  computed: {\r\n    worker() {\r\n      return futureWorker();\r\n    },\r\n    // 是否Login\r\n    isLogin() {\r\n      return this.$store.state.baseData.isLogin;\r\n    },\r\n    // WS URL\r\n    wsUrl() {\r\n      return this.$store.state.future.wsUrl || null;\r\n    },\r\n    // 用户配置信息\r\n    userConfig() {\r\n      return this.$store.state.future.futureUserConfig;\r\n    },\r\n    // 合约币对列表\r\n    contractSymbolList() {\r\n      return this.$store.state.future.contractSymbolList;\r\n    },\r\n    // 是否开通了合约交易\r\n    openContract() {\r\n      return this.$store.state.future.openContract;\r\n    },\r\n    // 当前币对小写带类型\r\n    symbolCurrent() {\r\n      return this.$store.state.future.coTypeSymbol;\r\n    },\r\n    contractName() {\r\n      return this.$store.state.future.contractName || '';\r\n    },\r\n  },\r\n  watch: {\r\n    // wsUrl\r\n    wsUrl(val, old) {\r\n      if (val && !old) {\r\n        this.worker.postMessage({\r\n          type: 'CREAT_WEBSOCKET',\r\n          data: {\r\n            wsUrl: val,\r\n            lan: this.$store.state.baseData.lan,\r\n            rate: '',\r\n            symbolAll: {},\r\n          },\r\n        });\r\n      }\r\n    },\r\n    // 监听 用户配置信息\r\n    openContract(val) {\r\n      if (!val) {\r\n        this.openFuturesDialogShow = true;\r\n      }\r\n    },\r\n    // 监听 当前选中货币对的改变\r\n    contractName(val) {\r\n      if (val) {\r\n        this.$router.push(`/trade/${val}`);\r\n        this.$bus.$emit('SYMBOL_CURRENT', val);\r\n      }\r\n    },\r\n    symbolCurrent(val, oldVla) {\r\n      if (oldVla && this.MywebSocket) {\r\n        // 停止 上一个币对的 实时成交 send\r\n        this.webSocketSend('Trade', 'unsub', oldVla);\r\n        // 发送 实时成交 数据 Send\r\n        this.webSocketSend('Trade', 'req', val);\r\n        this.webSocketSend('Trade', 'sub', val);\r\n        // 停止 盘口深度数据 Send\r\n        this.webSocketSend('Depth', 'unsub', oldVla, this.depthValue);\r\n        // 发送 盘口深度 数据 Send\r\n        this.webSocketSend('Depth', 'sub', val, this.depthValue);\r\n      }\r\n    },\r\n    // 监听 webSocket 创建成功\r\n    MywebSocket(val) {\r\n      if (val) {\r\n        // 发送 24小时行情历史数据 Send\r\n        this.webSocketSend('Review');\r\n        // 发送 24小时行情实时数据 Send\r\n        this.webSocketSend('Market', 'sub', this.symbolCurrent, this.contractSymbolList);\r\n        // 发送 盘口深度数据 Send\r\n        this.webSocketSend('Depth', 'sub', this.symbolCurrent, this.depthValue);\r\n\r\n        // // 发送 实时成交 数据 Send\r\n        this.webSocketSend('Trade', 'req', this.symbolCurrent);\r\n        this.webSocketSend('Trade', 'sub', this.symbolCurrent);\r\n      }\r\n    },\r\n    // 深度值切换\r\n    depthValue(val, old) {\r\n      if (old) {\r\n        this.webSocketSend('Depth', 'unsub', this.symbolCurrent, old);\r\n      }\r\n      this.webSocketSend('Depth', 'sub', this.symbolCurrent, val);\r\n    },\r\n  },\r\n  methods: {\r\n    init() {\r\n      // 轮训获取数据\r\n      this.intervalGetData();\r\n      // 获取worker信息\r\n      this.worker.onmessage = (event) => {\r\n        const { data } = event;\r\n        // 监听 WebSocket 链接成功\r\n        if (data.type === 'WEBSOCKET_ON_OPEN') {\r\n          this.MywebSocket = null;\r\n          this.MywebSocket = data.data.type;\r\n          this.$bus.$emit('WEBSOCKET_ON_OPEN', this.MywebSocket);\r\n        }\r\n        // 监听 WS 数据\r\n        if (data.type === 'WEBSOCKET_DATA') {\r\n          this.listenWSData(data.data);\r\n        }\r\n      };\r\n      this.listenBusEvent();\r\n    },\r\n    listenBusEvent() {\r\n      if (this.wsUrl) {\r\n        this.worker.postMessage({\r\n          type: 'CREAT_WEBSOCKET',\r\n          data: {\r\n            wsUrl: this.wsUrl,\r\n            lan: this.$store.state.baseData.lan,\r\n            rate: '',\r\n            symbolAll: {},\r\n          },\r\n        });\r\n      }\r\n      // 显示开通合约弹框\r\n      this.$bus.$on('OPEN_FUTURE', () => {\r\n        this.openFuturesDialogShow = true;\r\n      });\r\n      // 显示偏好设置弹框\r\n      this.$bus.$on('SET_FUTURE_CONFIG', () => {\r\n        if (this.isLogin && this.openContract) {\r\n          this.$store.dispatch('getUserConfig');\r\n        }\r\n        this.setFuturesDialogShow = true;\r\n      });\r\n      // 显示计算器弹框\r\n      this.$bus.$on('OPEN_CALCULATOR_DIALOG', () => {\r\n        this.calculatorDialogShow = true;\r\n      });\r\n      // 监听 深度级别的值\r\n      this.$bus.$on('DEPTH_VALUE', (data) => {\r\n        this.depthValue = data;\r\n      });\r\n      // 监听 kline 发送Send\r\n      this.$bus.$on('WEBSOCKET_KLINE_SEND', (data) => {\r\n        this.worker.postMessage({\r\n          type: 'WEBSOCKET_KLINE_SEND',\r\n          data,\r\n        });\r\n      });\r\n    },\r\n    // 分发WS数据\r\n    listenWSData(data) {\r\n      const { type, WsData } = data;\r\n      this.$bus.$emit(type, WsData);\r\n    },\r\n    webSocketSend(type, sendType, symbolData, symbolList) {\r\n      this.worker.postMessage({\r\n        type: 'WEBSOCKET_SEND',\r\n        data: {\r\n          type,\r\n          sendType,\r\n          symbolData,\r\n          symbolList,\r\n          depthValue: 0,\r\n        },\r\n      });\r\n    },\r\n    ondblclick() {\r\n      return false;\r\n    },\r\n    onclickfun(e) {\r\n      // 显示和隐藏币币交易页面 TradingView 的遮罩\r\n      if (e.target.className === 'coverKlineBox') {\r\n        this.coverKlineBox = e.target;\r\n      }\r\n      if (e.target.className === 'coverKlineBox') {\r\n        this.coverKlineBox.style.display = 'none';\r\n      } else if (this.coverKlineBox) {\r\n        this.coverKlineBox.style.display = 'block';\r\n        this.coverKlineBox = null;\r\n      }\r\n      if (e.target\r\n        && e.target.className\r\n        && e.target.className.indexOf\r\n        && e.target.className.indexOf('ac-type') > -1) {\r\n        this.subOtderTypeShow = e.target.nextElementSibling;\r\n      } else if (this.subOtderTypeShow) {\r\n        this.subOtderTypeShow.style.display = 'none';\r\n        this.subOtderTypeShow = null;\r\n      }\r\n    },\r\n    // 关闭弹窗\r\n    closeDialog() {\r\n      // 关闭开通合约交易弹框\r\n      this.openFuturesDialogShow = false;\r\n      // 关闭喜好设置弹框\r\n      this.setFuturesDialogShow = false;\r\n      // 关闭计算器弹框\r\n      this.calculatorDialogShow = false;\r\n    },\r\n    intervalGetData() {\r\n      // 获取用户持仓和资产列表\r\n      clearInterval(this.getPositionTimer);\r\n      this.getPositionTimer = setInterval(() => {\r\n        if (this.isLogin && this.openContract) {\r\n          this.$store.dispatch('getPositionList');\r\n          this.$store.dispatch('getUserOrderCount');\r\n        } else {\r\n          clearInterval(this.getPositionTimer);\r\n          this.getPositionTimer = null;\r\n        }\r\n      }, 5000);\r\n    },\r\n  },\r\n  destroyed() {\r\n    this.$bus.$off('OPEN_FUTURE');\r\n    this.$bus.$off('SET_FUTURE_CONFIG');\r\n    this.$bus.$off('OPEN_CALCULATOR_DIALOG');\r\n    this.$bus.$off('DEPTH_VALUE');\r\n    this.$bus.$off('WEBSOCKET_KLINE_SEND');\r\n    clearInterval(this.getPositionTimer);\r\n    this.getPositionTimer = null;\r\n  },\r\n};\r\n"]}]}